<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zane Chumley">
<meta name="dcterms.date" content="2024-07-05">

<title>Zane Chumley Data Analysis Portfolio - cdcdata-exercise</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Zane Chumley Data Analysis Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../aboutme.html"> 
<span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="../starter-analysis-exercise/products/report/starter-analysis-report.html">
 <span class="dropdown-text">Starter Analysis Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../coding-exercise/coding-exercise.html">
 <span class="dropdown-text">R Coding Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../data-exercise/data-exercise.html">
 <span class="dropdown-text">Data Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../cdcdata-exercise/cdcdata-exercise.html">
 <span class="dropdown-text">Data Analysis Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../presentation-exercise/presentation-exercise.html">
 <span class="dropdown-text">Presentation Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tidytuesday-exercise/tidytuesday-exercise.html">
 <span class="dropdown-text">Tidy Tuesday Exercise</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/zanechumley/zanechumley-P2-portfolio"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">cdcdata-exercise</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zane Chumley </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 5, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="assignment-5-processing-data" class="level1">
<h1>Assignment 5: Processing Data</h1>
<section id="startup" class="level2">
<h2 class="anchored" data-anchor-id="startup">Startup</h2>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DA 6833 02T</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Summer 2024</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># School of Data Science</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># University of Texas at San Antonio</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Zane Chumley</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Banner ID: @01318598</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># UTSAid: wgs999</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="install-packages-as-needed" class="level3">
<h3 class="anchored" data-anchor-id="install-packages-as-needed">Install Packages as Needed</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("simstudy")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-libraries-as-needed" class="level3">
<h3 class="anchored" data-anchor-id="load-libraries-as-needed">Load Libraries as Needed</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(readxl) #for loading Excel files</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr) #for data processing/cleaning</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr) #for data processing/cleaning</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyverse)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(skimr) #for nice visualization of data </span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(here) #to set paths</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dslabs) #for data used in this assignment</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tibble)</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># library(simstudy)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sqldf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'sqldf' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: gsubfn</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'gsubfn' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: proto</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'proto' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: RSQLite</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'RSQLite' was built under R version 4.3.3</code></pre>
</div>
</div>
</section>
<section id="define-global-variables" class="level3">
<h3 class="anchored" data-anchor-id="define-global-variables">Define Global Variables</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define path to .csv file containing data</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>ZC.filepath <span class="ot">&lt;-</span> <span class="st">"Nutrition__Physical_Activity__and_Obesity_-_Behavioral_Risk_Factor_Surveillance_System_20240703.csv"</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The master dataset may undergo dimensional changes throughout this exercise.  The changing dimensions will be tracked over time.  Variables to track these changing dimensions will be created.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>ZC.dimindex <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>ZC.datarows <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>ZC.datacols <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># There may be columns with data arbitrarily judged to have worthless data.  Variables will be created to store these column names for subsequent examination.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>ZC.columnindex <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>ZC.examinedcolumns <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># There may be lookup tables created during this exercise to simplify the master dataset.  When created, the column containing the lookup table and the name of the lookup table will be stored.</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>ZC.lookupindex <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>ZC.lookupcolumn <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>ZC.lookuptable <span class="ot">&lt;-</span> <span class="fu">list</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="part-1" class="level2">
<h2 class="anchored" data-anchor-id="part-1">Part 1</h2>
<section id="part-1-a-finding-the-data" class="level3">
<h3 class="anchored" data-anchor-id="part-1-a-finding-the-data">Part 1-a: Finding the Data</h3>
<p><em>Previously, you did a quick exploration of a dataset that came with an R package (<code>gapminder</code> data inside <code>dslabs</code> package). A lot of datasets can be found inside R packages. For instance, this page lists what is likely only a small fractionLinks to an external site.. The good and the bad about datasets that come with R packages is that they are often fairly clean/tidy. That’s unfortunately not how most “real world” datasets look like. Getting dirty and messy datasets and wrangling them into a form that is suitable for statistical analysis is part of most workflows and often takes a lot of time. We’ll start practicing this here by getting data that might or might not be very clean.</em></p>
<p><em>Go to the CDC’s data website at https://data.cdc.gov/Links to an external site.. Browse through the site and identify a dataset of interest.</em></p>
<p><em>Which dataset you choose is up to you. I suggest you pick a dataset that has at least 100 observations with 5 different variables, and a mix of continuous and categorical ones. Often, 5 variables means 5 columns. That would be the case in properly formatted data. However, some of the data provided by the CDC is rather poorly formatted. For instance CDC’s dataset on traumatic brain injuryLinks to an external site. has the same variable (age) in separate columns, and it is also discretized. As we’ll discuss, these are two really bad things you can do to your data, so I recommend staying away from such datasets. There are plenty on that website, so I’m sure you’ll find one that is suitable and interesting to you.</em></p>
</section>
<section id="part-1-b-getting-the-data" class="level3">
<h3 class="anchored" data-anchor-id="part-1-b-getting-the-data">Part 1-b: Getting the Data</h3>
<p><em>To get the dataset you selected, it is easiest if you download the file to your computer and place it inside your portfolio repository. Note that in general, you should make each data analysis (or other) project its own GitHub repository, and always use a structure like the one provided in the <code>Data Analysis Template</code> (or something similar). However, for this small exercise and for logistic reasons, you’ll use your portfolio/website repository, and just a single folder. Make a new folder called <code>cdcdata-exercise</code> inside your portfolio repository. Place the data into that folder.</em></p>
<p><em>Remember that GitHub doesn’t like large files. So if you pick a large data file (&gt;50MB), first place it somewhere outside your repository, then reduce it by e.g., writing some R code that selects only a portion of the data. Once it’s small enough, you can place it into the GitHub repository.</em></p>
<p><em>While you should be able to find data for direct download from the CDC website, sometimes you need to write a bit of code to pull data from a source. This is usually done through an API. R has packages that make this relatively easy. If you ever encounter that situation, search online for instructions. Google/Stackoverflow are your friends to figure out what commands you need to write).</em></p>
</section>
<section id="part-1-c-exploring-the-data" class="level3">
<h3 class="anchored" data-anchor-id="part-1-c-exploring-the-data">Part 1-c: Exploring the Data</h3>
<p><em>Now, write code that explores the data. Add a new Quarto document called <code>cdcdata-exercise.qmd</code> to the folder you just created.</em></p>
<p><em>Start by providing a brief description of the data, where you got it, what it contains. Also add a link to the source.</em></p>
<p>This assignment uses a dataset from the United States Center for Disease Control (CDC) titled, “Nutrition, Physical Activity, and Obesity - Behavioral Risk Factor Surveillance System.” The dataset and column definition can be found <a href="https://chronicdata.cdc.gov/Nutrition-Physical-Activity-and-Obesity/Nutrition-Physical-Activity-and-Obesity-Behavioral/hn4x-zwk7/about_data">here</a>.</p>
<p>The CDC describes the dataset as follows:</p>
<blockquote class="blockquote">
<p>This dataset includes data on adult’s diet, physical activity, and weight status from Behavioral Risk Factor Surveillance System. This data is used for DNPAO’s Data, Trends, and Maps database, which provides national and state specific data on obesity, nutrition, physical activity, and breastfeeding.</p>
</blockquote>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The DNPAO is the CDC’s Division of Nutrition, Physical Activity, and Obesity.</p>
</div>
</div>
<p><em>Then write code that reads/loads the data. As needed, process the data (e.g., if there are weird symbols in the data, or missing values coded as <code>999</code> or anything of that sort, write code to fix it.) If your dataset has a lot of variables, pick a few of them (at least 5).</em></p>
<p>The dataset is described by the CDC as 93.2k rows with 33 columns each. For this assignment, the entire dataset will be loaded.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Track time it takes to load</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>ZC.START_TIMESTAMP <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># load the data into a dataframe</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>ZC.data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(ZC.filepath)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>ZC.loadtime <span class="ot">&lt;-</span> <span class="fu">proc.time</span>() <span class="sc">-</span> ZC.START_TIMESTAMP</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Report the load time</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"The data took"</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                      , ZC.loadtime[<span class="dv">3</span>]</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                      , <span class="st">"seconds to load."</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                      , <span class="at">sep=</span><span class="st">" "</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The data took 0.76 seconds to load."</code></pre>
</div>
</div>
<p>There were no issues encountered while loading the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Report master dataset dimensions</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase dimension index</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>ZC.dimindex <span class="ot">&lt;-</span> ZC.dimindex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>ZC.TheseDims <span class="ot">&lt;-</span> <span class="fu">dim</span>(ZC.data)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>ZC.datarows[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">1</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>ZC.datacols[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">2</span>]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"The master dataset is currently"</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                        , ZC.datarows[ZC.dimindex]</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"rows by"</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                        , ZC.datacols[ZC.dimindex]</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"columns."</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">sep=</span><span class="st">" "</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The master dataset is currently 93249 rows by 33 columns."</code></pre>
</div>
</div>
<p>To get an overview of what we have just loaded, a table with summary information about each column is constructed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup control variables and lists</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>ZC.index <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>ZC.colname <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>ZC.coltype <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>ZC.NAvals <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>ZC.unique <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>ZC.example <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the columns to populate the lists</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ZC.ThisColumn <span class="cf">in</span> <span class="fu">colnames</span>(ZC.data))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Increment the index for the lists</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  ZC.index <span class="ot">&lt;-</span> ZC.index<span class="sc">+</span><span class="dv">1</span> </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign the column name</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  ZC.colname[ZC.index] <span class="ot">&lt;-</span> ZC.ThisColumn </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign the column type</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  ZC.coltype[ZC.index] <span class="ot">&lt;-</span> <span class="fu">typeof</span>(ZC.data[[ZC.ThisColumn]]) </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count the number of NAs in the column</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  ZC.NAvals[ZC.index] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(ZC.data[[ZC.ThisColumn]])) </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count the numner of unique values in the column</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  ZC.TheseValues <span class="ot">&lt;-</span> <span class="fu">table</span>(ZC.data[[ZC.ThisColumn]])</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  ZC.unique[ZC.index] <span class="ot">&lt;-</span> <span class="fu">length</span>(ZC.TheseValues)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find a suitable example value</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare to loop through all the values to find an acceptable example</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ZC.ThisRow <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ZC.data)) </span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Start this FOR loop but prepare to break out of it</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    ZC.BreakFlag <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># As soon as an acceptable value is found, set the break flag to 1</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Retrieve the value in ThisRow</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    ZC.ThisExp <span class="ot">&lt;-</span> ZC.data[[ZC.ThisColumn]][ZC.ThisRow]</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Continue with this example only if it is not NA</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(ZC.ThisExp))</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Subsequent processing depends on data type of current example</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Is the current example a character string?</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">typeof</span>(ZC.ThisExp) <span class="sc">==</span> <span class="st">"character"</span>)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Trim any leading and trailing spaces from the current example</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If there is nothing but spaces, only an empty string will survive</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>        ZC.ThisExp <span class="ot">&lt;-</span> <span class="fu">trimws</span>(ZC.ThisExp)</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Continue with this example only if it is not empty</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">nchar</span>(ZC.ThisExp)<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>          <span class="co"># We have an acceptable example</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>          ZC.BreakFlag <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Let's cut it short if the example is too long</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">nchar</span>(ZC.ThisExp)<span class="sc">&gt;</span><span class="dv">8</span>)</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>            ZC.ThisExp <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">substr</span>(ZC.ThisExp, <span class="dv">1</span>, <span class="dv">5</span>), <span class="st">"..."</span>, <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">typeof</span>(ZC.ThisExp) <span class="sc">==</span> <span class="st">"integer"</span> <span class="sc">|</span> <span class="fu">typeof</span>(ZC.ThisExp) <span class="sc">==</span> <span class="st">"double"</span>)</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We would prefer a nonzero value, and we will loop through all the values if necessary to find one</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span>ZC.ThisExp<span class="sc">==</span><span class="dv">0</span>) ZC.BreakFlag <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>      { <span class="co"># The value could be boolean, complex, or something else</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We will take it</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>        ZC.BreakFlag <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we have an acceptable value, we can stop looping through the rows</span></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ZC.BreakFlag <span class="sc">==</span> <span class="dv">1</span>) <span class="cf">break</span></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>  ZC.example[ZC.index] <span class="ot">&lt;-</span> ZC.ThisExp</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind the lists together in a single object</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>ZC.datasum01 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ZC.colname, ZC.coltype, ZC.NAvals, ZC.unique, ZC.example)</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply more friendly column names</span></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ZC.datasum01) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Column"</span></span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>                          , <span class="st">"Data Type"</span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>                          , <span class="st">"NA Values"</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>                          , <span class="st">"Uniques"</span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>                          , <span class="st">"Example"</span></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>ZC.datasum01</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Column                       Data Type   NA Values Uniques Example   
 [1,] "YearStart"                  "integer"   0         12      2020      
 [2,] "YearEnd"                    "integer"   0         12      2020      
 [3,] "LocationAbbr"               "character" 0         55      "US"      
 [4,] "LocationDesc"               "character" 0         55      "National"
 [5,] "Datasource"                 "character" 0         2       "Behav..."
 [6,] "Class"                      "character" 0         3       "Physi..."
 [7,] "Topic"                      "character" 0         3       "Physi..."
 [8,] "Question"                   "character" 0         9       "Perce..."
 [9,] "Data_Value_Unit"            "logical"   93249     0       NA        
[10,] "Data_Value_Type"            "character" 0         1       "Value"   
[11,] "Data_Value"                 "double"    9235      695     30.6      
[12,] "Data_Value_Alt"             "double"    9235      695     30.6      
[13,] "Data_Value_Footnote_Symbol" "character" 0         2       "~"       
[14,] "Data_Value_Footnote"        "character" 0         2       "Data ..."
[15,] "Low_Confidence_Limit"       "double"    9235      666     29.4      
[16,] "High_Confidence_Limit"      "double"    9235      761     31.8      
[17,] "Sample_Size"                "integer"   9235      9761    31255     
[18,] "Total"                      "character" 0         2       "Total"   
[19,] "Age.years."                 "character" 0         7       "25 - 34" 
[20,] "Education"                  "character" 0         5       "High ..."
[21,] "Gender"                     "character" 0         3       "Female"  
[22,] "Income"                     "character" 0         8       "$50,0..."
[23,] "Race.Ethnicity"             "character" 0         9       "Hispanic"
[24,] "GeoLocation"                "character" 0         106     "(13.4..."
[25,] "ClassID"                    "character" 0         3       "PA"      
[26,] "TopicID"                    "character" 0         3       "PA1"     
[27,] "QuestionID"                 "character" 0         9       "Q047"    
[28,] "DataValueTypeID"            "character" 0         1       "VALUE"   
[29,] "LocationID"                 "integer"   0         55      59        
[30,] "StratificationCategory1"    "character" 0         7       "Race/..."
[31,] "Stratification1"            "character" 0         29      "Hispanic"
[32,] "StratificationCategoryId1"  "character" 0         7       "RACE"    
[33,] "StratificationID1"          "character" 0         29      "RACEHIS" </code></pre>
</div>
</div>
<p>The above output stipulates that the values in <strong>Data_Value_Unit</strong> are worthless, confirmed by two (2) distinct findings:</p>
<ul>
<li>all 93,239 values are “NA”</li>
<li>zero (0) unique values</li>
</ul>
<p>Additionally, there is only one unique value in the following columns:</p>
<ul>
<li><strong>Data_Value_Type</strong></li>
<li><strong>DataValueTypeID</strong></li>
</ul>
<p>Therefore, all three (3) of these columns will be dropped from the dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ZC.data <span class="ot">&lt;-</span> <span class="fu">subset</span>(ZC.data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Data_Value_Unit, Data_Value_Type, DataValueTypeID))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Report master dataset dimensions</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase dimension index</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>ZC.dimindex <span class="ot">&lt;-</span> ZC.dimindex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>ZC.TheseDims <span class="ot">&lt;-</span> <span class="fu">dim</span>(ZC.data)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>ZC.datarows[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">1</span>]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>ZC.datacols[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">2</span>]</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"The master dataset is currently"</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                        , ZC.datarows[ZC.dimindex]</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"rows by"</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>                        , ZC.datacols[ZC.dimindex]</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"columns."</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">sep=</span><span class="st">" "</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The master dataset is currently 93249 rows by 30 columns."</code></pre>
</div>
</div>
<p>There are also some column with unique counts so low they appear to offer little or no value. They will be dropped if they are so judged to be unvalued. The columns to be examined are:</p>
<ul>
<li><strong>Datasource</strong></li>
<li><strong>Data_Value_Footnote_Symbol</strong></li>
<li><strong>Data_Value_Footnote</strong></li>
<li><strong>Total</strong></li>
</ul>
<p>For each of these columns, the distinct values will be displayed for evaluation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create list of columns to be examined</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>ZC.examinedcolumns[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"Datasource"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>ZC.examinedcolumns[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="st">"Data_Value_Footnote_Symbol"</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>ZC.examinedcolumns[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="st">"Data_Value_Footnote"</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>ZC.examinedcolumns[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">"Total"</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through the columns to be examined, building and displaying a temporary table of the unique values and their counts.</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ZC.ExamineThis <span class="cf">in</span> ZC.examinedcolumns)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create section separator</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  ZC.printline <span class="ot">&lt;-</span> <span class="st">"********************************"</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span> (ZC.printline)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># build SQL statement syntax</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  ZC.RunThis <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"select "</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                      , ZC.ExamineThis</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                      ,<span class="st">", count(*) as Occurs from 'ZC.data' group by "</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                      , ZC.ExamineThis</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>                      , <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># display SQL statement for posterity</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Running: "</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>                        , ZC.RunThis</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ZC.printline)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load results into temporary table</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  ZC.ThisTable <span class="ot">&lt;-</span> <span class="fu">sqldf</span>(ZC.RunThis)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># display contents of temporary table</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Unique Values of "</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>                        , ZC.ExamineThis</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">":"</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">sep=</span><span class="st">""</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ZC.printline)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># display results of temporary table</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(ZC.ThisTable)</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "********************************"
[1] "Running: select Datasource, count(*) as Occurs from 'ZC.data' group by Datasource"
[1] "Unique Values of Datasource:"
                                  Datasource Occurs
1                                      BRFSS   4620
2 Behavioral Risk Factor Surveillance System  88629
[1] "********************************"
[1] "Running: select Data_Value_Footnote_Symbol, count(*) as Occurs from 'ZC.data' group by Data_Value_Footnote_Symbol"
[1] "Unique Values of Data_Value_Footnote_Symbol:"
  Data_Value_Footnote_Symbol Occurs
1                             84014
2                          ~   9235
[1] "********************************"
[1] "Running: select Data_Value_Footnote, count(*) as Occurs from 'ZC.data' group by Data_Value_Footnote"
[1] "Unique Values of Data_Value_Footnote:"
                                      Data_Value_Footnote Occurs
1                                                          84014
2 Data not available because sample size is insufficient.   9235
[1] "********************************"
[1] "Running: select Total, count(*) as Occurs from 'ZC.data' group by Total"
[1] "Unique Values of Total:"
  Total Occurs
1        89919
2 Total   3330</code></pre>
</div>
</div>
<p>Based on the above results, <strong>Datasource</strong> will be dropped immediately, as the unique values seem synonyms for each other, so there is really only one value in the column. The other three (3) columns require additional consideration.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ZC.data <span class="ot">&lt;-</span> <span class="fu">subset</span>(ZC.data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Datasource))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Report master dataset dimensions</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase dimension index</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>ZC.dimindex <span class="ot">&lt;-</span> ZC.dimindex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>ZC.TheseDims <span class="ot">&lt;-</span> <span class="fu">dim</span>(ZC.data)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>ZC.datarows[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">1</span>]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>ZC.datacols[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">2</span>]</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"The master dataset is currently"</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                        , ZC.datarows[ZC.dimindex]</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"rows by"</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>                        , ZC.datacols[ZC.dimindex]</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"columns."</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">sep=</span><span class="st">" "</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The master dataset is currently 93249 rows by 29 columns."</code></pre>
</div>
</div>
<p>The <strong>Total</strong> column unique values don’t seem to tell much. The CDC describes the data in this column as:</p>
<blockquote class="blockquote">
<p>Total/Overall breakout category</p>
</blockquote>
<p>Given the vagueness of the description and the unique values, the <strong>Total</strong> column will also be dropped.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ZC.data <span class="ot">&lt;-</span> <span class="fu">subset</span>(ZC.data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Total))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Report master dataset dimensions</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase dimension index</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>ZC.dimindex <span class="ot">&lt;-</span> ZC.dimindex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>ZC.TheseDims <span class="ot">&lt;-</span> <span class="fu">dim</span>(ZC.data)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>ZC.datarows[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">1</span>]</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>ZC.datacols[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">2</span>]</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"The master dataset is currently"</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                        , ZC.datarows[ZC.dimindex]</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"rows by"</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                        , ZC.datacols[ZC.dimindex]</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"columns."</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">sep=</span><span class="st">" "</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The master dataset is currently 93249 rows by 28 columns."</code></pre>
</div>
</div>
<p>The <strong>GeoLocation</strong> column appears to have highly-coded data. The CDC describes this column as:</p>
<blockquote class="blockquote">
<p>Latitude &amp; Longitude to be provided for formatting GeoLocation or Geocode in the format (latitude, longitude)</p>
</blockquote>
<p>Therefore, this column will also be dropped.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ZC.data <span class="ot">&lt;-</span> <span class="fu">subset</span>(ZC.data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(GeoLocation))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Report master dataset dimensions</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase dimension index</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>ZC.dimindex <span class="ot">&lt;-</span> ZC.dimindex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>ZC.TheseDims <span class="ot">&lt;-</span> <span class="fu">dim</span>(ZC.data)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>ZC.datarows[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">1</span>]</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>ZC.datacols[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">2</span>]</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"The master dataset is currently"</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                        , ZC.datarows[ZC.dimindex]</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"rows by"</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                        , ZC.datacols[ZC.dimindex]</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"columns."</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">sep=</span><span class="st">" "</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The master dataset is currently 93249 rows by 27 columns."</code></pre>
</div>
</div>
<p>The count of the only nonblank value in both the <strong>Data_Value_Footnote_Symbol</strong> and <strong>Data_Value_Footnote</strong> have been seen before: coincidence or not, there are the exact name number of NA values in the <strong>Data_Value</strong> and <strong>Data_Value_Alt</strong> columns. If it turns out there is a meaningful value in <strong>Data_Value_Footnote_Symbol</strong> and <strong>Data_Value_Footnote</strong> for each NA in <strong>Data_Value</strong> and <strong>Data_Value_Alt</strong>, then the <strong>Data_Value_Footnote_Symbol</strong> and <strong>Data_Value_Footnote</strong> columns can be considered duplicative information for NA values in the <strong>Data_Value</strong> and <strong>Data_Value_Alt</strong> columns.</p>
<p>To examine, we will build lists of the rows where the following conditions occur, and then compare them to see if they are equal:</p>
<ul>
<li>Where <strong>Data_Value_Footnote_Symbol</strong> is not blank</li>
<li>Where <strong>Data_Value_Footnote</strong> is not blank</li>
<li>Where <strong>Data_Value</strong> is NA</li>
<li>Where <strong>Data_Value_Alt</strong> is NA</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create lists to store row numbers where specified conditions occur</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># store rows where Data_Value_Footnote_Symbol is not blank</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>ZC.DVFS <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># store rows where Data_Value_Footnote is not blank</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>ZC.DVF <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># store rows where Data_Value is NA</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>ZC.DV <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># store rows where Data_Value_Alt is NA</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>ZC.DVA <span class="ot">&lt;-</span> <span class="fu">list</span>() </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create index variable for each list</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>ZC.DVFSIndex <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>ZC.DVFIndex <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>ZC.DVIndex <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>ZC.DVAIndex <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through the rows in the master dataset and store indices where conditions are met</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>ZC.RowRange <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ZC.data)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ZC.CheckRow <span class="cf">in</span> ZC.RowRange)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pull Data_Value_Footnote_Symbol value in current row</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  ZC.ThisValue <span class="ot">&lt;-</span> ZC.data<span class="sc">$</span>Data_Value_Footnote_Symbol[ZC.CheckRow]</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="fu">is.null</span>(ZC.ThisValue)))</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Value is not NULL</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># But is it empty or blank?</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    ZC.ThisValue <span class="ot">&lt;-</span> <span class="fu">trimws</span>(ZC.ThisValue)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nchar</span>(ZC.ThisValue)<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>      <span class="co"># value is not blank, so store the row number</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>      ZC.DVFSIndex <span class="ot">&lt;-</span> ZC.DVFSIndex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>      ZC.DVFS[ZC.DVFSIndex] <span class="ot">&lt;-</span> ZC.CheckRow</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pull Data_Value_Footnote value in current row</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>  ZC.ThisValue <span class="ot">&lt;-</span> ZC.data<span class="sc">$</span>Data_Value_Footnote[ZC.CheckRow]</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="fu">is.null</span>(ZC.ThisValue)))</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Value is not NULL</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># But is it empty or blank?</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    ZC.ThisValue <span class="ot">&lt;-</span> <span class="fu">trimws</span>(ZC.ThisValue)</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nchar</span>(ZC.ThisValue)<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>      <span class="co"># value is not blank, so store the row number</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>      ZC.DVFIndex <span class="ot">&lt;-</span> ZC.DVFIndex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>      ZC.DVF[ZC.DVFIndex] <span class="ot">&lt;-</span> ZC.CheckRow</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># is Data_Value an NA value?</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(ZC.data<span class="sc">$</span>Data_Value[ZC.CheckRow]))</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>      <span class="co"># value is NA, so store the row number</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>      ZC.DVIndex <span class="ot">&lt;-</span> ZC.DVIndex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>      ZC.DV[ZC.DVIndex] <span class="ot">&lt;-</span> ZC.CheckRow</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># is Data_Value_Alt an NA value?</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(ZC.data<span class="sc">$</span>Data_Value_Alt[ZC.CheckRow]))</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>      <span class="co"># value is NA, so store the row number</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>      ZC.DVAIndex <span class="ot">&lt;-</span> ZC.DVAIndex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>      ZC.DVA[ZC.DVAIndex] <span class="ot">&lt;-</span> ZC.CheckRow</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that the lists of the row numbers where the conditions occur have been built, they need to be compared. They only need to be compared if they are all the same length, so that will be checked first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the list of row numbers where conditions were met</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Are all the lists of the same length?  No need to compare if not.</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an indicator flag to indicate if the row numbers match.</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># They can't match if the count of row numbers does not match, so assume it is FALSE</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>ZC.CompEquals <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (ZC.DVFSIndex<span class="sc">==</span>ZC.DVFIndex<span class="sc">&amp;</span>ZC.DVFIndex<span class="sc">==</span>ZC.DVIndex<span class="sc">&amp;</span>ZC.DVIndex<span class="sc">==</span>ZC.DVAIndex)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The lists are the same length.  A loop will be used to compare value by value.</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># No need to continue the loop as soon as a difference if found</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set the indicator to TRUE; change to FALSE if an unequal row number is found</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  ZC.CompEquals <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The row numbers in the list are actually embedded inside lists of one (1) item. </span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  ZC.CompRange <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>ZC.DVIndex</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ZC.CompRow <span class="cf">in</span> ZC.CompRange)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The row numbers in the list are actually embedded inside lists of one (1) item. </span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We'll break each value out of it's list before we compare.</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    ZC.ThisDVFS <span class="ot">&lt;-</span> <span class="fu">unlist</span>(ZC.DVFS[ZC.CompRow])</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    ZC.ThisDVF <span class="ot">&lt;-</span> <span class="fu">unlist</span>(ZC.DVF[ZC.CompRow])</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    ZC.ThisDV <span class="ot">&lt;-</span> <span class="fu">unlist</span>(ZC.DV[ZC.CompRow])</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    ZC.ThisDVA <span class="ot">&lt;-</span> <span class="fu">unlist</span>(ZC.DVA[ZC.CompRow])</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span>(ZC.ThisDVFS<span class="sc">==</span>ZC.ThisDVF<span class="sc">&amp;</span>ZC.ThisDVF<span class="sc">==</span>ZC.ThisDV<span class="sc">&amp;</span>ZC.ThisDV<span class="sc">==</span>ZC.ThisDVA))</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>      <span class="co"># We found a row number that did not match.  Set indicator value to FALSE and stop</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>      ZC.CompEquals <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>ZC.ThisDVFS <span class="co"># TDL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 93241</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(ZC.ThisDVFS) <span class="co">#TDL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ZC.CompRow <span class="co"># TDL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9235</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(ZC.CompRow) <span class="co">#TDL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ZC.DVFS[ZC.CompRow] <span class="co"># TDL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 93241</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(ZC.DVFS[ZC.CompRow]) <span class="co"># TDL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ZC.DVF[ZC.CompRow] <span class="co">#TDL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 93241</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(ZC.DVF[ZC.CompRow]) <span class="co"># TDL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Did the indicator flag survive every row number comparison?</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (ZC.CompEquals)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Row numbers where conditions are met match."</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Row numbers where conditions are met do not match."</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Row numbers where conditions are met match."</code></pre>
</div>
</div>
<p>The lists of row numbers where the conditions were met match exactly. Therefore, the data in columns <strong>Data_Value_Footnote_Symbol</strong> and <strong>Data_Value_Footnote</strong> can be considered redundant for cases when the values in <strong>Data_Value</strong> and <strong>Data_Value_Alt</strong> are NA. Having already established that the data in columns <strong>Data_Value_Footnote_Symbol</strong> and <strong>Data_Value_Footnote</strong> is blank when the values in <strong>Data_Value</strong> and <strong>Data_Value_Alt</strong> are not NA, we can remove the columns with blank/redundant data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>ZC.data <span class="ot">&lt;-</span> <span class="fu">subset</span>(ZC.data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Data_Value_Footnote_Symbol, Data_Value_Footnote))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Report master dataset dimensions</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase dimension index</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>ZC.dimindex <span class="ot">&lt;-</span> ZC.dimindex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>ZC.TheseDims <span class="ot">&lt;-</span> <span class="fu">dim</span>(ZC.data)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>ZC.datarows[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">1</span>]</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>ZC.datacols[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">2</span>]</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"The master dataset is currently"</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>                        , ZC.datarows[ZC.dimindex]</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"rows by"</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>                        , ZC.datacols[ZC.dimindex]</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"columns."</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">sep=</span><span class="st">" "</span>)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The master dataset is currently 93249 rows by 25 columns."</code></pre>
</div>
</div>
<p>Next, the count of unique values, coupled with the column names, suggests a one-to-one relationship between the data in one column and the data in another. In proven true, we can reduce repetitiveness by archiving off the duplicated data into a separate lookup table. Column combinations to consider are:</p>
<ul>
<li><strong>LocationID</strong>, a potential lookup for both <strong>LocationAbbr</strong> and <strong>LocationDesc</strong></li>
<li><strong>StratificationCategoryId1</strong>, a potential lookup for <strong>StratificationCategory1</strong></li>
<li><strong>StratificationID1</strong>, a potential lookup for <strong>Stratification1</strong></li>
</ul>
<p>The validity of an index/lookup relationship between the above potentials will be explored, beginning with <strong>LocationID</strong>.</p>
<p>A SQL statement will be utilized to count the number of times each combination of the <strong>LocationID</strong>, <strong>LocationAbbr</strong>, and <strong>LocationDesc</strong> occurs in the data. Since there are 55 unique values in each of these columns, if there are a total of 55 combinations, then a one-to-one(-to-one) correlation is established.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select LocationID, LocationAbbr, LocationDesc, count(*) as Occurs from 'ZC.data' group by LocationID, LocationAbbr, LocationDesc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   LocationID LocationAbbr         LocationDesc Occurs
1           1           AL              Alabama   1736
2           2           AK               Alaska   1736
3           4           AZ              Arizona   1736
4           5           AR             Arkansas   1736
5           6           CA           California   1736
6           8           CO             Colorado   1736
7           9           CT          Connecticut   1736
8          10           DE             Delaware   1736
9          11           DC District of Columbia   1736
10         12           FL              Florida   1736
11         13           GA              Georgia   1736
12         15           HI               Hawaii   1736
13         16           ID                Idaho   1736
14         17           IL             Illinois   1736
15         18           IN              Indiana   1736
16         19           IA                 Iowa   1736
17         20           KS               Kansas   1736
18         21           KY             Kentucky   1736
19         22           LA            Louisiana   1736
20         23           ME                Maine   1736
21         24           MD             Maryland   1736
22         25           MA        Massachusetts   1736
23         26           MI             Michigan   1736
24         27           MN            Minnesota   1736
25         28           MS          Mississippi   1736
26         29           MO             Missouri   1736
27         30           MT              Montana   1736
28         31           NE             Nebraska   1736
29         32           NV               Nevada   1736
30         33           NH        New Hampshire   1736
31         34           NJ           New Jersey   1493
32         35           NM           New Mexico   1736
33         36           NY             New York   1736
34         37           NC       North Carolina   1736
35         38           ND         North Dakota   1736
36         39           OH                 Ohio   1736
37         40           OK             Oklahoma   1736
38         41           OR               Oregon   1736
39         42           PA         Pennsylvania   1736
40         44           RI         Rhode Island   1736
41         45           SC       South Carolina   1736
42         46           SD         South Dakota   1736
43         47           TN            Tennessee   1736
44         48           TX                Texas   1736
45         49           UT                 Utah   1736
46         50           VT              Vermont   1736
47         51           VA             Virginia   1736
48         53           WA           Washington   1736
49         54           WV        West Virginia   1736
50         55           WI            Wisconsin   1736
51         56           WY              Wyoming   1736
52         59           US             National   1736
53         66           GU                 Guam   1260
54         72           PR          Puerto Rico   1316
55         78           VI       Virgin Islands    644</code></pre>
</div>
</div>
<p>There are only 55 total unique combinations for these three (3) variables, so a lookup table for <strong>LocationAbbr</strong> and another for <strong>LocationDesc</strong> will be created, both with <strong>LocationID</strong> as the lookup value. The lookup value and the first lookup table will be stored as a relationship. Afterwards, the columns containing the lookup values will be dropped.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating and displaying top of lookup tables</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>ZC.lookupLocationAbbr <span class="ot">&lt;-</span> <span class="fu">sqldf</span>(<span class="st">"select distinct LocationID, LocationAbbr from 'ZC.data' order by LocationID"</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ZC.lookupLocationAbbr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  LocationID LocationAbbr
1          1           AL
2          2           AK
3          4           AZ
4          5           AR
5          6           CA
6          8           CO</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>ZC.lookupLocationDesc <span class="ot">&lt;-</span> <span class="fu">sqldf</span>(<span class="st">"select distinct LocationID, LocationDesc from 'ZC.data' order by LocationID"</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ZC.lookupLocationDesc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  LocationID LocationDesc
1          1      Alabama
2          2       Alaska
3          4      Arizona
4          5     Arkansas
5          6   California
6          8     Colorado</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing lookup columns and lookup table names</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>ZC.lookupindex <span class="ot">&lt;-</span> ZC.lookupindex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>ZC.lookupcolumn[ZC.lookupindex] <span class="ot">&lt;-</span> <span class="st">"LocationID"</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>ZC.lookuptable[ZC.lookupindex] <span class="ot">&lt;-</span> <span class="st">"LocationAbbr"</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>ZC.data <span class="ot">&lt;-</span> <span class="fu">subset</span>(ZC.data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(LocationAbbr, LocationDesc))</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Report master dataset dimensions</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase dimension index</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>ZC.dimindex <span class="ot">&lt;-</span> ZC.dimindex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>ZC.TheseDims <span class="ot">&lt;-</span> <span class="fu">dim</span>(ZC.data)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>ZC.datarows[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">1</span>]</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>ZC.datacols[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">2</span>]</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"The master dataset is currently"</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>                        , ZC.datarows[ZC.dimindex]</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"rows by"</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>                        , ZC.datacols[ZC.dimindex]</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"columns."</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">sep=</span><span class="st">" "</span>)</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The master dataset is currently 93249 rows by 23 columns."</code></pre>
</div>
</div>
<p>A SQL statement will be utilized to count the number of times each combination of the <strong>StratificationCategoryId1</strong> and <strong>StratificationCategory1</strong> occurs in the data. Since there are seven (7) unique values in each of these columns, if there are a total of seven (7) combinations, then a one-to-one correlation is established.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select StratificationCategoryId1, StratificationCategory1, count(*) as Occurs from 'ZC.data' group by StratificationCategoryId1, StratificationCategory1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  StratificationCategoryId1 StratificationCategory1 Occurs
1                                                        9
2                     AGEYR             Age (years)  19980
3                       EDU               Education  13320
4                       GEN                  Gender   6660
5                       INC                  Income  23310
6                       OVR                   Total   3330
7                      RACE          Race/Ethnicity  26640</code></pre>
</div>
</div>
<p>There are only seven (7) total unique combinations for these two (2) variables, so a lookup table for <strong>StratificationCategory1</strong> will be created with <strong>StratificationCategoryId1</strong> as the lookup value. The lookup value and the lookup table will be stored as a relationship. Afterwards, the columns containing the lookup values will be dropped.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating and displaying top of lookup tables</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>ZC.StratificationCategory1 <span class="ot">&lt;-</span> <span class="fu">sqldf</span>(<span class="st">"select distinct StratificationCategoryId1, StratificationCategory1 from 'ZC.data' order by StratificationCategoryId1"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ZC.StratificationCategory1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  StratificationCategoryId1 StratificationCategory1
1                                                  
2                     AGEYR             Age (years)
3                       EDU               Education
4                       GEN                  Gender
5                       INC                  Income
6                       OVR                   Total</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing lookup columns and lookup table names</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>ZC.lookupindex <span class="ot">&lt;-</span> ZC.lookupindex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>ZC.lookupcolumn[ZC.lookupindex] <span class="ot">&lt;-</span> <span class="st">"StratificationCategoryId1"</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>ZC.lookuptable[ZC.lookupindex] <span class="ot">&lt;-</span> <span class="st">"StratificationCategory1"</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>ZC.data <span class="ot">&lt;-</span> <span class="fu">subset</span>(ZC.data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(StratificationCategory1))</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Report master dataset dimensions</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase dimension index</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>ZC.dimindex <span class="ot">&lt;-</span> ZC.dimindex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>ZC.TheseDims <span class="ot">&lt;-</span> <span class="fu">dim</span>(ZC.data)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>ZC.datarows[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">1</span>]</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>ZC.datacols[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">2</span>]</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"The master dataset is currently"</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>                        , ZC.datarows[ZC.dimindex]</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"rows by"</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>                        , ZC.datacols[ZC.dimindex]</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"columns."</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">sep=</span><span class="st">" "</span>)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The master dataset is currently 93249 rows by 22 columns."</code></pre>
</div>
</div>
<p>A SQL statement will be utilized to count the number of times each combination of the <strong>StratificationID1</strong> and <strong>Stratification1</strong> occurs in the data. Since there are 29 unique values in each of these columns, if there are a total of 29 combinations, then a one-to-one correlation is established.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqldf</span>(<span class="st">"select StratificationID1, Stratification1, count(*) as Occurs from 'ZC.data' group by StratificationID1, Stratification1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   StratificationID1                  Stratification1 Occurs
1                                                          9
2          AGEYR1824                          18 - 24   3330
3          AGEYR2534                          25 - 34   3330
4          AGEYR3544                          35 - 44   3330
5          AGEYR4554                          45 - 54   3330
6          AGEYR5564                          55 - 64   3330
7        AGEYR65PLUS                      65 or older   3330
8          EDUCOGRAD                 College graduate   3330
9           EDUCOTEC Some college or technical school   3330
10             EDUHS            Less than high school   3330
11         EDUHSGRAD             High school graduate   3330
12            FEMALE                           Female   3330
13           INC1525                $15,000 - $24,999   3330
14           INC2535                $25,000 - $34,999   3330
15           INC3550                $35,000 - $49,999   3330
16           INC5075                $50,000 - $74,999   3330
17         INC75PLUS               $75,000 or greater   3330
18         INCLESS15                Less than $15,000   3330
19             INCNR                Data not reported   3330
20              MALE                             Male   3330
21           OVERALL                            Total   3330
22         RACE2PLUS                  2 or more races   3330
23           RACEASN                            Asian   3330
24           RACEBLK               Non-Hispanic Black   3330
25           RACEHIS                         Hispanic   3330
26           RACEHPI        Hawaiian/Pacific Islander   3330
27           RACENAA    American Indian/Alaska Native   3330
28           RACEOTH                            Other   3330
29           RACEWHT               Non-Hispanic White   3330</code></pre>
</div>
</div>
<p>There are only 29 total unique combinations for these two (2) variables, so a lookup table for <strong>Stratification1</strong> will be created with <strong>StratificationID1</strong> as the lookup value. The lookup value and the lookup table will be stored as a relationship. Afterwards, the columns containing the lookup values will be dropped.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating and displaying top of lookup tables</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>ZC.Stratification1 <span class="ot">&lt;-</span> <span class="fu">sqldf</span>(<span class="st">"select distinct StratificationID1, Stratification1 from 'ZC.data' order by StratificationID1"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ZC.Stratification1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  StratificationID1 Stratification1
1                                  
2         AGEYR1824         18 - 24
3         AGEYR2534         25 - 34
4         AGEYR3544         35 - 44
5         AGEYR4554         45 - 54
6         AGEYR5564         55 - 64</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing lookup columns and lookup table names</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>ZC.lookupindex <span class="ot">&lt;-</span> ZC.lookupindex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>ZC.lookupcolumn[ZC.lookupindex] <span class="ot">&lt;-</span> <span class="st">"StratificationID1"</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>ZC.lookuptable[ZC.lookupindex] <span class="ot">&lt;-</span> <span class="st">"Stratification1"</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>ZC.data <span class="ot">&lt;-</span> <span class="fu">subset</span>(ZC.data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Stratification1))</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Report master dataset dimensions</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase dimension index</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>ZC.dimindex <span class="ot">&lt;-</span> ZC.dimindex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>ZC.TheseDims <span class="ot">&lt;-</span> <span class="fu">dim</span>(ZC.data)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>ZC.datarows[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">1</span>]</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>ZC.datacols[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">2</span>]</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"The master dataset is currently"</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>                        , ZC.datarows[ZC.dimindex]</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"rows by"</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>                        , ZC.datacols[ZC.dimindex]</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"columns."</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">sep=</span><span class="st">" "</span>)</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The master dataset is currently 93249 rows by 21 columns."</code></pre>
</div>
</div>
<p>Similarly, it’s possible <strong>YearStart</strong> always equals <strong>YearEnd</strong>, <strong>Class</strong> always equals <strong>Topic</strong>, and <strong>Data_Value</strong> always equals <strong>Data_Value_Alt</strong>. Code will be executed to see if these possible pairs always duplicate a value in the other; if so, the duplicate column will be dropped.</p>
<p>Since there are NA values in both the <strong>Data_Value</strong> and <strong>Data_Value_Alt</strong>, and R code will halt if it tries to compare an NA with anything (even another NA value), this comparison will be conditional. For the purposes of this exercise:</p>
<ul>
<li>if both values are NA, the values are considered equal (but a comparison cannot be attempted by R).</li>
<li>if one value is NA but the other is not, the values are considered not equal.</li>
<li>if neither value is NA, a comparison will be performed to determine if the values are equal or not.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up variables to count differences</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>ZC.YearDeltas <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>ZC.ClassDeltas <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>ZC.DataDeltas <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ZC.ThisRow <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ZC.data))</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count if YearStart and YearEnd are different values</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(ZC.data<span class="sc">$</span>YearStart[ZC.ThisRow]<span class="sc">==</span>ZC.data<span class="sc">$</span>YearEnd[ZC.ThisRow]))</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Brackets not necessary; just respecting page margins</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>      ZC.YearDeltas <span class="ot">&lt;-</span> ZC.YearDeltas<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count if Class and Topic are different values</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>(ZC.data<span class="sc">$</span>Class[ZC.ThisRow]<span class="sc">==</span>ZC.data<span class="sc">$</span>Topic[ZC.ThisRow]))</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Brackets not necessary; just respecting page margins</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>      ZC.ClassDeltas <span class="ot">&lt;-</span> ZC.ClassDeltas<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># There could be NA values for either Data_Value and/or Data_Value_Alt</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If both are NA, there is no difference</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If only one is NA, there is a difference</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only compare if neither are NA</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(ZC.data<span class="sc">$</span>Data_Value[ZC.ThisRow])<span class="sc">==</span><span class="fu">is.na</span>(ZC.data<span class="sc">$</span>Data_Value_Alt[ZC.ThisRow]))</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Either both are NA or neither or NA</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Comparison is not necessary (or valid!) if both are NA</span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>(<span class="fu">is.na</span>(ZC.data<span class="sc">$</span>Data_Value[ZC.ThisRow])))</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Neither are NA - compare values</span></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span>(ZC.data<span class="sc">$</span>Data_Value[ZC.ThisRow]<span class="sc">==</span>ZC.data<span class="sc">$</span>Data_Value_Alt[ZC.ThisRow]))</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Values are not equal</span></span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>        ZC.DataDeltas <span class="ot">&lt;-</span> ZC.DataDeltas<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># One value is NA but not the other, so they are automatically not equal</span></span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>    ZC.DataDeltas <span class="ot">&lt;-</span> ZC.DataDeltas<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Report on deltas</span></span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"There were"</span></span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>                      , ZC.YearDeltas</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>                      , <span class="st">"row(s) with different values in YearStart and YearEnd."</span></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>                      , <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There were 0 row(s) with different values in YearStart and YearEnd."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"There were"</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>                      , ZC.ClassDeltas</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>                      , <span class="st">"row(s) with different values in Class and Topic."</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>                      , <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There were 57015 row(s) with different values in Class and Topic."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"There were"</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>                      , ZC.DataDeltas</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>                      , <span class="st">"row(s) with different values in Data_Value and Data_Value_Alt."</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>                      , <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There were 0 row(s) with different values in Data_Value and Data_Value_Alt."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop YearEnd if it always equals YearStart</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (ZC.YearDeltas<span class="sc">==</span><span class="dv">0</span>) </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Dropping column YearEnd"</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    ZC.data <span class="ot">&lt;-</span> <span class="fu">subset</span>(ZC.data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(YearEnd))</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Dropping column YearEnd"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop Topic if it always equals Class</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (ZC.ClassDeltas<span class="sc">==</span><span class="dv">0</span>) </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Dropping column Topic"</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    ZC.data <span class="ot">&lt;-</span> <span class="fu">subset</span>(ZC.data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Topic))</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop Data_Value_Alt if it always equals Data_Value</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (ZC.DataDeltas<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Dropping column Data_Value_Alt"</span>)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    ZC.data <span class="ot">&lt;-</span> <span class="fu">subset</span>(ZC.data, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(Data_Value_Alt))</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Dropping column Data_Value_Alt"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Report master dataset dimensions</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Increase dimension index</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>ZC.dimindex <span class="ot">&lt;-</span> ZC.dimindex<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>ZC.TheseDims <span class="ot">&lt;-</span> <span class="fu">dim</span>(ZC.data)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>ZC.datarows[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">1</span>]</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>ZC.datacols[ZC.dimindex] <span class="ot">&lt;-</span> ZC.TheseDims[<span class="dv">2</span>]</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"The master dataset is currently"</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>                        , ZC.datarows[ZC.dimindex]</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"rows by"</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>                        , ZC.datacols[ZC.dimindex]</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>                        , <span class="st">"columns."</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>                        , <span class="at">sep=</span><span class="st">" "</span>)</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>ZC.printline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The master dataset is currently 93249 rows by 19 columns."</code></pre>
</div>
</div>
<p>Finally, some column names do not play well with SQL (when they contain unallowed characters), which will be used later to build the data for the charts. So, there will be a few manual manipulations of some column names:</p>
<ul>
<li><strong>Age.years.</strong> will become <strong>AgeYears</strong></li>
<li><strong>Race.Ethnicity</strong> will become <strong>RaceEthnic</strong></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change column names to be more SQL-friendly</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">typeof</span>(ZC.data)) <span class="co"># TDL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ZC.data)[<span class="fu">names</span>(ZC.data) <span class="sc">==</span> <span class="st">'Age.years.'</span>] <span class="ot">&lt;-</span> <span class="st">'AgeYears'</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ZC.data)[<span class="fu">names</span>(ZC.data) <span class="sc">==</span> <span class="st">'Race.Ethnicity'</span>] <span class="ot">&lt;-</span> <span class="st">'RaceEthnic'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The summary table will be rebuilt before continuing. This time, a new column, LU (for lookup) will be created. If a lookup table has been created for the master dataset column, LU will be set to one (1); otherwise, it will be set to zero (0).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup control variables and lists</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>ZC.index <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>ZC.colname <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>ZC.coltype <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>ZC.NAvals <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>ZC.unique <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>ZC.lookups <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>ZC.example <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the columns to populate the lists</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ZC.ThisColumn <span class="cf">in</span> <span class="fu">colnames</span>(ZC.data))</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Increment the index for the lists</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  ZC.index <span class="ot">&lt;-</span> ZC.index<span class="sc">+</span><span class="dv">1</span> </span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign the column name</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  ZC.colname[ZC.index] <span class="ot">&lt;-</span> ZC.ThisColumn </span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign the column type</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>  ZC.coltype[ZC.index] <span class="ot">&lt;-</span> <span class="fu">typeof</span>(ZC.data[[ZC.ThisColumn]]) </span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count the number of NAs in the column</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>  ZC.NAvals[ZC.index] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(ZC.data[[ZC.ThisColumn]])) </span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count the number of unique values in the column</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>  ZC.TheseValues <span class="ot">&lt;-</span> <span class="fu">table</span>(ZC.data[[ZC.ThisColumn]])</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>  ZC.unique[ZC.index] <span class="ot">&lt;-</span> <span class="fu">length</span>(ZC.TheseValues)</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Determine if the column has an associated lookup table</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assume there is no lookup table</span></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>  ZC.lookups[ZC.index] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Search for the column in the list of columns with associated lookup tables</span></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Flag it is the column is found to be associated with a lookup table</span></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ZC.ThisLookupColumn <span class="cf">in</span> ZC.lookupcolumn)</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ZC.ThisLookupColumn<span class="sc">==</span>ZC.colname[ZC.index]) </span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Column found, flag it as having a lookup table association</span></span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a>      ZC.lookups[ZC.index] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find a suitable example value</span></span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare to loop through all the values to find an acceptable example</span></span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ZC.ThisRow <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ZC.data)) </span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Start this FOR loop but prepare to break out of it</span></span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a>    ZC.BreakFlag <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># As soon as an acceptable value is found, set the break flag to 1</span></span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Retrieve the value in ThisRow</span></span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a>    ZC.ThisExp <span class="ot">&lt;-</span> ZC.data[[ZC.ThisColumn]][ZC.ThisRow]</span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Continue with this example only if it is not NA</span></span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.na</span>(ZC.ThisExp))</span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Subsequent processing depends on data type of current example</span></span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Is the current example a character string?</span></span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">typeof</span>(ZC.ThisExp) <span class="sc">==</span> <span class="st">"character"</span>)</span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Trim any leading and trailing spaces from the current example</span></span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If there is nothing but spaces, only an empty string will survive</span></span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a>        ZC.ThisExp <span class="ot">&lt;-</span> <span class="fu">trimws</span>(ZC.ThisExp)</span>
<span id="cb84-55"><a href="#cb84-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Continue with this example only if it is not empty</span></span>
<span id="cb84-56"><a href="#cb84-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">nchar</span>(ZC.ThisExp)<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb84-57"><a href="#cb84-57" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb84-58"><a href="#cb84-58" aria-hidden="true" tabindex="-1"></a>          <span class="co"># We have an acceptable example</span></span>
<span id="cb84-59"><a href="#cb84-59" aria-hidden="true" tabindex="-1"></a>          ZC.BreakFlag <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb84-60"><a href="#cb84-60" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Let's cut it short if the example is too long</span></span>
<span id="cb84-61"><a href="#cb84-61" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">nchar</span>(ZC.ThisExp)<span class="sc">&gt;</span><span class="dv">8</span>)</span>
<span id="cb84-62"><a href="#cb84-62" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb84-63"><a href="#cb84-63" aria-hidden="true" tabindex="-1"></a>            ZC.ThisExp <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">substr</span>(ZC.ThisExp, <span class="dv">1</span>, <span class="dv">5</span>), <span class="st">"..."</span>, <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb84-64"><a href="#cb84-64" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb84-65"><a href="#cb84-65" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb84-66"><a href="#cb84-66" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">typeof</span>(ZC.ThisExp) <span class="sc">==</span> <span class="st">"integer"</span> <span class="sc">|</span> <span class="fu">typeof</span>(ZC.ThisExp) <span class="sc">==</span> <span class="st">"double"</span>)</span>
<span id="cb84-67"><a href="#cb84-67" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb84-68"><a href="#cb84-68" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We would prefer a nonzero value, and we will loop through all the values if necessary to find one</span></span>
<span id="cb84-69"><a href="#cb84-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span>ZC.ThisExp<span class="sc">==</span><span class="dv">0</span>) ZC.BreakFlag <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb84-70"><a href="#cb84-70" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span></span>
<span id="cb84-71"><a href="#cb84-71" aria-hidden="true" tabindex="-1"></a>      { <span class="co"># The value could be boolean, complex, or something else</span></span>
<span id="cb84-72"><a href="#cb84-72" aria-hidden="true" tabindex="-1"></a>        <span class="co"># We will take it</span></span>
<span id="cb84-73"><a href="#cb84-73" aria-hidden="true" tabindex="-1"></a>        ZC.BreakFlag <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb84-74"><a href="#cb84-74" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb84-75"><a href="#cb84-75" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb84-76"><a href="#cb84-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we have an acceptable value, we can stop looping through the rows</span></span>
<span id="cb84-77"><a href="#cb84-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ZC.BreakFlag <span class="sc">==</span> <span class="dv">1</span>) <span class="cf">break</span></span>
<span id="cb84-78"><a href="#cb84-78" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-79"><a href="#cb84-79" aria-hidden="true" tabindex="-1"></a>  ZC.example[ZC.index] <span class="ot">&lt;-</span> ZC.ThisExp</span>
<span id="cb84-80"><a href="#cb84-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-81"><a href="#cb84-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind the lists together in a single object</span></span>
<span id="cb84-82"><a href="#cb84-82" aria-hidden="true" tabindex="-1"></a>ZC.datasum02 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(ZC.colname, ZC.coltype, ZC.NAvals, ZC.unique, ZC.lookups, ZC.example)</span>
<span id="cb84-83"><a href="#cb84-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply more friendly column names</span></span>
<span id="cb84-84"><a href="#cb84-84" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ZC.datasum02) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Column"</span></span>
<span id="cb84-85"><a href="#cb84-85" aria-hidden="true" tabindex="-1"></a>                          , <span class="st">"Data Type"</span></span>
<span id="cb84-86"><a href="#cb84-86" aria-hidden="true" tabindex="-1"></a>                          , <span class="st">"NA Values"</span></span>
<span id="cb84-87"><a href="#cb84-87" aria-hidden="true" tabindex="-1"></a>                          , <span class="st">"Uniques"</span></span>
<span id="cb84-88"><a href="#cb84-88" aria-hidden="true" tabindex="-1"></a>                          , <span class="st">"LU"</span></span>
<span id="cb84-89"><a href="#cb84-89" aria-hidden="true" tabindex="-1"></a>                          , <span class="st">"Example"</span></span>
<span id="cb84-90"><a href="#cb84-90" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-91"><a href="#cb84-91" aria-hidden="true" tabindex="-1"></a>ZC.datasum02</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Column                      Data Type   NA Values Uniques LU Example   
 [1,] "YearStart"                 "integer"   0         12      0  2020      
 [2,] "Class"                     "character" 0         3       0  "Physi..."
 [3,] "Topic"                     "character" 0         3       0  "Physi..."
 [4,] "Question"                  "character" 0         9       0  "Perce..."
 [5,] "Data_Value"                "double"    9235      695     0  30.6      
 [6,] "Low_Confidence_Limit"      "double"    9235      666     0  29.4      
 [7,] "High_Confidence_Limit"     "double"    9235      761     0  31.8      
 [8,] "Sample_Size"               "integer"   9235      9761    0  31255     
 [9,] "AgeYears"                  "character" 0         7       0  "25 - 34" 
[10,] "Education"                 "character" 0         5       0  "High ..."
[11,] "Gender"                    "character" 0         3       0  "Female"  
[12,] "Income"                    "character" 0         8       0  "$50,0..."
[13,] "RaceEthnic"                "character" 0         9       0  "Hispanic"
[14,] "ClassID"                   "character" 0         3       0  "PA"      
[15,] "TopicID"                   "character" 0         3       0  "PA1"     
[16,] "QuestionID"                "character" 0         9       0  "Q047"    
[17,] "LocationID"                "integer"   0         55      1  59        
[18,] "StratificationCategoryId1" "character" 0         7       1  "RACE"    
[19,] "StratificationID1"         "character" 0         29      1  "RACEHIS" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">typeof</span>(ZC.datasum02)) <span class="co"># TDL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
</div>
<p><em>Once you have the data processed and cleaned, perform some exploratory/descriptive analysis on this cleaned dataset. Make some summary tables, produce some figures. Try to summarize each variable in a way that it can be described by a distribution. For instance if you have a categorical variable, show what % are in each category. If you have a continuous variable, make a plot to see if it’s approximately normal, then try to summarize it to determine its mean and standard deviation.</em></p>
<p><em>The idea is that your descriptive analysis will provide enough information for your classmate to make synthetic data that looks similar, along the lines discussed in the synthetic data module.</em></p>
<p><em>Remember to add both text to your Quarto file and comments into your code to explain what you are doing.</em></p>
<p>Now that the dataset has been whittled down to nineteen (19) pertinent columns, graphics for each column will be generated. Using the summary table from above, chart type will be chosen as follows:</p>
<ul>
<li>All columns with ten (10) or less unique values will be represented by a pie chart.</li>
<li>All columns with more than ten (10) but with twenty (20) or less unique values will be represented by a histogram (bar chart).</li>
<li>All other columns will be represented by a line plot.<br>
</li>
<li>Additionally, where the data is predetermined to be a continuous variable, a standard statistical summary will also be produced.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert summary table from list to dataframe</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>ZC.Summary <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ZC.datasum02)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create list of columns predetermined to contain values in a continuous variable</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>ZC.StatsPlease <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Data_Value"</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>                    , <span class="st">"Low_Confidence_Limit"</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>                    , <span class="st">"High_Confidence_Limit"</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>                    , <span class="st">"Sample_Size"</span>)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>ZC.StatsPlease <span class="ot">&lt;-</span> <span class="fu">unlist</span>(ZC.StatsPlease)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ZC.StatsPlease) <span class="co"># TDL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Data_Value"            "Low_Confidence_Limit"  "High_Confidence_Limit"
[4] "Sample_Size"          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">typeof</span>(ZC.StatsPlease)) <span class="co"># TDL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each of the columns</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>ZC.ChartColumns <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ZC.Summary)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ZC.ChartThis <span class="cf">in</span> ZC.ChartColumns)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Each value loaded is embedded in a one-item list, so it has to be unlisted before using</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load column name</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  ZC.ThisColumn <span class="ot">&lt;-</span> ZC.Summary<span class="sc">$</span>Column[ZC.ChartThis]</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  ZC.ThisColumn <span class="ot">&lt;-</span> <span class="fu">unlist</span>(ZC.ThisColumn)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load unique column count - determines chart type</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  ZC.ValueCount <span class="ot">&lt;-</span> ZC.Summary<span class="sc">$</span>Uniques[ZC.ChartThis]</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  ZC.ValueCount <span class="ot">&lt;-</span> <span class="fu">unlist</span>(ZC.ValueCount)</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># source of chart data will be the same regardless of chart type</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>  ZC.ThisQuery <span class="ot">&lt;-</span> <span class="fu">paste</span> (<span class="st">"select "</span></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>                           , ZC.ThisColumn</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>                           , <span class="st">" as Labels, count(*) as Occurs from 'ZC.data' "</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>                           , <span class="st">"group by "</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>                           , ZC.ThisColumn</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>                           , <span class="st">" order by "</span></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>                           , ZC.ThisColumn</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>                           , <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run the Query</span></span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>    ZC.DataTable <span class="ot">&lt;-</span> <span class="fu">sqldf</span>(ZC.ThisQuery)</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>    ZC.DataTable <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ZC.DataTable)</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>    ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Data for "</span></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a>                          , ZC.ThisColumn</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>                          , <span class="st">":"</span></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>                          , <span class="at">sep=</span><span class="st">""</span>) <span class="co"># TDL</span></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(ZC.printline) <span class="co"># TDL</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span>(ZC.ValueCount<span class="sc">&gt;</span><span class="dv">20</span>))</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(ZC.DataTable) <span class="co"># TDL</span></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>      ZC.printline <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Data suppressed.  "</span></span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>                            , ZC.ValueCount</span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>                            , <span class="st">" rows."</span></span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a>                            , <span class="at">sep=</span><span class="st">""</span></span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(ZC.printline)</span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(ZC.ValueCount<span class="sc">&gt;</span><span class="dv">10</span>))</span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drawing a pie chart</span></span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span>(ZC.ValueCount<span class="sc">&gt;</span><span class="dv">20</span>))</span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># building a histogram</span></span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span></span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drawing a distribution plot</span></span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># printing summary statistics?</span></span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if (grepl(ZC.ThisColumn, ZC.StatsPlease))</span></span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># {</span></span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a>      <span class="co"># print(summary(ZC.data[[ZC.ThisColumn]]))</span></span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># }</span></span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"******"</span>) <span class="co"># TDL</span></span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Data for YearStart:"
   Labels Occurs
1    2011  10192
2    2012   4368
3    2013  10248
4    2014   4536
5    2015  10584
6    2016   4620
7    2017  13860
8    2018   4620
9    2019  13365
10   2020   4536
11   2021   7700
12   2022   4620
[1] "******"
[1] "Data for Class:"
                   Labels Occurs
1   Fruits and Vegetables   9130
2 Obesity / Weight Status  36234
3       Physical Activity  47885
[1] "******"
[1] "Data for Topic:"
                            Labels Occurs
1 Fruits and Vegetables - Behavior   9130
2          Obesity / Weight Status  36234
3     Physical Activity - Behavior  47885
[1] "******"
[1] "Data for Question:"
                                                                                                                                                                                                                                                 Labels
1                                                                                                                                                                       Percent of adults aged 18 years and older who have an overweight classification
2                                                                                                                                                                                            Percent of adults aged 18 years and older who have obesity
3                                                  Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)
4 Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic physical activity and engage in muscle-strengthening activities on 2 or more days a week
5                                                 Percent of adults who achieve at least 300 minutes a week of moderate-intensity aerobic physical activity or 150 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)
6                                                                                                                                                              Percent of adults who engage in muscle-strengthening activities on 2 or more days a week
7                                                                                                                                                                                     Percent of adults who engage in no leisure-time physical activity
8                                                                                                                                                                                 Percent of adults who report consuming fruit less than one time daily
9                                                                                                                                                                            Percent of adults who report consuming vegetables less than one time daily
  Occurs
1  18117
2  18117
3   7449
4   7449
5   7449
6   7449
7  18089
8   4565
9   4565
[1] "******"
[1] "Data for Data_Value:"
[1] "Data suppressed.  695 rows."
[1] "******"
[1] "Data for Low_Confidence_Limit:"
[1] "Data suppressed.  666 rows."
[1] "******"
[1] "Data for High_Confidence_Limit:"
[1] "Data suppressed.  761 rows."
[1] "******"
[1] "Data for Sample_Size:"
[1] "Data suppressed.  9761 rows."
[1] "******"
[1] "Data for AgeYears:"
       Labels Occurs
1              73269
2     18 - 24   3330
3     25 - 34   3330
4     35 - 44   3330
5     45 - 54   3330
6     55 - 64   3330
7 65 or older   3330
[1] "******"
[1] "Data for Education:"
                            Labels Occurs
1                                   79929
2                 College graduate   3330
3             High school graduate   3330
4            Less than high school   3330
5 Some college or technical school   3330
[1] "******"
[1] "Data for Gender:"
  Labels Occurs
1         86589
2 Female   3330
3   Male   3330
[1] "******"
[1] "Data for Income:"
              Labels Occurs
1                     69939
2  $15,000 - $24,999   3330
3  $25,000 - $34,999   3330
4  $35,000 - $49,999   3330
5  $50,000 - $74,999   3330
6 $75,000 or greater   3330
7  Data not reported   3330
8  Less than $15,000   3330
[1] "******"
[1] "Data for RaceEthnic:"
                         Labels Occurs
1                                66609
2               2 or more races   3330
3 American Indian/Alaska Native   3330
4                         Asian   3330
5     Hawaiian/Pacific Islander   3330
6                      Hispanic   3330
7            Non-Hispanic Black   3330
8            Non-Hispanic White   3330
9                         Other   3330
[1] "******"
[1] "Data for ClassID:"
  Labels Occurs
1     FV   9130
2    OWS  36234
3     PA  47885
[1] "******"
[1] "Data for TopicID:"
  Labels Occurs
1    FV1   9130
2   OWS1  36234
3    PA1  47885
[1] "******"
[1] "Data for QuestionID:"
  Labels Occurs
1   Q018   4565
2   Q019   4565
3   Q036  18117
4   Q037  18117
5   Q043   7449
6   Q044   7449
7   Q045   7449
8   Q046   7449
9   Q047  18089
[1] "******"
[1] "Data for LocationID:"
[1] "Data suppressed.  55 rows."
[1] "******"
[1] "Data for StratificationCategoryId1:"
  Labels Occurs
1             9
2  AGEYR  19980
3    EDU  13320
4    GEN   6660
5    INC  23310
6    OVR   3330
7   RACE  26640
[1] "******"
[1] "Data for StratificationID1:"
[1] "Data suppressed.  29 rows."
[1] "******"</code></pre>
</div>
</div>
<p><em>In a final step, update the <code>_quarto.yml</code> file and include a menu item for “Data Analysis Exercise” pointing to the new file. Follow the format of the existing entries. Remember to be very careful about the right amount of empty space. Re-create your website and make sure it all works and the new project shows up on the website.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No code changes were made here for this part of the assignment.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Done.</p>
</section>
<section id="part-1-d-a-new-github-workflow" class="level3">
<h3 class="anchored" data-anchor-id="part-1-d-a-new-github-workflow">Part 1-d: A new GitHub Workflow</h3>
<p><em>If everything works as expected, commit and push your changes to GitHub. Instead of using the fork + pull-request workflow we’ve tried a few times, we’ll explore a different collaborative approach. In this approach, you and your collaborator work on the same repository. To that end, you need to add your classmate as collaborator. Go to Github.com, find your portfolio repository, go to <code>Settings</code>, then <code>Collaborators</code>. Choose <code>Add Collaborator</code> and add your classmate. Your classmate should receive an invitation, which they need to accept. With this, they are now able to directly push and pull to your repository, without them needing to create a fork. (You can remove them after this exercise if you don’t want them to be able to continue having write access to your repository).</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No code changes were made here for this part of the assignment.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Done.</p>
</section>
</section>
<section id="part-2" class="level2">
<h2 class="anchored" data-anchor-id="part-2">Part 2</h2>
<p>This section contributed by Aiden Sutherland</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># START - load needed libraries, install packages if needed.</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(synthpop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'synthpop' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Find out more at https://www.synthpop.org.uk/</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'mice' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'mice'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    cbind, rbind</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.3.3</code></pre>
</div>
</div>
<p>Here I created the synthetic data using synthpop, it is designed to create synthetic data.</p>
<p>here is a link to the website to read more about the package: https://www.synthpop.org.uk/about-synthpop.html</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>syn_data <span class="ot">&lt;-</span> <span class="fu">syn</span>(ZC.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Variable(s): Class, Topic, Question, AgeYears, Education, Gender, Income, RaceEthnic, ClassID, TopicID, QuestionID, StratificationCategoryId1, StratificationID1 have been changed for synthesis from character to factor.
Variables Class, Topic, ClassID, TopicID are collinear. Variables later in 'visit.sequence'
are derived from Class.


Synthesis
-----------
 YearStart Class Topic Question Data_Value Low_Confidence_Limit High_Confidence_Limit Sample_Size AgeYears Education
 Gender Income RaceEthnic ClassID TopicID QuestionID LocationID StratificationCategoryId1 StratificationID1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>synthetic_ZC <span class="ot">&lt;-</span> syn_data<span class="sc">$</span>syn</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(synthetic_ZC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  YearStart                   Class                        Topic
1      2019       Physical Activity Physical Activity - Behavior
2      2013       Physical Activity Physical Activity - Behavior
3      2017       Physical Activity Physical Activity - Behavior
4      2019 Obesity / Weight Status      Obesity / Weight Status
5      2011       Physical Activity Physical Activity - Behavior
6      2016 Obesity / Weight Status      Obesity / Weight Status
                                                                                  Question
1                        Percent of adults who engage in no leisure-time physical activity
2 Percent of adults who engage in muscle-strengthening activities on 2 or more days a week
3                        Percent of adults who engage in no leisure-time physical activity
4          Percent of adults aged 18 years and older who have an overweight classification
5                        Percent of adults who engage in no leisure-time physical activity
6          Percent of adults aged 18 years and older who have an overweight classification
  Data_Value Low_Confidence_Limit High_Confidence_Limit Sample_Size AgeYears
1       20.9                 17.7                  24.5         906         
2       25.6                 23.4                  27.9        4279         
3       32.3                 26.3                  39.2         348         
4         NA                   NA                    NA          NA         
5       16.0                 13.8                  18.3        1900         
6       36.7                 29.5                  44.8         322         
              Education Gender Income RaceEthnic ClassID TopicID QuestionID
1  High school graduate                               PA     PA1       Q047
2                       Female                        PA     PA1       Q046
3                                       Hispanic      PA     PA1       Q047
4                                          Asian     OWS    OWS1       Q037
5      College graduate                               PA     PA1       Q047
6 Less than high school                              OWS    OWS1       Q037
  LocationID StratificationCategoryId1 StratificationID1
1          5                       EDU         EDUHSGRAD
2         20                       GEN            FEMALE
3         29                      RACE           RACEHIS
4         30                      RACE           RACEASN
5         32                       EDU         EDUCOGRAD
6         55                       EDU             EDUHS</code></pre>
</div>
</div>
<p>In order to have some visualizations, I am converting the character variable types to factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>chr_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(synthetic_ZC)[<span class="fu">sapply</span>(synthetic_ZC, is.character)]</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>synthetic_ZC[chr_vars] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(synthetic_ZC[chr_vars], factor)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(synthetic_ZC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   93249 obs. of  19 variables:
 $ YearStart                : int  2019 2013 2017 2019 2011 2016 2019 2019 2011 2017 ...
 $ Class                    : Factor w/ 3 levels "Fruits and Vegetables",..: 3 3 3 2 3 2 2 1 2 3 ...
 $ Topic                    : Factor w/ 3 levels "Fruits and Vegetables - Behavior",..: 3 3 3 2 3 2 2 1 2 3 ...
 $ Question                 : Factor w/ 9 levels "Percent of adults aged 18 years and older who have an overweight classification",..: 7 6 7 1 7 1 2 9 2 4 ...
 $ Data_Value               : num  20.9 25.6 32.3 NA 16 36.7 30.9 13.4 30.5 12.1 ...
 $ Low_Confidence_Limit     : num  17.7 23.4 26.3 NA 13.8 29.5 28.1 9.9 26.9 4 ...
 $ High_Confidence_Limit    : num  24.5 27.9 39.2 NA 18.3 44.8 33.7 17.6 34.3 31.1 ...
 $ Sample_Size              : int  906 4279 348 NA 1900 322 1969 335 1064 58 ...
 $ AgeYears                 : Factor w/ 7 levels "","18 - 24","25 - 34",..: 1 1 1 1 1 1 1 1 6 1 ...
 $ Education                : Factor w/ 5 levels "","College graduate",..: 3 1 1 1 2 4 1 1 1 1 ...
 $ Gender                   : Factor w/ 3 levels "","Female","Male": 1 2 1 1 1 1 3 1 1 1 ...
 $ Income                   : Factor w/ 8 levels "","$15,000 - $24,999",..: 1 1 1 1 1 1 1 2 1 1 ...
 $ RaceEthnic               : Factor w/ 9 levels "","2 or more races",..: 1 1 6 4 1 1 1 1 1 3 ...
 $ ClassID                  : Factor w/ 3 levels "FV","OWS","PA": 3 3 3 2 3 2 2 1 2 3 ...
 $ TopicID                  : Factor w/ 3 levels "FV1","OWS1","PA1": 3 3 3 2 3 2 2 1 2 3 ...
 $ QuestionID               : Factor w/ 9 levels "Q018","Q019",..: 9 8 9 4 9 4 3 2 3 6 ...
 $ LocationID               : num  5 20 29 30 32 55 42 13 2 56 ...
 $ StratificationCategoryId1: Factor w/ 7 levels "","AGEYR","EDU",..: 3 4 7 7 3 3 4 5 2 7 ...
 $ StratificationID1        : Factor w/ 29 levels "","AGEYR1824",..: 11 12 25 23 8 10 20 13 6 27 ...</code></pre>
</div>
</div>
<p>Below I will now provide some summaries and visualizations of the data.</p>
<p>Here are the visualizations for the categorical variables from the synthetic dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify categorical and continuous variables</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>categorical_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(synthetic_ZC)[<span class="fu">sapply</span>(synthetic_ZC, is.factor)]</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>continuous_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(synthetic_ZC)[<span class="fu">sapply</span>(synthetic_ZC, is.numeric)]</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize categorical variables (bar plots)</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var <span class="cf">in</span> categorical_vars) {</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(synthetic_ZC, <span class="fu">aes_string</span>(<span class="at">x =</span> var)) <span class="sc">+</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Bar Plot of"</span>, var), <span class="at">x =</span> var, <span class="at">y =</span> <span class="st">"Count"</span>)</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `aes_string()` was deprecated in ggplot2 3.0.0.
ℹ Please use tidy evaluation idioms with `aes()`.
ℹ See also `vignette("ggplot2-in-packages")` for more information.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercise_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercise_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercise_files/figure-html/unnamed-chunk-31-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercise_files/figure-html/unnamed-chunk-31-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercise_files/figure-html/unnamed-chunk-31-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercise_files/figure-html/unnamed-chunk-31-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercise_files/figure-html/unnamed-chunk-31-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercise_files/figure-html/unnamed-chunk-31-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercise_files/figure-html/unnamed-chunk-31-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercise_files/figure-html/unnamed-chunk-31-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercise_files/figure-html/unnamed-chunk-31-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercise_files/figure-html/unnamed-chunk-31-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercise_files/figure-html/unnamed-chunk-31-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here is a summary of the continuous variables from the synthetic dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(synthetic_ZC[continuous_vars])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   YearStart      Data_Value    Low_Confidence_Limit High_Confidence_Limit
 Min.   :2011   Min.   : 0.90   Min.   : 0.30        Min.   : 3.00        
 1st Qu.:2013   1st Qu.:24.80   1st Qu.:20.40        1st Qu.:29.10        
 Median :2017   Median :31.40   Median :27.10        Median :36.20        
 Mean   :2016   Mean   :31.46   Mean   :27.11        Mean   :36.38        
 3rd Qu.:2019   3rd Qu.:37.10   3rd Qu.:33.00        3rd Qu.:42.30        
 Max.   :2022   Max.   :73.80   Max.   :70.20        Max.   :87.70        
                NA's   :9170    NA's   :9170         NA's   :9170         
  Sample_Size       LocationID   
 Min.   :    50   Min.   : 1.00  
 1st Qu.:   511   1st Qu.:17.00  
 Median :  1108   Median :30.00  
 Mean   :  3566   Mean   :30.89  
 3rd Qu.:  2386   3rd Qu.:45.00  
 Max.   :470531   Max.   :78.00  
 NA's   :9170                    </code></pre>
</div>
</div>
</section>
<section id="end-of-assignment-5" class="level2">
<h2 class="anchored" data-anchor-id="end-of-assignment-5">END of Assignment #5</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assignment 5 - </span><span class="re">END</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Go Roadrunners!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>