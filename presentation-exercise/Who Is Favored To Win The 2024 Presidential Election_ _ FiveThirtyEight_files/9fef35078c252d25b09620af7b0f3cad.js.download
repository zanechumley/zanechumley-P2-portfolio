Bootstrapper.bindDependencyImmediate(function(){var Bootstrapper=window["Bootstrapper"];var ensightenOptions=Bootstrapper.ensightenOptions;__dataLayer.media=__dataLayer.media||{};function is_muted(player){if(player)if(typeof player.muted==="boolean")return player.muted;else if(typeof player.muted==="function")return player.muted();return"N/A"}function get_duration(mediaItem,player){if(mediaItem){if(mediaItem.duration){var duration=Number(mediaItem.duration);if(isNaN(duration))return 0;if(duration>
9999)return Math.floor(duration/1E3);return duration}if(mediaItem.streamType==="live"&&!/24x7_news/.test(mediaItem.externalId))return 86400}if(player&&player.cache_&&player.cache_.duration)return player.cache_.duration;return 0}function get_screen_orientation(){if(screen&&screen.orientation&&screen.orientation.type)return screen.orientation.type;var mql=window.matchMedia("(orientation: portrait)");if(mql.matches)return"portrait";else return"landscape"}function get_player_name(player){if(player.techOptions&&
player.techOptions.tech)return player.techOptions.tech;return"Unified_TMS"}function get_gma_asset_name(omn,vs){omn=omn||{};var asv="";vs.forEach(function(v){if(asv)return;if(omn[v]){var asf=omn[v]||"";if(asf.indexOf("|")>-1){var cv=asf.split("|");asv=cv[1]||""}}});return asv}function get_network(mediaItem){if(mediaItem.network&&mediaItem.network.brand)return mediaItem.network.brand;if(mediaItem.trackingName!==undefined)return mediaItem.trackingName;if(mediaItem.network&&mediaItem.network.name!==undefined)return mediaItem.network.name;
return"N/A"}function get_media_name(mediaItem,isTVE){var mediaTitle=mediaItem&&mediaItem.title,isESPN=__dataLayer&&__dataLayer.space==="espn";if(isESPN)return mediaItem&&mediaItem.tracking&&mediaItem.tracking.heartbeats&&mediaItem.tracking.heartbeats.CMSID||mediaItem.title||"N/A";return isTVE&&__dataLayer.media.episodeName!=="N/A"?__dataLayer.media.episodeName:mediaItem.title||"N/A"}var isTVE=false,isMarvel=false;if(window.location.hostname.indexOf("marvel.com")>-1)isMarvel=true;else if(window.location.hostname.match(/(abc|fftv|freeform|fxtv|ngtv|fxnetworks|watchdisney)(fe(sb|qa)?)?\.com$/)&&
window.location.hostname.indexOf("abc6")===-1)isTVE=true;else if(window.location.href.indexOf("nationalgeographic.com/tv")>-1)isTVE=true;__dataLayer.updateMedia=function(playerDLname,eventName,eventData,currentPlayer){if(typeof currentPlayer!=="object"){Bootstrapper.Logging.logMsg("Failed to locate proper media player data in passed parameters. Exiting updateMedia function.");return}if(playerDLname==="dtci.media"){var bundle=currentPlayer.bundle_||{},configs=bundle.configs_||{},rawMediaItem=configs.mediaItem||
{},player=bundle.player_||{},dcfConfigs=bundle.dcfConfigs||{},mediaItem=player.mediaItem||{},tracking=mediaItem.tracking||{},conviva=tracking.conviva||{},omniture=tracking.omniture||{},heartbeats=tracking.heartbeats||{},nielsen=tracking.nielsen||{},mediainfo=player.mediainfo||{},ima3=player.ima3||{},currentAdEventInfo=ima3.currentAdEventInfo||{},adPosition=window.adPosition&&window.adPosition.toString(),show=mediaItem.show||{},mediaType=mediaItem.mediaType||{},page=__dataLayer.page||{},site=__dataLayer.site||
{};if(isMarvel){var adInfo=configs.advertisingInfo||{};__dataLayer.media.kitchensink={"raw":rawMediaItem,"ads":adInfo}}__dataLayer.media.dcfConfigs=dcfConfigs;if(currentAdEventInfo.adId!==undefined){__dataLayer.media.ad_id=currentAdEventInfo.adId&&currentAdEventInfo.adId[adPosition-1]||"N/A";__dataLayer.media.ad_length=currentAdEventInfo.creativeLength&&currentAdEventInfo.creativeLength[adPosition-1]||"N/A";__dataLayer.media.ad_name=currentAdEventInfo.adTitle&&currentAdEventInfo.adTitle[adPosition-
1]||"N/A";__dataLayer.media.ad_type=currentAdEventInfo.adType||"N/A";__dataLayer.media.ad_player=currentAdEventInfo.adSystem&&currentAdEventInfo.adSystem[adPosition-1]||"";__dataLayer.media.ad_position=adPosition||"1";__dataLayer.media.ad_creativeId=currentAdEventInfo.creativeId&&currentAdEventInfo.creativeId[adPosition-1]||"";__dataLayer.media.ad_creativeUrl=currentAdEventInfo.creativeUrl&&currentAdEventInfo.creativeUrl[adPosition-1]||""}else{var ima=player.ima||{},adsManager=ima.getAdsManager&&
ima.getAdsManager()||{},currentAd=adsManager.getCurrentAd&&adsManager.getCurrentAd(),podIndex=0;if(currentAd!=null&&currentAd.getAdId){podIndex=currentAd.getAdPodInfo().data.podIndex||0;__dataLayer.media.ad_id=currentAd.getAdId()||"N/A";__dataLayer.media.ad_length=currentAd.getDuration()||0;__dataLayer.media.ad_name=currentAd.getTitle()||"N/A";__dataLayer.media.ad_type=podIndex>0?"midroll":"preroll";__dataLayer.media.ad_player=currentAd.getAdSystem()||"N/A";__dataLayer.media.ad_position=adPosition||
"1";__dataLayer.media.ad_creativeId=currentAd.getCreativeAdId()||currentAd.getCreativeId()||"N/A";__dataLayer.media.ad_creativeUrl=currentAd.getMediaUrl()||"N/A"}else currentAd={}}__dataLayer.media.player_id=player.id_||currentPlayer.guid;__dataLayer.media.adLoadType=nielsen.adloadtype||(mediaItem.entityType!=="shortform"?1:2);__dataLayer.media.air_date=heartbeats.PublishDate||heartbeats.AirDate||page.isoAirDate||mediaItem.isoAirDate||"N/A";__dataLayer.media.airing_id=mediaItem.id&&mediaItem.title?
`${mediaItem.id}:${mediaItem.title}`:"N/A";__dataLayer.media.affiliate_name=mediainfo.affiliate||"N/A";__dataLayer.media.app_version=mediaItem.playerVersion||"none";__dataLayer.media.authentication_status="";__dataLayer.media.channelCount=mediaItem.channelCount||"N/A";__dataLayer.media.collection_name=mediaItem.streamType==="live"?mediaItem.collection_name||"N/A":page.collection_name||"N/A";__dataLayer.media.content_language=mediaItem.language||"N/A";__dataLayer.media.content_lock_flag=mediaItem.gated||
"N/A";__dataLayer.media.daypart=show.dayPart||page.daypart||"N/A";__dataLayer.media.description=mediaItem.description||"N/A";__dataLayer.media.digital_date=page.isoAvailableDate||mediaItem.digital_date||mediaItem.firstPresented||"N/A";__dataLayer.media.episode=mediainfo.eventId||"N/A";__dataLayer.media.episodeName=mediaItem.episodeName||"N/A";__dataLayer.media.episodeNumber=mediaItem.episodeNumber||"N/A";__dataLayer.media.feed=mediaItem.network&&mediaItem.network.name||"none";__dataLayer.media.fName=
rawMediaItem.name||"N/A";__dataLayer.media.format=mediaItem.streamType||"N/A";__dataLayer.media.contentType=mediaItem.contentType||mediaItem.streamType;__dataLayer.media.full_episode=mediaItem.entityType&&mediaItem.entityType==="longform"?"y":"n";__dataLayer.media.genre=mediaItem.videoShowGenre||mediaItem.genre||conviva["ns_st_ge"]||show.genre||"";__dataLayer.media.is_mute=is_muted(player);__dataLayer.media.league=page.league||"N/A";__dataLayer.media.length=__dataLayer.media.duration=get_duration(mediaItem,
player);__dataLayer.media.media_id=mediaItem.id&&mediaItem.id.toString()||"";__dataLayer.media.media_name=get_media_name(mediaItem,isTVE);__dataLayer.media.module_position_number=mediaItem.module_position_number;__dataLayer.media.network=get_network(mediaItem);__dataLayer.media.orientation=get_screen_orientation()||"";__dataLayer.media.placement=mediaItem.placement||"";__dataLayer.media.play_location=heartbeats.PlayLocation||"";__dataLayer.media.player_name=currentPlayer.playerName?currentPlayer.playerName:
get_player_name(player);__dataLayer.media.prefix=show.showPrefix||"N/A";__dataLayer.media.program=mediaItem.program||mediaItem.title||"N/A";__dataLayer.media.rating=mediaItem.tvrating||"N/A";__dataLayer.media.season=mediaItem.seasonNumber||"N/A";__dataLayer.media.seekInSeconds=mediaItem.seekInSeconds||"N/A";__dataLayer.media.show_type=isTVE?mediaItem.showType||"N/A":mediaItem.entityType||"N/A";__dataLayer.media.sport=mediaItem.sportName||"N/A";__dataLayer.media.startingProgress=mediaItem.startingProgress||
"N/A";__dataLayer.media.start_type=page.start_type||bundle.startType||mediainfo.startType||"N/A";__dataLayer.media.streamtypedetail=mediaItem.streamType==="vod"&&heartbeats.VideoTypeDetail?heartbeats.VideoTypeDetail:mediaItem.streamType;__dataLayer.media.title=show.title||heartbeats["a.media.show"]||"N/A";__dataLayer.media.track_code=mediaItem.trackCode||"";__dataLayer.media.trackTitle=show.trackTitle||"N/A";__dataLayer.media.type=mediaItem.type||"N/A";__dataLayer.media.videoOrigin=page.originator||
"N/A";__dataLayer.media.video_binge_play_count="";__dataLayer.media.video_detail=mediaType.mediaType||"";__dataLayer.media.video_domain="";__dataLayer.media.video_episode_release_date=mediaItem.availableDate||"";__dataLayer.media.video_first_consumption="";__dataLayer.media.video_saved_list_content="";__dataLayer.media.video_start_source="";__dataLayer.media.date_modified=mediaItem.dateModified||"N/A";__dataLayer.media.first_published=mediaItem.firstPub||"N/A";__dataLayer.media.author=mediaItem.author||
"N/A";__dataLayer.media.external_id=mediaItem.externalId||"";__dataLayer.media.asset_title=mediaItem.title||"";__dataLayer.media.location=mediaItem.location||"N/A";__dataLayer.media.originator=mediaItem.originator||page.originator||"N/A";__dataLayer.media.originating_station=mediaItem.originating_station||"N/A";__dataLayer.media.hic_category=mediaItem.hicCategory||"N/A";__dataLayer.media.view_type=mediaItem.viewType||"N/A";__dataLayer.media.m3u8=mediaItem.source&&mediaItem.source.url||"N/A";__dataLayer.media.tags=
mediaItem.tags||conviva.tags||"N/A";__dataLayer.media.date_viewed=mediaItem.dateViewed;__dataLayer.media.keywords=mediaItem.keywords||player.tagAttributes&&player.tagAttributes.class;__dataLayer.media.topic=mediaItem.topic;__dataLayer.media.stationTitle=mediaItem.stationTitle||"";__dataLayer.media.tms_id=mediaItem.tmsid||"";__dataLayer.media.is_live=mediaItem.video_isLive?mediaItem.video_isLive:mediaItem.isLive||false;__dataLayer.media.is_breaking=mediaItem.video_isBreaking||false;__dataLayer.media.game_id=
heartbeats.GameID||"";__dataLayer.media.video_type=heartbeats.VideoType||"";__dataLayer.media.asset_name=conviva.assetName||"";if(site.site==="gma"){var altasn=get_gma_asset_name(omniture,["eVar2","prop3"]);if(altasn)__dataLayer.media.asset_name=altasn}if(__dataLayer.space==="abc-otv")if(__dataLayer.media.full_episode==="y"){__dataLayer.media.media_id=mediaItem.network&&mediaItem.network.resource||"";__dataLayer.media.friendlyName=mediaItem.title||"N/A";__dataLayer.media.show=mediaItem.show||"N/A";
__dataLayer.media.season=mediaItem.seasonNumber||"N/A";__dataLayer.media.episode=mediaItem.episodeNumber||"N/A";__dataLayer.media.type="4";__dataLayer.media.date_modified=heartbeats.dateModified||"N/A";__dataLayer.media.first_published=heartbeats.firstPub||"N/A";__dataLayer.media.externalId=heartbeats.externalId||"N/A";__dataLayer.media.originating_station=heartbeats.originating_station||"N/A";__dataLayer.media.tags=heartbeats.tags||"N/A";__dataLayer.media.topic=heartbeats.topic;__dataLayer.media.view_type=
heartbeats.viewType||"N/A"}__dataLayer.media.video_size=omniture.eVar29||""}else if(v2player);else if(hudsonPlayer);document.dispatchEvent(new Event("tms.media.ready"))};Bootstrapper.register("datalayer")},4044769,[4010591,4044017,4053064,4011933],667991,[645040,671423,683385,763742],-1);
Bootstrapper.bindDependencyImmediate(function(){var Bootstrapper=window["Bootstrapper"];var ensightenOptions=Bootstrapper.ensightenOptions;__dataLayer.privacy=__dataLayer.privacy||{};__dataLayer.updatePrivacyMeta=function(){if(!Bootstrapper.Cookies&&typeof Bootstrapper.Cookies.get!=="function")return;var ccf=Bootstrapper.Cookies.get;var dl=__dataLayer,p=dl.privacy,mode=ccf("s_ensRegion"),dcf=ccf("_dcf"),uspriv=ccf("usprivacy"),extraParams=typeof Bootstrapper.getExtraParams==="function"?Bootstrapper.getExtraParams():
{},cds=extraParams.cds||null,gpc=ccf("s_ensNSL")||null;if(p.noniab)p.consent=(window.OnetrustActiveGroups===",,"?",C0001,":window.OnetrustActiveGroups)||null;else p.consent=mode==="ccpa"?uspriv:dcf;p.gdpr=mode==="gdpr"?dcf:null;p.ccpa=mode==="ccpa"?uspriv:null;p.notice=mode==="notice"?dcf:null;p.cds=cds;p.gpc=gpc;p.mode=mode};__dataLayer.updatePrivacyMeta();Bootstrapper.register("privacydl")},3992071,[4010591,4044017,4053064,4011933],696873,[645040,671423,683385,763742],-1);
Bootstrapper.bindDependencyImmediate(function(){var Bootstrapper=window["Bootstrapper"];var ensightenOptions=Bootstrapper.ensightenOptions;!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):window.ADB=t()}(this,function(){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?
"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");}function a(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=
Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach(function(t){r(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function o(e){return(o=
Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function u(e,t){return!t||"object"!=typeof t&&"function"!=
typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(){var e=0;return{getUniqueId:function(){return e+=1}}}var h=Object.freeze({AdBreakStart:"adBreakStart",AdBreakComplete:"adBreakComplete",AdStart:"adStart",AdComplete:"adComplete",AdSkip:"adSkip",ChapterStart:"chapterStart",ChapterComplete:"chapterComplete",ChapterSkip:"chapterSkip",SeekStart:"seekStart",SeekComplete:"seekComplete",BufferStart:"bufferStart",
BufferComplete:"bufferComplete",BitrateChange:"bitrateChange",StateStart:"stateStart",StateEnd:"stateEnd"}),f=Object.freeze({MediaResumed:"media.resumed",GranularAdTracking:"media.granularadtracking"}),p=Object.freeze({Video:"video",Audio:"audio"}),m=Object.freeze({FullScreen:"fullScreen",ClosedCaption:"closedCaptioning",Mute:"mute",PictureInPicture:"pictureInPicture",InFocus:"inFocus"}),_=Object.freeze({Show:"a.media.show",Season:"a.media.season",Episode:"a.media.episode",AssetId:"a.media.asset",
Genre:"a.media.genre",FirstAirDate:"a.media.airDate",FirstDigitalDate:"a.media.digitalDate",Rating:"a.media.rating",Originator:"a.media.originator",Network:"a.media.network",ShowType:"a.media.type",AdLoad:"a.media.adLoad",MVPD:"a.media.pass.mvpd",Authorized:"a.media.pass.auth",DayPart:"a.media.dayPart",Feed:"a.media.feed",StreamFormat:"a.media.format"}),v=Object.freeze({Artist:"a.media.artist",Album:"a.media.album",Label:"a.media.label",Author:"a.media.author",Station:"a.media.station",Publisher:"a.media.publisher"}),
k=Object.freeze({Advertiser:"a.media.ad.advertiser",CampaignId:"a.media.ad.campaign",CreativeId:"a.media.ad.creative",PlacementId:"a.media.ad.placement",SiteId:"a.media.ad.site",CreativeUrl:"a.media.ad.creativeURL"}),y=Object.freeze({VOD:"vod",Live:"live",Linear:"linear",Podcast:"podcast",Audiobook:"audiobook",AOD:"aod"}),g=Object.freeze({OptOut:"optout",OptIn:"optin",OptUnknown:"optunknown"}),S=function(e){return null==e},P=Object.freeze({Log:"log",Info:"info",Warn:"warn",Error:"error"}),I=function(e){return"boolean"==
typeof e},A=function(e){return"string"==typeof e},b=function(e){return A(e)&&e.length>0};function E(){return(new Date).getTime()}function C(e,t){if(window.console){var a;switch(e){case P.Log:a=window.console.log;break;case P.Info:a=window.console.info;break;case P.Warn:a=window.console.warn;break;case P.Error:a=window.console.error}if(a)a("MediaSDK: ["+function(){var e=new Date,t=function(e){return e<10?"00"+e:e<100?"0"+e:""+e}(e.getMilliseconds());return e.toTimeString()+"."+t}()+"] "+t)}}function M(e,
t){return setInterval(e,t)}var w=!1;function T(e){var t=e.debugLogging;I(t)&&(w=t)}function O(e,t,a){(w||e===P.Error)&&C(e,t+" "+a)}function R(e){var t=b(e)?"["+e+"]":"";return{log:function(e){!function(e,t){O(P.Log,e,t)}(t,e)},info:function(e){!function(e,t){O(P.Info,e,t)}(t,e)},warn:function(e){!function(e,t){O(P.Warn,e,t)}(t,e)},error:function(e){!function(e,t){O(P.Error,e,t)}(t,e)}}}var B=Object.freeze({AnalyticsTrackingServer:"analyticstrackingserver",AnalyticsSsl:"analyticsssl",Rsid:"rsid",
Vid:"vid",Aid:"aid",Mcid:"mid",McOrgId:"orgid",AamLocHint:"aamlochint",CustomerIds:"customerids",MediaTrackingServer:"mediatrackingserver",MediaChannel:"mediachannel",MediaPlayerName:"mediaplayername",MediaAppVersion:"mediaappversion",MediaSsl:"mediassl"}),z=Object.freeze({Get:"GET",Post:"POST"}),j=Object.freeze({SessionStart:"sessionStart",SessionComplete:"sessionComplete",SessionEnd:"sessionEnd",AdBreakStart:"adBreakStart",AdBreakComplete:"adBreakComplete",AdStart:"adStart",AdComplete:"adComplete",
AdSkip:"adSkip",ChapterStart:"chapterStart",ChapterComplete:"chapterComplete",ChapterSkip:"chapterSkip",Play:"play",Ping:"ping",BufferStart:"bufferStart",PauseStart:"pauseStart",BitrateChange:"bitrateChange",Error:"error",StateStart:"stateStart",StateEnd:"stateEnd"}),D=Object.freeze({Show:"media.show",Season:"media.season",Episode:"media.episode",AssetId:"media.assetId",Genre:"media.genre",FirstAirDate:"media.firstAirDate",FirstDigitalDate:"media.firstDigitalDate",Rating:"media.rating",Originator:"media.originator",
Network:"media.network",ShowType:"media.showType",AdLoad:"media.adLoad",MVPD:"media.pass.mvpd",Auth:"media.pass.auth",DayPart:"media.dayPart",Feed:"media.feed",StreamFormat:"media.streamFormat",Artist:"media.artist",Album:"media.album",Label:"media.label",Author:"media.author",Station:"media.station",Publisher:"media.publisher"}),V=Object.freeze({Advertiser:"media.ad.advertiser",CampaignId:"media.ad.campaignId",CreativeId:"media.ad.creativeId",SiteId:"media.ad.siteId",CreativeUrl:"media.ad.creativeURL",
PlacementId:"media.ad.placementId"}),q=Object.freeze({Id:"media.id",Name:"media.name",Length:"media.length",ContentType:"media.contentType",StreamType:"media.streamType",PlayerName:"media.playerName",Resume:"media.resume",Channel:"media.channel",Publisher:"media.publisher",SdkVersion:"media.sdkVersion"}),x=Object.freeze({AppInstallationId:"appInstallationId",AnalyticsTrackingServer:"analytics.trackingServer",AnalyticsRsid:"analytics.reportSuite",AnalyticsSsl:"analytics.enableSSL",AnalyticsVisitorId:"analytics.visitorId",
AnalyticsAid:"analytics.aid",VisitorMcOrgId:"visitor.marketingCloudOrgId",VisitorMcuserId:"visitor.marketingCloudUserId",VisitorAamLocHint:"visitor.aamLocationHint",VisitorCustomerIds:"visitor.customerIDs",VisitorCustomerKeyId:"id",VisitorCustomerKeyAuthState:"authState",MediaVersion:"media.libraryVersion"}),N=Object.freeze({Channel:"media.channel"}),F=Object.freeze({PodFriendlyName:"media.ad.podFriendlyName",PodIndex:"media.ad.podIndex",PodSecond:"media.ad.podSecond"}),L=Object.freeze({Name:"media.ad.name",
Id:"media.ad.id",Length:"media.ad.length",PodPosition:"media.ad.podPosition",PlayerName:"media.ad.playerName"}),G=Object.freeze({FriendlyName:"media.chapter.friendlyName",Length:"media.chapter.length",Offset:"media.chapter.offset",Index:"media.chapter.index"}),H=Object.freeze({StateName:"media.state.name"}),Q=Object.freeze({Bitrate:"media.qoe.bitrate",DroppedFrames:"media.qoe.droppedFrames",Fps:"media.qoe.framesPerSecond",StartupTime:"media.qoe.timeToStart",ErrorId:"media.qoe.errorID",ErrorSource:"media.qoe.errorSource",
ErrorSourcePlayer:"player",ErrorSourceExternal:"external"}),U=Object.freeze({EventType:"eventType",Params:"params",QoE:"qoeData",CustomMetadata:"customMetadata",PlayerTime:"playerTime"}),K=Object.freeze({Playhead:"playhead",Ts:"ts"}),W=function(e){return 0===Object.keys(e).length},Z=function(e){return"number"==typeof e&&!isNaN(e)},$=function(e){var t=parseInt(e,10);return Z(t)&&e===t},J=function(t){return!S(t)&&!Array.isArray(t)&&"object"===e(t)},X=function(e){return"function"==typeof e},Y=function(e,
t){if(!X(e))return t;try{return e()}catch(e){return t}};function ee(e){var t={};return J(e)&&Object.keys(e).forEach(function(a){var i=e[a],r=i.id,n=i.authState,s=void 0===n?0:n;b(r)&&(t[a]={id:r,authState:s})}),t}function te(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r({},U.EventType,e.eventType);i[U.PlayerTime]=(r(t={},K.Playhead,e.playhead),r(t,K.Ts,e.ts),t),W(e.customMetadata)||(i[U.CustomMetadata]=e.customMetadata),W(e.qoeData)||(i[U.QoE]=e.qoeData);var n=s({},e.params);
if(e.eventType===j.SessionStart){b(a[B.AnalyticsTrackingServer])&&(n[x.AnalyticsTrackingServer]=a[B.AnalyticsTrackingServer]),b(a[B.Rsid])&&(n[x.AnalyticsRsid]=a[B.Rsid]),I(a[B.AnalyticsSsl])&&(n[x.AnalyticsSsl]=a[B.AnalyticsSsl]),b(a[B.Vid])&&(n[x.AnalyticsVisitorId]=a[B.Vid]),b(a[B.Aid])&&(n[x.AnalyticsAid]=a[B.Aid]),b(a[B.McOrgId])&&(n[x.VisitorMcOrgId]=a[B.McOrgId]),b(a[B.Mcid])&&(n[x.VisitorMcuserId]=a[B.Mcid]),$(a[B.AamLocHint])&&(n[x.VisitorAamLocHint]=a[B.AamLocHint]);var o=ee(a[B.CustomerIds]);
if(J(o)&&!W(o)&&(n[x.VisitorCustomerIds]=o),!b(n[q.Channel])){var d=a[B.MediaChannel];n[q.Channel]=b(d)?d:"unknown"}var c=a[B.MediaPlayerName];n[q.PlayerName]=b(c)?c:"unknown",b(a[B.MediaAppVersion])&&(n[q.SdkVersion]=a[B.MediaAppVersion]),n[x.MediaVersion]="js-3.0.1"}else if(e.eventType===j.AdStart){var u=a[B.MediaPlayerName];n[L.PlayerName]=b(u)?u:"unknown"}W(n)||(i[U.Params]=n);var l=Y(function(){return JSON.stringify(i)},"");return l}function ae(e){try{var t=e.split("/");return t[4]?t[4]:""}catch(e){return""}}
var ie=[B.AnalyticsTrackingServer,B.AnalyticsSsl,B.Rsid,B.Vid,B.Aid,B.Mcid,B.McOrgId,B.AamLocHint,B.CustomerIds,B.MediaChannel,B.MediaAppVersion,B.MediaPlayerName,B.MediaTrackingServer,B.MediaSsl],re=function(){function e(a){t(this,e),this._logger=R("MediaSession("+a+")"),this._hits=[],this._ecParams=null,this._sessionId=null,this._creatingMCSession=!1,this._createSessionFailureCount=0,this._internalError=!1,this._doneQueuing=!1}return i(e,[{key:"queue",value:function(e){this._internalError||this._doneQueuing||
this._hits.push(e)}},{key:"process",value:function(e){this._internalError||0!==this._hits.length&&e.isReady()&&(this._ecParams||(this._ecParams=e.resolveKeys(ie)),S(this._sessionId)?this._startMCSession():this._flushPendingHits())}},{key:"end",value:function(){this._logger.log("end"),this._doneQueuing=!0}},{key:"abort",value:function(){this._logger.log("abort"),this._doneQueuing=!0,this._hits=[]}},{key:"doneProcessing",value:function(){return this._internalError||this._doneQueuing&&0===this._hits.length}},
{key:"_startMCSession",value:function(){var e=this;if(!this._creatingMCSession){var t=this._hits[0];if(t.eventType!==j.SessionStart)return this._logger.log("Dropping hit("+t.eventType+") as we expected sessionStart"),void this._hits.shift();var a,i=((a=this._ecParams)[B.MediaSsl]?"https":"http")+"://"+a[B.MediaTrackingServer]+"/api/v1/sessions",r=te(t,this._ecParams);this._creatingMCSession=!0,this._sendRequest(i,z.Post,r,function(t,a){var i,r=!1;do{if(201!==t)break;var n=a.location;if(!b(n))break;
if(!(i=ae(n)))break;r=!0}while(0);r?(e._logger.log("Media collection session created with session id :  "+i),e._sessionId=i,e._hits.shift()):(e._logger.log("Creating Media collection session failed"),e._createSessionFailureCount+=1,e._createSessionFailureCount>=3&&(e._logger.log("Internal error: Creating Media collection session failed 3 times"),e._internalError=!0)),e._creatingMCSession=!1})}}},{key:"_flushPendingHits",value:function(){var e=this;this._hits.splice(0,3).forEach(function(t){var a,
i,r=(a=e._ecParams,i=e._sessionId,(a[B.MediaSsl]?"https":"http")+"://"+a[B.MediaTrackingServer]+"/api/v1/sessions/"+i+"/events"),n=te(t,e._ecParams);e._sendRequest(r,z.Post,n,function(){})})}},{key:"_sendRequest",value:function(e,t,a,i){!function(e,t,a,i){if(void 0!==window.XMLHttpRequest){var r=new window.XMLHttpRequest;if("withCredentials"in r){var n=r;return n.open(t,e,!0),n.timeout=5E3,n.onload=function(){var e=n.status&&parseInt(n.status,10),t=n.responseText,a=function(e){var t={};try{e.trim().split(/[\r\n]+/).forEach(function(e){var a=
e.split(":",1)[0],i=e.substring(a.length+2);a.length>0&&(t[a.toLowerCase()]=i)})}catch(e){}return t}(n.getAllResponseHeaders());i(e,a,t)},n.onerror=function(){i(0)},void n.send(a)}i(0)}}(e,t,a,i)}}]),e}(),ne=function(){function e(){t(this,e),this._logger=R("MediaProcessor"),this._isConfigured=!1,this._privacyStatus=g.OptUnknown,this._sessionIdGenerator=l(),this._sessionMap={}}return i(e,[{key:"configure",value:function(e){var t=this;this._isConfigured||(this._ecResolver=e,this._privacyStatus=this._ecResolver.getPrivacyStatus(),
this._ecResolver.notifyPrivacyChange(this._onPrivacyChange.bind(this)),this._isConfigured=!0,this._processSessionTimer=M(function(){t._tick()},500),this._logger.log("Configured with resolver"))}},{key:"startSession",value:function(){if(this._privacyStatus===g.OptOut)return this._logger.log("Privacy is opted out. Not starting a session"),-1;var t=this._sessionIdGenerator.getUniqueId();return this._sessionMap[t]=e._createMediaSession(t),t}},{key:"processHit",value:function(e,t){if(-1!==e){var a=this._sessionMap[e];
S(a)||(this._logger.log("Process hit for session("+e+") \x3d\x3e "+t),a.queue(t))}}},{key:"endSession",value:function(e){if(-1!==e){var t=this._sessionMap[e];S(t)||t.end()}}},{key:"_tick",value:function(){var e=this;Object.keys(this._sessionMap).forEach(function(t){var a=e._sessionMap[t];a.process(e._ecResolver),a.doneProcessing()&&(e._logger.log("Removing session "+t+" from store as it has finished processing"),delete e._sessionMap[t])})}},{key:"_onPrivacyChange",value:function(e){var t=this;this._logger.log("Privacy switched to "+
e),this._privacyStatus=e,e===g.OptOut&&(this._logger.log("Aborting all active sessions"),Object.keys(this._sessionMap).forEach(function(e){t._sessionMap[e].abort()}))}}],[{key:"_createMediaSession",value:function(e){return new re(e)}}]),e}(),se=function(){function e(a){var i=a.id,r=a.name,n=a.position,s=a.length;if(t(this,e),!b(i))throw new TypeError("id is not a valid string");if(!b(r))throw new TypeError("name is not a valid string");if(!$(n)||n<1)throw new TypeError("position should be a valid integer greater than zero");
if(!Z(s)||s<0)throw new TypeError("length cannot be less than zero");this.id=i,this.name=r,this.position=n,this.length=s}return i(e,[{key:"equal",value:function(t){return!S(t)&&t instanceof e&&(this.id===t.id&&this.name===t.name&&this.position===t.position&&this.length===t.length)}},{key:"serialize",value:function(){var e;return r(e={},"ad.id",this.id),r(e,"ad.name",this.name),r(e,"ad.position",this.position),r(e,"ad.length",this.length),e}}],[{key:"deserialize",value:function(t){return J(t)?Y(function(){return new e({id:t["ad.id"],
name:t["ad.name"],position:t["ad.position"],length:t["ad.length"]})},null):null}}]),e}(),oe=function(){function e(a){var i=a.name,r=a.position,n=a.startTime;if(t(this,e),!b(i))throw new TypeError("name is not a valid string");if(!$(r)||r<1)throw new TypeError("position should be a valid integer greater than zero");if(!Z(n)||n<0)throw new TypeError("startTime cannot be less than zero");this.name=i,this.position=r,this.startTime=n}return i(e,[{key:"equal",value:function(t){return!S(t)&&t instanceof
e&&(this.name===t.name&&this.position===t.position&&this.startTime===t.startTime)}},{key:"serialize",value:function(){var e;return r(e={},"adbreak.name",this.name),r(e,"adbreak.position",this.position),r(e,"adbreak.starttime",this.startTime),e}}],[{key:"deserialize",value:function(t){return J(t)?Y(function(){return new e({name:t["adbreak.name"],position:t["adbreak.position"],startTime:t["adbreak.starttime"]})},null):null}}]),e}(),de=function(){function e(a){var i=a.name,r=a.position,n=a.startTime,
s=a.length;if(t(this,e),!b(i))throw new TypeError("name is not a valid string");if(!$(r)||r<1)throw new TypeError("position should be a valid integer greater than zero");if(!Z(n)||n<0)throw new TypeError("startTime cannot be less than zero");if(!Z(s)||s<0)throw new TypeError("length cannot be less than zero");this.name=i,this.position=r,this.startTime=n,this.length=s}return i(e,[{key:"equal",value:function(t){return!S(t)&&t instanceof e&&(this.name===t.name&&this.position===t.position&&this.startTime===
t.startTime&&this.length===t.length)}},{key:"serialize",value:function(){var e;return r(e={},"chapter.name",this.name),r(e,"chapter.position",this.position),r(e,"chapter.starttime",this.startTime),r(e,"chapter.length",this.length),e}}],[{key:"deserialize",value:function(t){return J(t)?Y(function(){return new e({name:t["chapter.name"],position:t["chapter.position"],startTime:t["chapter.starttime"],length:t["chapter.length"]})},null):null}}]),e}(),ce=new RegExp("^[a-zA-Z0-9_\\.]{1,64}$"),ue=function(){function e(a){var i=
a.name;if(t(this,e),!b(i))throw new TypeError("name is not a valid string");if(!ce.test(i))throw new TypeError("name should match '^[a-zA-Z0-9_\\.]{1,64}$' pattern");this.name=i}return i(e,[{key:"equal",value:function(t){return!S(t)&&t instanceof e&&this.name===t.name}},{key:"serialize",value:function(){return r({},"customstate.name",this.name)}}],[{key:"deserialize",value:function(t){return J(t)?Y(function(){return new e({name:t["customstate.name"]})},null):null}}]),e}(),le=function(){function e(a){var i=
a.id,r=a.name,n=a.streamType,s=a.mediaType,o=a.length,d=a.resumed,c=a.prerollWaitTime,u=a.granularAdTracking;if(t(this,e),!b(i))throw new TypeError("id is not a valid string");if(!b(r))throw new TypeError("name is not a valid string");if(!b(n))throw new TypeError("streamType is not a valid string");if(!Z(o)||o<0)throw new TypeError("length cannot be less than zero");this.id=i,this.name=r,this.streamType=n,this.mediaType=s!==p.Audio?p.Video:s,this.length=o,this.resumed=!!I(d)&&d,this.prerollWaitTime=
!$(c)||c<0?250:c,this.granularAdTracking=!!I(u)&&u}return i(e,[{key:"equal",value:function(t){return!S(t)&&t instanceof e&&(this.id===t.id&&this.name===t.name&&this.streamType===t.streamType&&this.mediaType===t.mediaType&&this.length===t.length&&this.resumed===t.resumed&&this.prerollWaitTime===t.prerollWaitTime&&this.granularAdTracking===t.granularAdTracking)}},{key:"serialize",value:function(){var e;return r(e={},"media.id",this.id),r(e,"media.name",this.name),r(e,"media.streamtype",this.streamType),
r(e,"media.type",this.mediaType),r(e,"media.length",this.length),r(e,"media.resumed",this.resumed),r(e,"media.prerollwaittime",this.prerollWaitTime),r(e,"media.granularadtracking",this.granularAdTracking),e}}],[{key:"deserialize",value:function(t){return J(t)?Y(function(){return new e({id:t["media.id"],name:t["media.name"],streamType:t["media.streamtype"],mediaType:t["media.type"],length:t["media.length"],resumed:t["media.resumed"],prerollWaitTime:t["media.prerollwaittime"],granularAdTracking:t["media.granularadtracking"]})},
null):null}}]),e}(),he=function(){function e(a){var i=a.bitrate,r=a.droppedFrames,n=a.fps,s=a.startupTime;if(t(this,e),!Z(i)||i<0)throw new TypeError("bitrate must not be less than zero");if(!Z(r)||r<0)throw new TypeError("dropped frames must not be less than zero");if(!Z(n)||n<0)throw new TypeError("fps must not be less than zero");if(!Z(s)||s<0)throw new TypeError("startupTime must not be less than zero");this.bitrate=i,this.droppedFrames=r,this.fps=n,this.startupTime=s}return i(e,[{key:"equal",
value:function(t){return!S(t)&&t instanceof e&&(this.bitrate===t.bitrate&&this.droppedFrames===t.droppedFrames&&this.fps===t.fps&&this.startupTime===t.startupTime)}},{key:"serialize",value:function(){var e;return r(e={},"qoe.bitrate",this.bitrate),r(e,"qoe.droppedframes",this.droppedFrames),r(e,"qoe.fps",this.fps),r(e,"qoe.startuptime",this.startupTime),e}}],[{key:"deserialize",value:function(t){return J(t)?Y(function(){return new e({bitrate:t["qoe.bitrate"],droppedFrames:t["qoe.droppedframes"],fps:t["qoe.fps"],
startupTime:t["qoe.startuptime"]})},null):null}}]),e}(),fe=R("Media");var pe=function(e){try{return JSON.stringify(e,null,4)}catch(e){return"[Error formatting object]"}},me=Object.freeze({Name:"event.name",Params:"event.params",Metadata:"event.metadata",TimeStamp:"event.ts",InternalEvent:"event.internal",Playhead:"event.playhead",ErrorId:"error.id"}),_e=Object.freeze(s({SessionStart:"sessionStart",SessionEnd:"sessionEnd",SessionComplete:"sessionComplete",Play:"play",Pause:"pause",Error:"error",QoEUpdate:"qoeUpdate",
PlayheadUpdate:"playheadUpdate"},h)),ve=function(){function e(a,i){if(t(this,e),S(a))throw new Error("id is not valid");this.id=a,this.description=i,this.predicates=[],this.actions=[]}return i(e,[{key:"addPredicate",value:function(e,t,a){if(!X(e))throw new Error("predicate is not a function");return this.predicates.push({predicate:e,val:t,message:a}),this}},{key:"addAction",value:function(e){if(!X(e))throw new Error("action is not a function");return this.actions.push(e),this}},{key:"runPredicates",
value:function(e){for(var t=0;t<this.predicates.length;++t){var a=this.predicates[t];if(a.predicate(e)!==a.val)return{success:!1,message:a.message}}return{success:!0,message:""}}},{key:"runActions",value:function(e){for(var t=0;t<this.actions.length;++t)if(!(0,this.actions[t])(e))return!1;return!0}}]),e}(),ke=function(){function e(a){if(t(this,e),!a)throw new Error("RuleEngine needs a logger");this.logger=a,this.rules={}}return i(e,[{key:"setEnterAction",value:function(e){if(!X(e))throw new Error("enterAction is not a function");
this.enterAction=e}},{key:"setExitAction",value:function(e){if(!X(e))throw new Error("exitAction is not a function");this.exitAction=e}},{key:"addRule",value:function(e){if(!(e instanceof ve))throw new Error("rule is not valid");this.rules[e.id]=e}},{key:"processRule",value:function(e,t){var a=this.rules[e];if(!a)return{success:!1,message:"Matching rule is not found"};var i=a.runPredicates(t);do{if(!i.success){this.logger.log("RuleEngine: Predicates failed for rule "+a.description+" : "+i.message);
break}if(this.enterAction&&!this.enterAction(a,t)){this.logger.log("RuleEngine: Enter action prevents further processing for rule "+a.description);break}if(!a.runActions(t)){this.logger.log("RuleEngine: Rule action prevents further processing for rule "+a.description);break}this.exitAction&&this.exitAction(a,t)}while(0);return i}}]),e}(),ye=Object.freeze({Init:0,Play:1,Pause:2,Buffer:3,Seek:4,Stall:5}),ge=function(){function e(a,i){t(this,e),this._mediaInfo=a,this._mediaMetadata=i,this._adBreakInfo=
null,this._adInfo=null,this._adMetadata=null,this._chapterInfo=null,this._chapterMetadata=null,this._qoeInfo=null,this._playhead=0,this._playstate=ye.Init,this._buffering=!1,this._seeking=!1,this._customStates=new Map}return i(e,[{key:"setAdBreakInfo",value:function(e){this._adBreakInfo=e}},{key:"clearAdBreakInfo",value:function(){this._adBreakInfo=null}},{key:"setAdInfo",value:function(e,t){this._adInfo=e,this._adMetadata=t}},{key:"clearAdInfo",value:function(){this._adInfo=null,this._adMetadata=
null}},{key:"setChapterInfo",value:function(e,t){this._chapterInfo=e,this._chapterMetadata=t}},{key:"clearChapterInfo",value:function(){this._chapterInfo=null,this._chapterMetadata=null}},{key:"enterPlaybackState",value:function(e){switch(e){case ye.Play:case ye.Pause:case ye.Stall:this._playstate=e;break;case ye.Buffer:this._buffering=!0;break;case ye.Seek:this._seeking=!0}}},{key:"exitPlaybackState",value:function(e){switch(e){case ye.Buffer:this._buffering=!1;break;case ye.Seek:this._seeking=!1}}},
{key:"isInPlaybackState",value:function(e){var t=!1;switch(e){case ye.Init:case ye.Play:case ye.Pause:case ye.Stall:t=this._playstate===e;break;case ye.Buffer:t=this._buffering;break;case ye.Seek:t=this._seeking}return t}},{key:"isIdle",value:function(){return!this.isInPlaybackState(ye.Play)||this.isInPlaybackState(ye.Seek)||this.isInPlaybackState(ye.Buffer)}},{key:"startCustomState",value:function(e){this._customStates.set(e.name,e)}},{key:"endCustomState",value:function(e){this._customStates.set(e.name,
null)}},{key:"isCustomStateActive",value:function(e){return!!this._customStates.get(e.name)}},{key:"getActiveCustomStates",value:function(){var e=[];return this._customStates.forEach(function(t){t&&e.push(t)}),e}},{key:"hasTrackedCustomState",value:function(e){return this._customStates.has(e.name)}},{key:"numTrackedCustomStates",value:function(){return this._customStates.size}},{key:"mediaInfo",get:function(){return this._mediaInfo}},{key:"mediaMetadata",get:function(){return this._mediaMetadata}},
{key:"isInAdBreak",get:function(){return!!this._adBreakInfo}},{key:"adBreakInfo",get:function(){return this._adBreakInfo}},{key:"isInAd",get:function(){return!!this._adInfo}},{key:"adInfo",get:function(){return this._adInfo}},{key:"adMetadata",get:function(){return this._adMetadata}},{key:"isInChapter",get:function(){return!!this._chapterInfo}},{key:"chapterInfo",get:function(){return this._chapterInfo}},{key:"chapterMetadata",get:function(){return this._chapterMetadata}},{key:"qoeInfo",get:function(){return this._qoeInfo},
set:function(e){this._qoeInfo=e}},{key:"playhead",get:function(){return this._playhead},set:function(e){this._playhead=e}}]),e}(),Se=function(){function e(a){var i=a.eventType,r=a.params,n=a.customMetadata,s=a.qoeData,o=a.playhead,d=a.ts;if(t(this,e),!A(i))throw new Error("eventType should be a valid string");if(!Z(o))throw new Error("playhead should be a valid number");if(!$(d)||d<0)throw new Error("ts should be a valid positive integer");this.eventType=i,this.params=J(r)?r:{},this.customMetadata=
J(n)?n:{},this.qoeData=J(s)?s:{},this.playhead=o,this.ts=d}return i(e,[{key:"toString",value:function(){return pe(this)}}]),e}(),Pe=function(){function e(a,i,r,n,s){t(this,e),this._logger=a,this._hitProcessor=i,this._config=r,this._media=n,this._refTs=s,this._previousState=ye.Init,this._previousStateTs=s,this._interval=1E4,this._lastQoeInfo=null,this._startSession()}return i(e,[{key:"setRefTS",value:function(e){this._refTs=e}},{key:"processMediaStart",value:function(){this._processMediaStart(!1)}},
{key:"processMediaComplete",value:function(){this._generateHit(j.SessionComplete),this._endSession()}},{key:"processMediaSkip",value:function(){this._generateHit(j.SessionEnd),this._endSession()}},{key:"processAdBreakStart",value:function(){var t=e._extractAdBreakParams(this._media);this._generateHit(j.AdBreakStart,t,{})}},{key:"processAdBreakComplete",value:function(){this._generateHit(j.AdBreakComplete)}},{key:"processAdBreakSkip",value:function(){this._generateHit(j.AdBreakComplete)}},{key:"processAdStart",
value:function(){e._isGranularAdTrackingEnabled(this._media)&&(this._interval=1E3);var t=e._extractAdParams(this._media),a=e._extractAdMetadata(this._media);this._generateHit(j.AdStart,t,a)}},{key:"processAdComplete",value:function(){this._interval=1E4,this._generateHit(j.AdComplete)}},{key:"processAdSkip",value:function(){this._interval=1E4,this._generateHit(j.AdSkip)}},{key:"processChapterStart",value:function(){var t=e._extractChapterParams(this._media),a=e._extractChapterMetadata(this._media);
this._generateHit(j.ChapterStart,t,a)}},{key:"processChapterComplete",value:function(){this._generateHit(j.ChapterComplete)}},{key:"processChapterSkip",value:function(){this._generateHit(j.ChapterSkip)}},{key:"processCustomStateStart",value:function(e){var t={};t[H.StateName]=e.name,this._generateHit(j.StateStart,t,{},{})}},{key:"processCustomStateEnd",value:function(e){var t={};t[H.StateName]=e.name,this._generateHit(j.StateEnd,t,{},{})}},{key:"processSessionAbort",value:function(){this.processMediaSkip()}},
{key:"processSessionRestart",value:function(){this._previousState=ye.Init,this._previousStateTs=this._refTs,this._lastQoeInfo=null,this._startSession(),this.processMediaStart(!0),this._media.isInChapter&&this.processChapterStart(),this._media.isInAdBreak&&this.processAdBreakStart(),this._media.isInAd&&this.processAdStart();var e,t=this._media.getActiveCustomStates();for(e=0;e<t.length;e++)this.processCustomStateStart(t[e]);this.processPlayback(!0)}},{key:"processBitrateChange",value:function(){var t=
e._extractQoeData(this._media);this._generateHit(j.BitrateChange,{},{},t)}},{key:"processError",value:function(t){var a=e._extractQoeData(this._media);a[Q.ErrorId]=t,a[Q.ErrorSource]=Q.ErrorSourcePlayer,this._generateHit(j.Error,{},{},a)}},{key:"processPlayback",value:function(t){if(this._isTracking){var a=this._getPlaybackState();if(this._previousState!==a||t){var i=e._playbackStateToMediaCollectionEvent(a);this._generateHit(i),this._previousState=a,this._previousStateTs=this._refTs}else a===this._previousState&&
this._refTs-this._previousStateTs>=this._interval&&(this._generateHit(j.Ping),this._previousStateTs=this._refTs)}}},{key:"_processMediaStart",value:function(t){var a={};a=e._extractMediaParams(this._media),t&&(a[q.Resume]=!0);var i=this._config[N.Channel];b(i)&&(a[N.Channel]=i);var r=e._extractMediaMetadata(this._media);this._generateHit(j.SessionStart,a,r)}},{key:"_generateHit",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?
arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=r;if(S(n)){var s=this._media.qoeInfo,o=!(S(s)||!S(this._lastQoeInfo)&&this._lastQoeInfo.equal(s));o&&(n=e._extractQoeData(this._media),this._lastQoeInfo=s)}if(this._isTracking){var d=this._media.playhead,c=this._refTs,u=new Se({eventType:t,params:a,customMetadata:i,qoeData:n,playhead:d,ts:c});this._hitProcessor.processHit(this._sessionId,u)}else this._logger.log("#_generateHit - Dropping hit as we have internally stopped tracking the session")}},
{key:"_getPlaybackState",value:function(){return this._media.isInPlaybackState(ye.Buffer)?ye.Buffer:this._media.isInPlaybackState(ye.Seek)?ye.Seek:this._media.isInPlaybackState(ye.Play)?ye.Play:this._media.isInPlaybackState(ye.Pause)?ye.Pause:this._media.isInPlaybackState(ye.Stall)?ye.Stall:ye.Init}},{key:"_startSession",value:function(){this._sessionId=this._hitProcessor.startSession(),this._isTracking=!0,this._logger.log("Start internal session("+this._sessionId+")")}},{key:"_endSession",value:function(){this._hitProcessor.endSession(this._sessionId),
this._isTracking=!1,this._logger.log("End internal session("+this._sessionId+")")}}],[{key:"_isGranularAdTrackingEnabled",value:function(e){var t=e.mediaInfo;return!S(t)&&t.granularAdTracking}},{key:"_extractMediaParams",value:function(t){var a={},i=t.mediaInfo;S(i)||(a[q.Id]=i.id,a[q.Name]=i.name,a[q.Length]=i.length,a[q.ContentType]=i.streamType,a[q.StreamType]=i.mediaType,a[q.Resume]=i.resumed);var r=t.mediaMetadata;return J(r)&&Object.keys(r).forEach(function(t){if(e._standardMediaMetadataMap.has(t)){var i=
e._standardMediaMetadataMap.get(t);a[i]=r[t]}}),a}},{key:"_extractMediaMetadata",value:function(t){var a={},i=t.mediaMetadata;return J(i)&&Object.keys(i).forEach(function(t){e._standardMediaMetadataMap.has(t)||(a[t]=i[t])}),a}},{key:"_extractAdBreakParams",value:function(e){var t={},a=e.adBreakInfo;return S(a)||(t[F.PodFriendlyName]=a.name,t[F.PodIndex]=a.position,t[F.PodSecond]=a.startTime),t}},{key:"_extractAdParams",value:function(t){var a={},i=t.adInfo;S(i)||(a[L.Name]=i.name,a[L.Id]=i.id,a[L.Length]=
i.length,a[L.PodPosition]=i.position);var r=t.adMetadata;return J(r)&&Object.keys(r).forEach(function(t){if(e._standardAdMetadataMap.has(t)){var i=e._standardAdMetadataMap.get(t);a[i]=r[t]}}),a}},{key:"_extractAdMetadata",value:function(t){var a={},i=t.adMetadata;return J(i)&&Object.keys(i).forEach(function(t){e._standardAdMetadataMap.has(t)||(a[t]=i[t])}),a}},{key:"_extractChapterParams",value:function(e){var t={},a=e.chapterInfo;return S(a)||(t[G.FriendlyName]=a.name,t[G.Index]=a.position,t[G.Length]=
a.length,t[G.Offset]=a.startTime),t}},{key:"_extractChapterMetadata",value:function(e){var t={},a=e.chapterMetadata;return J(a)&&Object.keys(a).forEach(function(e){t[e]=a[e]}),t}},{key:"_extractQoeData",value:function(e){var t={},a=e.qoeInfo;return J(a)&&(t[Q.Bitrate]=parseInt(a.bitrate,10),t[Q.Fps]=parseInt(a.fps,10),t[Q.DroppedFrames]=parseInt(a.droppedFrames,10),t[Q.StartupTime]=parseInt(a.startupTime,10)),t}},{key:"_playbackStateToMediaCollectionEvent",value:function(e){switch(e){case ye.Buffer:return j.BufferStart;
case ye.Seek:return j.PauseStart;case ye.Play:return j.Play;case ye.Pause:return j.PauseStart;case ye.Stall:return j.Play;case ye.Init:return j.Ping;default:return""}}}]),e}(),Ie=new Map;Ie.set(_.Show,D.Show),Ie.set(_.Season,D.Season),Ie.set(_.Episode,D.Episode),Ie.set(_.AssetId,D.AssetId),Ie.set(_.Genre,D.Genre),Ie.set(_.FirstAirDate,D.FirstAirDate),Ie.set(_.FirstDigitalDate,D.FirstDigitalDate),Ie.set(_.Rating,D.Rating),Ie.set(_.Originator,D.Originator),Ie.set(_.Network,D.Network),Ie.set(_.ShowType,
D.ShowType),Ie.set(_.AdLoad,D.AdLoad),Ie.set(_.MVPD,D.MVPD),Ie.set(_.Authorized,D.Auth),Ie.set(_.DayPart,D.DayPart),Ie.set(_.Feed,D.Feed),Ie.set(_.StreamFormat,D.StreamFormat),Ie.set(v.Artist,D.Artist),Ie.set(v.Album,D.Album),Ie.set(v.Label,D.Label),Ie.set(v.Author,D.Author),Ie.set(v.Station,D.Station),Ie.set(v.Publisher,D.Publisher),Pe._standardMediaMetadataMap=Ie;var Ae=new Map;Ae.set(k.Advertiser,V.Advertiser),Ae.set(k.CampaignId,V.CampaignId),Ae.set(k.CreativeId,V.CreativeId),Ae.set(k.PlacementId,
V.PlacementId),Ae.set(k.SiteId,V.SiteId),Ae.set(k.CreativeUrl,V.CreativeUrl),Pe._standardAdMetadataMap=Ae;var be="Media tracker is not in active tracking session, call 'API:trackSessionStart' to begin a new tracking session.",Ee="Media tracker is in active tracking session, call 'API:trackSessionEnd' or 'API:trackComplete' to end current tracking session.",Ce="Media tracker is tracking buffer events, call 'API:trackEvent(BufferComplete)' first to stop tracking buffer events.",Me="Media tracker is not tracking buffer events, call 'API:trackEvent(BufferStart)' before 'API:trackEvent(BufferComplete)'.",
we="Media tracker is tracking seek events, call 'API:trackEvent(SeekComplete)' first to stop tracking seek events.",Te="Media tracker is not tracking seek events, call 'API:trackEvent(SeekStart)' before 'API:trackEvent(SeekComplete)'.",Oe="Media tracker is not tracking any AdBreak, call 'API:trackEvent(AdBreakStart)' to begin tracking AdBreak",Re="Media tracker is not tracking any Ad, call 'API:trackEvent(AdStart)' to begin tracking Ad",Be="Media tracker is not tracking any Chapter, call 'API:trackEvent(ChapterStart)' to begin tracking Chapter",
ze="MediaInfo passed into 'API:trackSessionStart' is invalid.",je="AdBreakInfo passed into 'API:trackEvent(AdBreakStart)' is invalid.",De="Media tracker is currently tracking the AdBreak passed into 'API:trackEvent(AdBreakStart)'.",Ve="AdInfo passed into 'API:trackEvent(AdStart)' is invalid.",qe="StateInfo passed into 'API:trackEvent(StateStart|StateEnd)' is invalid.",xe="ErrorId passed into 'API:trackError()' is invalid.",Ne="Media tracker is currently tracking the Ad passed into 'API:trackEvent(AdStart)'.",
Fe="ChapterInfo passed into 'API:trackEvent(ChapterStart)' is invalid.",Le="Media tracker is currently tracking the Chapter passed into 'API:trackEvent(ChapterStart)'.",Ge="QoEInfo passed into 'API:updateQoEInfo' is invalid.",He="Media tracker is tracking an AdBreak but not tracking any Ad and will drop any calls to track player state (Play, Pause, Buffer or Seek) in this state.",Qe="Media tracker is already tracking a state with the same state name.",Ue="Media tracker is not already tracking a state with the same state name.",
Ke="Media tracker has reached maximum number of states per session (10).",We=new RegExp("^[a-zA-Z0-9_\\.]+$"),Ze=function(){function e(a,i,r){if(t(this,e),!a)throw new Error("hitProcessor should be valid");if(!i)throw new Error("logger should be valid");this._hitProcessor=a,this._logger=i,this._config=J(r)?r:{},this._resetStates(),this._setupRules()}return i(e,[{key:"track",value:function(t){var a=t[me.Name];return b(a)?$(t[me.TimeStamp])?(J(t[me.Params])||(t[me.Params]={}),t[me.Metadata]=e._cleanMetadata(t[me.Metadata]),
!!this._prerollDeferRule(a,t)||this._processRule(a,t)):(this._logger.log("#track - Event timestamp is missing in track event data. - "+a),!1):(this._logger.log("#track - Event name is missing in track event data"),!1)}},{key:"_resetStates",value:function(){this._media=null,this._hitGenerator=null,this._sessionRefTs=null,this._inPrerollInterval=!1,this._prerollRefTs=null,this._prerollQueuedRules=[],this._contentStarted=!1,this._contentStartRefTs=null,this._mediaIdle=!1,this._trackerIdle=!1,this._mediaIdleStartTs=
0}},{key:"_createHitGenerator",value:function(e){return new Pe(this._logger,this._hitProcessor,this._config,this._media,e)}},{key:"_processRule",value:function(e,t){return this._ruleEngine.processRule(e,t).success}},{key:"_setupRules",value:function(){this._ruleEngine=new ke(this._logger),this._ruleEngine.setEnterAction(this._cmdEnterAction.bind(this)),this._ruleEngine.setExitAction(this._cmdExitAction.bind(this));var e=this._isInMedia.bind(this),t=this._isInAdBreak.bind(this),a=this._isInAd.bind(this),
i=this._isInChapter.bind(this),r=this._isInTrackedState.bind(this),n=this._isValidMediaInfo.bind(this),s=this._isValidAdBreakInfo.bind(this),o=this._isValidAdInfo.bind(this),d=this._isValidChapterInfo.bind(this),c=this._isValidQoEInfo.bind(this),u=this._isValidStateInfo.bind(this),l=this._isValidErrorInfo.bind(this),h=this._isDifferentAdBreakInfo.bind(this),f=this._isDifferentAdInfo.bind(this),p=this._isDifferentChapterInfo.bind(this),m=this._allowPlayerStateChange.bind(this),_=this._allowStateTrack.bind(this),
v=this._isInBuffering.bind(this),k=this._isInSeeking.bind(this),y=this._cmdMediaStart.bind(this),g=this._cmdMediaSkip.bind(this),S=this._cmdMediaComplete.bind(this),P=this._cmdError.bind(this),I=this._cmdPlay.bind(this),A=this._cmdPause.bind(this),b=this._cmdBufferStart.bind(this),E=this._cmdBufferComplete.bind(this),C=this._cmdSeekStart.bind(this),M=this._cmdSeekComplete.bind(this),w=this._cmdAdStart.bind(this),T=this._cmdAdComplete.bind(this),O=this._cmdAdSkip.bind(this),R=this._cmdAdBreakStart.bind(this),
B=this._cmdAdBreakComplete.bind(this),z=this._cmdAdBreakSkip.bind(this),j=this._cmdChapterStart.bind(this),D=this._cmdChapterComplete.bind(this),V=this._cmdChapterSkip.bind(this),q=this._cmdStateStart.bind(this),x=this._cmdStateEnd.bind(this),N=this._cmdBitrateChange.bind(this),F=this._cmdQoEUpdate.bind(this),L=this._cmdPlayheadUpdate.bind(this),G=new ve(_e.SessionStart,"API:trackSessionStart");G.addPredicate(e,!1,Ee).addPredicate(n,!0,ze).addAction(y),this._ruleEngine.addRule(G);var H=new ve(_e.SessionComplete,
"API:trackComplete");H.addPredicate(e,!0,be).addAction(O).addAction(z).addAction(V).addAction(S),this._ruleEngine.addRule(H);var Q=new ve(_e.SessionEnd,"API:trackSessionEnd");Q.addPredicate(e,!0,be).addAction(O).addAction(z).addAction(V).addAction(g),this._ruleEngine.addRule(Q);var U=new ve(_e.Error,"API:trackError");U.addPredicate(e,!0,be).addPredicate(l,!0,xe).addAction(P),this._ruleEngine.addRule(U);var K=new ve(_e.Play,"API:trackPlay");K.addPredicate(e,!0,be).addPredicate(m,!0,He).addAction(M).addAction(E).addAction(I),
this._ruleEngine.addRule(K);var W=new ve(_e.Pause,"API:trackPause");W.addPredicate(e,!0,be).addPredicate(m,!0,He).addPredicate(v,!1,Ce).addPredicate(k,!1,we).addAction(A),this._ruleEngine.addRule(W);var Z=new ve(_e.BufferStart,"API:trackEvent(BufferStart)");Z.addPredicate(e,!0,be).addPredicate(m,!0,He).addPredicate(v,!1,Ce).addPredicate(k,!1,we).addAction(b),this._ruleEngine.addRule(Z);var $=new ve(_e.BufferComplete,"API:trackEvent(BufferComplete)");$.addPredicate(e,!0,be).addPredicate(m,!0,He).addPredicate(v,
!0,Me).addAction(E),this._ruleEngine.addRule($);var J=new ve(_e.SeekStart,"API:trackEvent(SeekStart)");J.addPredicate(e,!0,be).addPredicate(m,!0,He).addPredicate(k,!1,we).addPredicate(v,!1,Ce).addAction(C),this._ruleEngine.addRule(J);var X=new ve(_e.SeekComplete,"API:trackEvent(SeekComplete)");X.addPredicate(e,!0,be).addPredicate(m,!0,He).addPredicate(k,!0,Te).addAction(M),this._ruleEngine.addRule(X);var Y=new ve(_e.AdBreakStart,"API:trackEvent(AdBreakStart)");Y.addPredicate(e,!0,be).addPredicate(s,
!0,je).addPredicate(h,!0,De).addAction(O).addAction(z).addAction(R),this._ruleEngine.addRule(Y);var ee=new ve(_e.AdBreakComplete,"API:trackEvent(AdBreakComplete)");ee.addPredicate(e,!0,be).addPredicate(t,!0,Oe).addAction(O).addAction(B),this._ruleEngine.addRule(ee);var te=new ve(_e.AdStart,"API:trackEvent(AdStart)");te.addPredicate(e,!0,be).addPredicate(t,!0,Oe).addPredicate(o,!0,Ve).addPredicate(f,!0,Ne).addAction(O).addAction(w),this._ruleEngine.addRule(te);var ae=new ve(_e.AdComplete,"API:trackEvent(AdComplete)");
ae.addPredicate(e,!0,be).addPredicate(t,!0,Oe).addPredicate(a,!0,Re).addAction(T),this._ruleEngine.addRule(ae);var ie=new ve(_e.AdSkip,"API:trackEvent(AdSkip)");ie.addPredicate(e,!0,be).addPredicate(t,!0,Oe).addPredicate(a,!0,Re).addAction(O),this._ruleEngine.addRule(ie);var re=new ve(_e.ChapterStart,"API::trackEvent(chapterStart)");re.addPredicate(e,!0,be).addPredicate(d,!0,Fe).addPredicate(p,!0,Le).addAction(V).addAction(j),this._ruleEngine.addRule(re);var ne=new ve(_e.ChapterComplete,"API::trackEvent(chapterComplete)");
ne.addPredicate(e,!0,be).addPredicate(i,!0,Be).addAction(D),this._ruleEngine.addRule(ne);var se=new ve(_e.ChapterSkip,"API:trackEvent(chapterSkip)");se.addPredicate(e,!0,be).addPredicate(i,!0,Be).addAction(V),this._ruleEngine.addRule(se);var oe=new ve(_e.BitrateChange,"API:trackEvent(BitrateChange)");oe.addPredicate(e,!0,be).addAction(N),this._ruleEngine.addRule(oe);var de=new ve(_e.QoEUpdate,"API:trackEvent(QoEUpdate)");de.addPredicate(e,!0,be).addPredicate(c,!0,Ge).addAction(F),this._ruleEngine.addRule(de);
var ce=new ve(_e.PlayheadUpdate,"API:trackEvent(PlayheadUpdate)");ce.addPredicate(e,!0,be).addAction(L),this._ruleEngine.addRule(ce);var ue=new ve(_e.StateStart,"API:trackEvent(StateStart)");ue.addPredicate(e,!0,be).addPredicate(u,!0,qe).addPredicate(r,!1,Qe).addPredicate(_,!0,Ke).addAction(q),this._ruleEngine.addRule(ue);var le=new ve(_e.StateEnd,"API:trackEvent(StateEnd)");le.addPredicate(e,!0,be).addPredicate(u,!0,qe).addPredicate(r,!0,Ue).addAction(x),this._ruleEngine.addRule(le)}},{key:"_isInMedia",
value:function(){return!S(this._media)}},{key:"_isInAdBreak",value:function(){return this._media.isInAdBreak}},{key:"_isInAd",value:function(){return this._media.isInAd}},{key:"_isInChapter",value:function(){return this._media.isInChapter}},{key:"_isInBuffering",value:function(){return this._media.isInPlaybackState(ye.Buffer)}},{key:"_isInSeeking",value:function(){return this._media.isInPlaybackState(ye.Seek)}},{key:"_isInTrackedState",value:function(e){var t=ue.deserialize(e[me.Params]);return this._media.isCustomStateActive(t)}},
{key:"_isValidMediaInfo",value:function(e){return null!=le.deserialize(e[me.Params])}},{key:"_isValidAdBreakInfo",value:function(e){return null!=oe.deserialize(e[me.Params])}},{key:"_isValidAdInfo",value:function(e){return null!=se.deserialize(e[me.Params])}},{key:"_isValidStateInfo",value:function(e){return null!=ue.deserialize(e[me.Params])}},{key:"_isValidChapterInfo",value:function(e){return null!=de.deserialize(e[me.Params])}},{key:"_isValidQoEInfo",value:function(e){return null!=he.deserialize(e[me.Params])}},
{key:"_isValidErrorInfo",value:function(e){var t=e[me.Params];if(!J(t))return!1;var a=t[me.ErrorId];return b(a)}},{key:"_isDifferentAdBreakInfo",value:function(e){return!oe.deserialize(e[me.Params]).equal(this._media.adBreakInfo)}},{key:"_isDifferentAdInfo",value:function(e){return!se.deserialize(e[me.Params]).equal(this._media.adInfo)}},{key:"_isDifferentChapterInfo",value:function(e){return!de.deserialize(e[me.Params]).equal(this._media.chapterInfo)}},{key:"_allowPlayerStateChange",value:function(){return!this._media.isInAdBreak||
this._media.isInAd}},{key:"_allowStateTrack",value:function(e){var t=ue.deserialize(e[me.Params]);return this._media.hasTrackedCustomState(t)||this._media.numTrackedCustomStates()<10}},{key:"_cmdEnterAction",value:function(e,t){var a=this._getRefTs(t);return S(this._hitGenerator)||this._hitGenerator.setRefTS(a),!0}},{key:"_cmdExitAction",value:function(e,t){if(S(this._media))return!1;e.id===_e.AdStart&&(!this._media.isInPlaybackState(ye.Init)||this._media.isInPlaybackState(ye.Buffer)||this._media.isInPlaybackState(ye.Seek)||
this._media.enterPlaybackState(ye.Play)),e.id!==_e.BufferComplete&&e.id!==_e.SeekComplete||this._media.isInPlaybackState(ye.Init)&&this._media.enterPlaybackState(ye.Pause),this._cmdIdleDetection(t),this._cmdSessionTimeoutDetection(t),this._cmdContentStartDetection(t);var a=e.id===_e.AdStart||e.id===_e.AdBreakComplete;return this._hitGenerator.processPlayback(a),!0}},{key:"_cmdMediaStart",value:function(e){var t=le.deserialize(e[me.Params]),a=e[me.Metadata],i=this._getRefTs(e);return this._media=new ge(t,
a),this._hitGenerator=this._createHitGenerator(i),this._hitGenerator.processMediaStart(),this._sessionRefTs=i,this._inPrerollInterval=0!==t.prerollWaitTime,this._prerollRefTs=i,!0}},{key:"_cmdMediaComplete",value:function(){return this._hitGenerator.processMediaComplete(),this._resetStates(),!0}},{key:"_cmdMediaSkip",value:function(){return this._hitGenerator.processMediaSkip(),this._resetStates(),!0}},{key:"_cmdAdBreakStart",value:function(e){var t=oe.deserialize(e[me.Params]);return this._media.setAdBreakInfo(t),
this._hitGenerator.processAdBreakStart(),!0}},{key:"_cmdAdBreakComplete",value:function(){return this._hitGenerator.processAdBreakComplete(),this._media.clearAdBreakInfo(),!0}},{key:"_cmdAdBreakSkip",value:function(){return this._media.isInAdBreak&&(this._hitGenerator.processAdBreakSkip(),this._media.clearAdBreakInfo()),!0}},{key:"_cmdAdStart",value:function(e){var t=se.deserialize(e[me.Params]),a=e[me.Metadata];return this._media.setAdInfo(t,a),this._hitGenerator.processAdStart(),!0}},{key:"_cmdAdComplete",
value:function(){return this._hitGenerator.processAdComplete(),this._media.clearAdInfo(),!0}},{key:"_cmdAdSkip",value:function(){return this._media.isInAd&&(this._hitGenerator.processAdSkip(),this._media.clearAdInfo()),!0}},{key:"_cmdChapterStart",value:function(e){var t=de.deserialize(e[me.Params]),a=e[me.Metadata];return this._media.setChapterInfo(t,a),this._hitGenerator.processChapterStart(),!0}},{key:"_cmdChapterComplete",value:function(){return this._hitGenerator.processChapterComplete(),this._media.clearChapterInfo(),
!0}},{key:"_cmdChapterSkip",value:function(){return this._media.isInChapter&&(this._hitGenerator.processChapterSkip(),this._media.clearChapterInfo()),!0}},{key:"_cmdError",value:function(e){var t=e[me.Params][me.ErrorId];return this._hitGenerator.processError(t),!0}},{key:"_cmdBitrateChange",value:function(){return this._hitGenerator.processBitrateChange(),!0}},{key:"_cmdPlay",value:function(){return this._media.enterPlaybackState(ye.Play),!0}},{key:"_cmdPause",value:function(){return this._media.enterPlaybackState(ye.Pause),
!0}},{key:"_cmdBufferStart",value:function(){return this._media.enterPlaybackState(ye.Buffer),!0}},{key:"_cmdBufferComplete",value:function(){return this._media.isInPlaybackState(ye.Buffer)&&this._media.exitPlaybackState(ye.Buffer),!0}},{key:"_cmdSeekStart",value:function(){return this._media.enterPlaybackState(ye.Seek),!0}},{key:"_cmdSeekComplete",value:function(){return this._media.isInPlaybackState(ye.Seek)&&this._media.exitPlaybackState(ye.Seek),!0}},{key:"_cmdQoEUpdate",value:function(e){var t=
he.deserialize(e[me.Params]);return this._media.qoeInfo=t,!0}},{key:"_cmdPlayheadUpdate",value:function(e){var t=e[me.Params];if(J(t)){var a=t[me.Playhead];Z(a)&&a>=0&&(this._media.playhead=a)}return!0}},{key:"_cmdIdleDetection",value:function(e){var t=this._getRefTs(e);this._media.isIdle()?this._mediaIdle?!this._trackerIdle&&t-this._mediaIdleStartTs>=18E5&&(this._hitGenerator.processSessionAbort(),this._trackerIdle=!0):(this._mediaIdle=!0,this._mediaIdleStartTs=t):(this._trackerIdle&&(this._hitGenerator.processSessionRestart(),
this._trackerIdle=!1,this._sessionRefTs=t,this._contentStarted=!1,this._contentStartRefTs=null),this._mediaIdle=!1)}},{key:"_cmdSessionTimeoutDetection",value:function(e){var t=this._getRefTs(e);!this._trackerIdle&&t-this._sessionRefTs>=864E5&&(this._hitGenerator.processSessionAbort(),this._hitGenerator.processSessionRestart(),this._sessionRefTs=t,this._contentStarted=!1,this._contentStartRefTs=null)}},{key:"_cmdContentStartDetection",value:function(e){return!(!this._media.isIdle()&&!this._contentStarted)||
(this._media.isInAdBreak?(this._contentStartRefTs=null,!0):(null==this._contentStartRefTs&&(this._contentStartRefTs=this._getRefTs(e)),this._getRefTs(e)-this._contentStartRefTs>=1E3&&(this._hitGenerator.processPlayback(!0),this._contentStarted=!0),!0))}},{key:"_cmdStateStart",value:function(e){var t=ue.deserialize(e[me.Params]);return this._media.startCustomState(t),this._hitGenerator.processCustomStateStart(t),!0}},{key:"_cmdStateEnd",value:function(e){var t=ue.deserialize(e[me.Params]);return this._media.endCustomState(t),
this._hitGenerator.processCustomStateEnd(t),!0}},{key:"_getRefTs",value:function(e){var t=e[me.TimeStamp];return $(t)?t:null}},{key:"_prerollDeferRule",value:function(e,t){if(this._inPrerollInterval&&null!=this._media){var a=this._media.mediaInfo.prerollWaitTime;if(this._prerollQueuedRules.push({eventName:e,context:t}),this._getRefTs(t)-this._prerollRefTs>=a||e===_e.AdBreakStart||e===_e.MediaComplete||e===_e.MediaSkip){for(var i=this._prerollReorderRules(this._prerollQueuedRules),r=0;r<i.length;r++){var n=
i[r];this._processRule(n.eventName,n.context)}this._prerollQueuedRules=[],this._inPrerollInterval=!1}return!0}return!1}},{key:"_prerollReorderRules",value:function(e){for(var t=[],a=!1,i=0;i<e.length;++i)if(e[i].eventName===_e.AdBreakStart){a=!0;break}for(var r=a,n=0;n<e.length;n++){var s=e[n];s.eventName===_e.Play&&r||(s.eventName===_e.AdBreakStart&&(r=!1),t.push(s))}return t}}],[{key:"_cleanMetadata",value:function(e){var t={};return J(e)&&Object.keys(e).forEach(function(a){var i=e[a];We.test(a)&&
!S(i)&&(t[a]=String(i))}),t}}]),e}(),$e=function(){function e(a,i,r){t(this,e),this._logger=R("MediaTracker ("+i+")"),this._tracker=new Ze(a,this._logger,r),this._timer=null,this._lastEventTS=null,this._lastPlayheadParams=null}return i(e,[{key:"trackSessionStart",value:function(e,t){this._logger.log("trackSessionStart(info:"+pe(e)+" metadata:"+pe(t)+")"),this._trackInternal(_e.SessionStart,e,t)}},{key:"trackSessionEnd",value:function(){this._logger.log("trackSessionEnd"),this._trackInternal(_e.SessionEnd)}},
{key:"trackComplete",value:function(){this._logger.log("trackComplete"),this._trackInternal(_e.SessionComplete)}},{key:"trackPlay",value:function(){this._logger.log("trackPlay"),this._trackInternal(_e.Play)}},{key:"trackPause",value:function(){this._logger.log("trackPause"),this._trackInternal(_e.Pause)}},{key:"trackEvent",value:function(e,t,a){this._logger.log("trackEvent("+e+" info:"+pe(t)+" metadata:"+pe(a)+")"),this._trackInternal(e,t,a)}},{key:"trackError",value:function(e){this._logger.log("trackError("+
e+")");var t=r({},me.ErrorId,e);this._trackInternal(_e.Error,t)}},{key:"updatePlayhead",value:function(e){var t=r({},me.Playhead,e);this._trackInternal(_e.PlayheadUpdate,t)}},{key:"updateQoEObject",value:function(e){this._logger.log("updateQoEObject("+pe(e)+")"),this._trackInternal(_e.QoEUpdate,e)}},{key:"destroy",value:function(){this._logger.log("destroy()"),this._stopTimer(),this._tracker=null}},{key:"_trackInternal",value:function(e,t,a){var i,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];
if(this._tracker){var s=E(),o=(r(i={},me.Name,e),r(i,me.Params,t),r(i,me.Metadata,a),r(i,me.TimeStamp,s),r(i,me.InternalEvent,n),i),d=this._tracker.track(o);this._lastEventTS=s,e===_e.PlayheadUpdate&&(this._lastPlayheadParams=t),e===_e.SessionStart&&d?this._startTimer():e!==_e.SessionComplete&&e!==_e.SessionEnd||this._stopTimer()}else this._logger.warn("Dropping the call as the tracker instance is already destroyed")}},{key:"_startTimer",value:function(){var e=this;this._timer||(this._timer=M(function(){e._onTick()},
500))}},{key:"_stopTimer",value:function(){var e;this._timer&&(e=this._timer,clearInterval(e),this._timer=null)}},{key:"_onTick",value:function(){E()-this._lastEventTS>750&&this._trackInternal(_e.PlayheadUpdate,this._lastPlayheadParams,null,!0)}}]),e}(),Je=new ne,Xe=l();var Ye={configure:function(e){Je.configure(e)},getInstance:function(e){var t="tracker"+Xe.getUniqueId();return new $e(Je,t,e)},createMediaObject:function(e,t,a,i,r){var n=null;try{n=(new le({id:t,name:e,streamType:i,mediaType:r,length:a})).serialize()}catch(e){fe.error("Error creating MediaObject ("+
e.message+")")}return n},createAdBreakObject:function(e,t,a){var i=null;try{i=(new oe({name:e,position:t,startTime:a})).serialize()}catch(e){fe.error("Error creating AdBreakObject ("+e.message+")")}return i},createAdObject:function(e,t,a,i){var r=null;try{r=(new se({id:t,name:e,position:a,length:i})).serialize()}catch(e){fe.error("Error creating AdObject ("+e.message+")")}return r},createChapterObject:function(e,t,a,i){var r=null;try{r=(new de({name:e,position:t,length:a,startTime:i})).serialize()}catch(e){fe.error("Error creating ChapterObject ("+
e.message+")")}return r},createQoEObject:function(e,t,a,i){var r=null;try{r=(new he({bitrate:e,droppedFrames:i,fps:a,startupTime:t})).serialize()}catch(e){fe.error("Error creating QoEObject ("+e.message+")")}return r},createStateObject:function(e){var t=null;try{t=(new ue({name:e})).serialize()}catch(e){fe.error("Error creating StateObject ("+e.message+")")}return t},version:"js-3.0.1",Event:h,MediaType:p,PlayerState:m,StreamType:y,MediaObjectKey:f,VideoMetadataKeys:_,AudioMetadataKeys:v,AdMetadataKeys:k};
var et="ecid",tt="analytics",at="mediaanalytics",it=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(s,e);var a,n=(a=s,function(){var e,t=o(a);if(c()){var i=o(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return u(this,e)});function s(e,a){var i;if(t(this,s),i=n.call(this),
!e)throw new Error("Valid appmeasurement instance is required");if(!e.visitor)throw new Error("Valid visitor instance is required");return i._mediaConfig=a,i._appMeasurement=e,i._appMeasurementReady=!1,i._privacyResolved=!1,i._logger=R("WebECResolver"),i._fetchECParams(),i._fetchPrivacyStatus(),i._setupResolver(),i}return i(s,[{key:"resolveKeys",value:function(e){if(!e||0===e.length)return{};for(var t={},a=0;a<e.length;a++){var i=e[a],r=Object.prototype.hasOwnProperty.call(this._fnMap,i)?this._fnMap[i].call(this):
null;S(r)||(t[i]=r)}return t}},{key:"getPrivacyStatus",value:function(){return this._privacyStatus[at]}},{key:"notifyPrivacyChange",value:function(e){this._mediaPrivacyClb.push(e)}},{key:"isReady",value:function(){return!!this._privacyResolved&&(this._privacyStatus[at]===g.OptIn&&(this._privacyStatus[tt]!==g.OptIn||this._appMeasurementReady))}},{key:"_setupResolver",value:function(){var e=this,t={};t[B.Rsid]=function(){return e._appMeasurement.account},t[B.AnalyticsTrackingServer]=function(){return e._appMeasurement.ssl&&
e._appMeasurement.trackingServerSecure?e._appMeasurement.trackingServerSecure:e._appMeasurement.trackingServer},t[B.AnalyticsSsl]=function(){return e._appMeasurement.ssl},t[B.Vid]=function(){return e._appMeasurement.visitorID},t[B.Aid]=function(){var t=e._appMeasurement.analyticsVisitorID;if(""!==t)return t},t[B.Mcid]=function(){return e._appMeasurement.marketingCloudVisitorID},t[B.McOrgId]=function(){return e._appMeasurement.visitor.marketingCloudOrgID},t[B.AamLocHint]=function(){var t=parseInt(e._appMeasurement.audienceManagerLocationHint,
10);return isNaN(t)?void 0:t},t[B.CustomerIds]=function(){return e._appMeasurement.visitor.getCustomerIDs()},t[B.MediaTrackingServer]=function(){return e._mediaConfig.trackingServer},t[B.MediaChannel]=function(){return e._mediaConfig.channel},t[B.MediaAppVersion]=function(){return e._mediaConfig.appVersion},t[B.MediaPlayerName]=function(){return e._mediaConfig.playerName},t[B.MediaSsl]=function(){return e._mediaConfig.ssl},this._fnMap=t}},{key:"_fetchECParams",value:function(){this._appMeasurement.isReadyToTrack()?
this._onAppMeasurementReady():this._appMeasurement.callbackWhenReadyToTrack(this,this._onAppMeasurementReady,[])}},{key:"_onAppMeasurementReady",value:function(){this._logger.log("AppMeasurement ready"),this._appMeasurementReady=!0}},{key:"_fetchPrivacyStatus",value:function(){var e,t=this;this._mediaPrivacyClb=[],this._optIn=window.adobe&&window.adobe.optIn?window.adobe.optIn:void 0;var a=this._optIn&&this._optIn.doesOptInApply,i=a?g.OptUnknown:g.OptIn;this._privacyStatus=(r(e={},et,i),r(e,tt,i),
r(e,at,i),e),a?this._optIn.fetchPermissions(function(){t._privacyResolved=!0,t._privacyStatus[et]=t._optIn.isApproved(t._optIn.Categories.ECID)?g.OptIn:g.OptOut,t._privacyStatus[tt]=t._optIn.isApproved(t._optIn.Categories.ANALYTICS)?g.OptIn:g.OptOut,t._privacyStatus[at]=t._optIn.isApproved(t._optIn.Categories.MEDIA_ANALYTICS)?g.OptIn:g.OptOut,t._mediaPrivacyClb.forEach(function(e){e(t._privacyStatus[at])}),t._logger.log("Privacy Status "+pe(t._privacyStatus))},!0):(this._privacyResolved=!0,this._logger.log("OptIn service not used, defaulting privacy status to "+
pe(this._privacyStatus)))}}]),s}(function(){function e(){t(this,e)}return i(e,[{key:"resolveKeys",value:function(){throw new Error("Implementation error: Method must be overridden.");}},{key:"isReady",value:function(){}},{key:"getPrivacyStatus",value:function(){}},{key:"notifyPrivacyChange",value:function(){}}]),e}()),rt=R("Media"),nt=!1;return{Media:s({},Ye,{configure:function(e,t){if(T(e||{}),nt)rt.error("MediaSDK is already configured");else{rt.log("configure("+pe(e)+")");try{!function(e){if(!J(e))throw new Error("mediaConfig is not a valid object");
var t=e.trackingServer;if(!b(t))throw new Error("trackingServer is empty");if(-1!==t.indexOf("hb.omtrdc.net"))throw new Error("trackingServer should be set to Media collection endpoint and not heartbeat endpoint. Contact your Adobe representative for more information.");}(e);var a=new it(t,e);Ye.configure(a),nt=!0}catch(e){rt.error("Error configuring MediaSDK : "+e.message),T({debugLogging:!1})}}},getInstance:function(e){return nt?Ye.getInstance(e):(rt.error("MediaSDK should be configured before calling getInstance"),
null)}}),MediaConfig:function e(){t(this,e),this.trackingServer=void 0,this.channel=void 0,this.appVersion=void 0,this.playerName=void 0,this.ssl=!0,this.debugLogging=!1}}})},4044775,[4010591,4044017,4053064,4011933],660779,[645040,671423,683385,763742],-1);
Bootstrapper.bindDependencyImmediate(function(){var Bootstrapper=window["Bootstrapper"];var ensightenOptions=Bootstrapper.ensightenOptions;Bootstrapper.ADBhelper={};Bootstrapper.nielsenHelper={};Bootstrapper.comscoreHelper={};Bootstrapper.adobeTrackerMap={};Bootstrapper.nielsenTrackerMap={};Bootstrapper.comscoreTrackerMap={};var isTVE=/(abc|fftv|freeform|fxtv|fxnetworks|watchdisney)(fe(sb|qa)?)?\.com/.test(location.hostname)||/natgeo|ngtv|nationalgeographic/.test(location.hostname)&&location.pathname.startsWith("/tv/");
var currentAdPod=0;Bootstrapper.ADBhelper.createMediaObject=function(){var capitalize=function(string){return string[0].toUpperCase()+string.substring(1)};var _dl=window.__dataLayer||{},media=_dl.media||{},isLive=media.format==="live"||media.contentType==="live";var dfltMType="video",mType=__dataLayer.media.type||dfltMType,upMtype=capitalize(mType),mKeyType=ADB.Media.MediaType[upMtype]||dfltMType;var dfltSType="vod",customType=__dataLayer.media.contentType,sKeyType;if(customType)sKeyType=customType;
else var sType=customType||dfltSType,aod=mType=="audio"&&sType!="podcast",vod=mType=="video"&&!isLive,upSType=isLive?"Live":aod?"AOD":vod?"VOD":capitalize(sType),sKeyType=ADB.Media.StreamType[upSType]||dfltSType;var mediaObject=ADB.Media.createMediaObject(__dataLayer.media.media_name,__dataLayer.media.media_id,__dataLayer.media.length,sKeyType,mKeyType);return mediaObject};Bootstrapper.ADBhelper.sessionSetupStart=function(currentPlayer){var isESPN=__dataLayer.space==="espn",dlMedia=__dataLayer.media||
{},channel=dlMedia.contentType==="vod"?"vod":(dlMedia.network||"").toLowerCase();currentAdPod=0;if(typeof window.ADB==="undefined"||ADB.Media.getInstance()===null){Bootstrapper.Logging.logMsg("Failed to setup Adobe Media Object, window.ADB was undefined");return}var newAdobeTracker=isESPN?ADB.Media.getInstance({"media.channel":channel}):ADB.Media.getInstance();adobeTrackers.push(newAdobeTracker);if(currentPlayer&&currentPlayer.guid)Bootstrapper.adobeTrackerMap[currentPlayer.guid]=newAdobeTracker;
if(__dataLayer.media&&__dataLayer.media.dcfConfigs&&__dataLayer.media.dcfConfigs.disableDCF&&__dataLayer.media.dcfConfigs.disableDCF.adobe===true)return;var mediaObject=Bootstrapper.ADBhelper.createMediaObject();mediaObject["media.resumed"]=__dataLayer.media.seekInSeconds!=="N/A"&&__dataLayer.media.seekInSeconds!==0?true:false;Bootstrapper.hbConfig.computeContextData();var contextData=Bootstrapper.hbConfig.contextData||{};newAdobeTracker.trackSessionStart(mediaObject,contextData)};Bootstrapper.ADBhelper.adPodStart=
function(curAdobeTracker,playhead,eventData){if(curAdobeTracker===null)return;if(__dataLayer.media&&__dataLayer.media.dcfConfigs&&__dataLayer.media.dcfConfigs.disableDCF&&__dataLayer.media.dcfConfigs.disableDCF.adobe===true)return;var tempMediaObject=Bootstrapper.ADBhelper.createMediaObject();Bootstrapper.hbConfig.computeContextData();tempContextData=Bootstrapper.hbConfig.contextData||{};curAdobeTracker.trackSessionStart(tempMediaObject,tempContextData);var adType=eventData.type.replace("roll","-roll");
window.adPosition=1;currentAdPod++;var adBreakObject=ADB.Media.createAdBreakObject(adType,currentAdPod,playhead);curAdobeTracker.trackEvent(ADB.Media.Event.AdBreakStart,adBreakObject)};Bootstrapper.ADBhelper.adStart=function(curAdobeTracker){if(curAdobeTracker===null)return;var adObject=ADB.Media.createAdObject(__dataLayer.media.ad_name,__dataLayer.media.ad_id,adPosition,__dataLayer.media.ad_length),adMetaData={};adMetaData["media.ad.playerName"]=__dataLayer.media.ad_player;adMetaData[ADB.Media.AdMetadataKeys.CreativeId]=
__dataLayer.media.ad_creativeId;adMetaData[ADB.Media.AdMetadataKeys.CreativeUrl]=__dataLayer.media.ad_creativeUrl;window.adPosition+=1;curAdobeTracker.trackEvent(ADB.Media.Event.AdStart,adObject,adMetaData)};Bootstrapper.ADBhelper.playheadUpdate=function(curAdobeTracker,playhead){if(curAdobeTracker===null)return;curAdobeTracker.updatePlayhead(playhead)};Bootstrapper.ADBhelper.simpleTrackEvent=function(curAdobeTracker,eventName){if(curAdobeTracker===null)return;curAdobeTracker.trackEvent(eventName)};
Bootstrapper.ADBhelper.play=function(curAdobeTracker,playerDLname,eventName,eventData,currentPlayer){if(curAdobeTracker===null)return;if(__dataLayer.media&&__dataLayer.media.dcfConfigs&&__dataLayer.media.dcfConfigs.disableDCF&&__dataLayer.media.dcfConfigs.disableDCF.adobe===true)return;__dataLayer.updateMedia(playerDLname,eventName,eventData,currentPlayer);var tempMediaObject=Bootstrapper.ADBhelper.createMediaObject();Bootstrapper.hbConfig.computeContextData();var tempContextData=Bootstrapper.hbConfig.contextData||
{};curAdobeTracker.trackSessionStart(tempMediaObject,tempContextData);curAdobeTracker.trackPlay()};Bootstrapper.ADBhelper.pause=function(curAdobeTracker){if(curAdobeTracker===null)return;curAdobeTracker.trackPause()};Bootstrapper.ADBhelper.end=function(curAdobeTracker,endType){if(curAdobeTracker===null)return;if(endType&&endType=="complete")curAdobeTracker.trackComplete();curAdobeTracker.trackSessionEnd()};Bootstrapper.ADBhelper.error=function(curAdobeTracker,eventData){if(curAdobeTracker===null)return;
var errorString="unknown error";if(eventData){if(eventData.code)errorString=eventData.code;if(eventData.message)errorString+=": "+eventData.message}errorString=errorString.replace(/,/ig,"");curAdobeTracker.trackError(errorString);curAdobeTracker.trackSessionEnd()};var nielsenInstance=1,nielsenChannels={"abc":{"id":"us-300437","brand":"c02"},"abcn":{"id":"us-300437","brand":"c12"},"ff":{"id":"us-900873","brand":"c02"},"fx":{"id":"us-501166","brand":"c01"},"fxx":{"id":"us-501166","brand":"c02"},"fxm":{"id":"us-501166",
"brand":"c03"},"ngc":{"id":"us-308071","brand":"c01"},"ngw":{"id":"us-308071","brand":"c02"},"sec":{"id":"us-600140","brand":"c06"},"fivethirtyeight":{"id":"us-600140","brand":"c10"},"WPVI":{"id":"us-300437","brand":"c06"},"WTVD":{"id":"us-300437","brand":"c09"},"KTRK":{"id":"us-300437","brand":"c08"},"KFSN":{"id":"us-300437","brand":"c07"},"WLS":{"id":"us-300437","brand":"c15"},"WABC":{"id":"us-300437","brand":"c16"},"KGO":{"id":"us-300437","brand":"c14"},"KABC":{"id":"us-300437","brand":"c13"}};
Bootstrapper.nielsenHelper.getSubBrand=function(channel,type){return nielsenChannels[channel]&&nielsenChannels[channel][type]||""};Bootstrapper.nielsenHelper.getContentMetadata=function(){Bootstrapper.Logging.logMsg("Nielsen: Setting Nielsen Metadata for Content");var contentMetadataObject={},_dl=window.__dataLayer||{},site=_dl.site||{},siteDes=site.site||"",shouldSetExtendedMetadata=__dataLayer.media.format!=="live";if(siteDes==="espn"||siteDes=="watchespn"){shouldSetExtendedMetadata=true;if((__dataLayer.media.format||
"").toLowerCase()==="vod")contentMetadataObject.segA=__dataLayer.media.asset_title;contentMetadataObject.segB=__dataLayer.media.league;contentMetadataObject.segC=__dataLayer.media.contentType;contentMetadataObject.crossId2=__dataLayer.media.network}else if(siteDes==="abcn"){contentMetadataObject.progen="N";contentMetadataObject.crossId1=__dataLayer.media.media_id||"n/a";contentMetadataObject.crossId2="abcnews";if(__dataLayer.media.contentType==="live"){contentMetadataObject.segB="ABC News Live";contentMetadataObject.segC=
"Live Stream"}else contentMetadataObject.program="ABC News"}else if(isTVE){contentMetadataObject.program=__dataLayer.media.title||"";contentMetadataObject.title=__dataLayer.media.media_name||"";contentMetadataObject.crossId2=__dataLayer.media.network||"";contentMetadataObject.clientid=Bootstrapper.nielsenHelper.getSubBrand(__dataLayer.media.network,"id");contentMetadataObject.subbrand=Bootstrapper.nielsenHelper.getSubBrand(__dataLayer.media.network,"brand");if(__dataLayer.media.network==="abc")contentMetadataObject.affiliate=
__dataLayer.pzn.affiliate_id||""}else if(siteDes==="sec")contentMetadataObject.crossId2="ESPN";if(shouldSetExtendedMetadata){contentMetadataObject.type="content";contentMetadataObject.assetid=__dataLayer.media.media_id||"";contentMetadataObject.program=__dataLayer.media.media_name||"";contentMetadataObject.title=__dataLayer.media.title&&__dataLayer.media.title!="N/A"?__dataLayer.media.title:__dataLayer.media.media_name||"";contentMetadataObject.length=__dataLayer.media.duration&&__dataLayer.media.duration!==
"N/A"?__dataLayer.media.duration:0;contentMetadataObject.airdate=__dataLayer.media.air_date&&__dataLayer.media.air_date!=="N/A"?(new Date(__dataLayer.media.air_date)).toISOString().split(".")[0]:"";contentMetadataObject.isfullepisode=__dataLayer.media.contentType==="live"?"y":__dataLayer.media.full_episode||"";contentMetadataObject.adloadtype=__dataLayer.media.adLoadType||""}else{contentMetadataObject.type="content";contentMetadataObject.adModel="1"}Bootstrapper.Logging.logMsg("Nielsen: Nielsen Metadata: ",
contentMetadataObject);return contentMetadataObject};Bootstrapper.nielsenHelper.sessionSetupStart=function(currentPlayer){if(typeof window.NOLBUNDLE==="undefined"){Bootstrapper.Logging.logMsg("Nielsen: Failed to setup Nielsen Instance, window.NOLBUNDLE was undefined");return}if(typeof window.nielsenConfig==="undefined"){Bootstrapper.Logging.logMsg("Nielsen: no nielsen config found");return}Bootstrapper.nielsenHelper.newSessionFlag=false;Bootstrapper.Logging.logMsg("Nielsen: Starting Nielsen Session on playback");
var tempInstance,nielsenConfigId;var nielsenKey=(!!window.__dataLayer&&!!window.__dataLayer.site&&!!window.__dataLayer.site.portal?__dataLayer.site.portal:"")||__dataLayer.site.site.split("-")[0];if(/news|tve|sports/i.test(nielsenKey))nielsenKey=__dataLayer.site.site;var _config=nielsenConfig[nielsenKey]||nielsenConfig[nielsenKey.toUpperCase()]||{};if(__dataLayer.media.format.indexOf("live")>-1||__dataLayer.media.contentType&&__dataLayer.media.contentType.indexOf("live")>-1)nielsenConfigId=_config.dtvr;
else nielsenConfigId=_config.dcr;if(nielsenConfigId===undefined)return;tempInstance=NOLBUNDLE.nlsQ(nielsenConfigId,"nlsnInstance"+nielsenInstance);nielsenInstance++;nielsenInstances.push(tempInstance);if(currentPlayer&&currentPlayer.guid)Bootstrapper.nielsenTrackerMap[currentPlayer.guid]=tempInstance;if(__dataLayer.media&&__dataLayer.media.dcfConfigs&&__dataLayer.media.dcfConfigs.disableDCF&&__dataLayer.media.dcfConfigs.disableDCF.nielsen===true)return;var contentMetadataObject=Bootstrapper.nielsenHelper.getContentMetadata();
tempInstance.ggPM("loadMetadata",contentMetadataObject)};Bootstrapper.nielsenHelper.playheadUpdate=function(curNielsenTracker,playhead){if(curNielsenTracker===null||typeof playhead!=="number")return;var playheadSeconds=typeof playhead==="number"?Math.floor(playhead):1;if(playheadSeconds<0)return;if(curNielsenTracker.lastPlayhead==playheadSeconds)return;curNielsenTracker.lastPlayhead=playheadSeconds;if(__dataLayer.media.contentType==="live")playheadSeconds=Math.floor(Date.now()/1E3);curNielsenTracker.ggPM("setPlayheadPosition",
playheadSeconds);Bootstrapper.Logging.logMsg("Nielsen: Updating Nielsen Playhead: ",playheadSeconds)};Bootstrapper.nielsenHelper.adStart=function(curNielsenTracker,adType){if(curNielsenTracker===null)return;else if(__dataLayer.media&&__dataLayer.media.dcfConfigs&&__dataLayer.media.dcfConfigs.disableDCF&&__dataLayer.media.dcfConfigs.disableDCF.nielsen===true)return;var adMetadataObject={type:adType,assetid:__dataLayer.media.ad_id};Bootstrapper.Logging.logMsg("Nielsen: Nielsen Ads Started with metadata: ",
adMetadataObject);curNielsenTracker.ggPM("loadMetadata",adMetadataObject)};Bootstrapper.nielsenHelper.play=function(curNielsenTracker){if(curNielsenTracker===null)return;else if(__dataLayer.media&&__dataLayer.media.dcfConfigs&&__dataLayer.media.dcfConfigs.disableDCF&&__dataLayer.media.dcfConfigs.disableDCF.nielsen===true)return;var contentMetadataObject=Bootstrapper.nielsenHelper.getContentMetadata();Bootstrapper.Logging.logMsg("Nielsen: Sending Play Event for Nielsen Tracking");curNielsenTracker.ggPM("loadMetadata",
contentMetadataObject)};Bootstrapper.nielsenHelper.pause=function(curNielsenTracker,playhead){if(curNielsenTracker===null)return;Bootstrapper.Logging.logMsg("Nielsen: Sending Pause Event for Nielsen Tracking");var playheadSeconds=typeof playhead==="number"?Math.floor(playhead):1;curNielsenTracker.ggPM("stop",playheadSeconds)};Bootstrapper.nielsenHelper.end=function(curNielsenTracker,playhead){if(curNielsenTracker===null)return;Bootstrapper.Logging.logMsg("Nielsen: Sending End Event for Nielsen Tracking");
Bootstrapper.nielsenHelper.newSessionFlag=true;var playheadSeconds=typeof playhead==="number"?Math.floor(playhead):1;curNielsenTracker.ggPM("stop",playheadSeconds);curNielsenTracker.ggPM("end",playheadSeconds)};Bootstrapper.getC3=function(_callLetters){var callLetters=_callLetters||"",map={"kabc":"kabc","kgo":"kgo","kfsn":"kfsn","ktrk":"ktrk","wtvd":"wtvd","wabc":"wabc","wls":"wls","wpvi":"wpvi","andscape":"andscape","theundefeated":"andscape","abcn":"abcnews.com","video.disney.com":"DISNEYVIDEOS",
"music.disney.com":"DISNEYMUSIC","liveshows.disney.com":"DLIVE","movies.disney.com":"DISNEYMOVIES","nature.disney.com":"DISNEYNATURE","princess.disney.com":"PRI","pirates.disney.com":"PIR","shows.disney.com":"DISNEYSHOWS","toystory.disney.com":"TOY","muppets.disney.com":"DISNEYMUPPETS","films.nationalgeographic.com":"DISNEYNATGEO","fairies.disney.com":"FAI","cars.disney.com":"CARS","gma":"GMA","abc":"abc.com","ff":"freeform.com","fxn":"fxnetworks.com","ngtv":"nationalgeographic.com/tv","natgeo":"nationalgeographic.com",
"fivethirtyeight":"Fivethirtyeight"};if(_callLetters==="sec"){var type="";if(__dataLayer.media.format==="live"||__dataLayer.media.contentType==="live")type="live";else if(__dataLayer.media.format==="replay")type="replay";else type="vod";return type}if(!!window.__dataLayer&&!!window.__dataLayer.site&&!!window.__dataLayer.site.portal&&__dataLayer.site.portal==="matterhorn"&&!map[callLetters])return"matterhorn";return map[callLetters]||callLetters};Bootstrapper.getC4=function(_callLetters,type){var callLetters=
_callLetters||"",map={vod:{"abcn":"abcnewsdigital","sec":"SECSPORTS","fivethirtyeight":"abcnewsdigital"},live:{"abcn":"abcnewslive","sec":"SECSPORTS","fivethirtyeight":"abcnewslive"}};if(/espn|fantasy/i.test(__dataLayer.site.site)){if(__dataLayer.site.site==="fantasy")return"fantasy - nonplus";else if(__dataLayer.site.editionKey==="espn-es-us")return"espndeportescom - nonplus";return"espncom - nonplus"}return map[type][callLetters]||"*null"};var userConsentValue=!!window.gateway&&!gateway.environment&&
Bootstrapper.Cookies.get("usprivacy")!=="1YYY"?"1":"0",siteKey,publisherId,cGenre="*null",setC4Val,publisherName,c6Val;if(/(^|\.)(6abc|abc11|abc13|abc30|abc7|abc7chicago|abc7news|abc7ny|abcotvs(sb|qa)?)\.com(:\d+)?$/i.test(location.hostname)){if(/\/video\/embed/i.test(location.pathname)&&/partner=google/i.test(location.search)&&/source=google/i.test(location.search))publisherId="3000032";else publisherId="15382676";siteKey="ABC Local";cGenre="News"}else if(/fftv|freeform/i.test(location.hostname)){siteKey=
"freeform";publisherId="15382774"}else if(/fxtv|fxnetworks/i.test(location.hostname)){siteKey=__dataLayer.pzn.affiliate_id||__dataLayer.pzn.mvpdName;publisherId="31864640"}else if(/natgeo|ngtv|nationalgeographic/i.test(location.hostname)){siteKey=__dataLayer.pzn.affiliate_id||__dataLayer.pzn.mvpdName;publisherId="31864641"}else if(/fivethirtyeight|538/i.test(location.hostname)){siteKey="FiveThirtyEight";publisherId="15382676";cGenre="News"}else if(/espn|andscape|undefeated/i.test(location.hostname)){siteKey=
"ESPN";publisherId="3000005";cGenre="Sports";if(location.hostname.indexOf("espn")>-1)setC4Val=true}else if(/abcnews|goodmorningamerica/i.test(location.hostname)){siteKey="ABCNews";publisherId="15382676";cGenre="News";setC4Val=true}else if(location.hostname.toLowerCase().indexOf("abc")>-1){siteKey=__dataLayer.pzn.affiliate_id||__dataLayer.pzn.mvpdName||"ABC";publisherId="15382676";setC4Val=true}else if(!!window.__dataLayer&&!!window.__dataLayer.site&&!!window.__dataLayer.site.portal&&__dataLayer.site.portal===
"matterhorn"){siteKey="Matterhorn";publisherId="15354235"}else if(/secsports\.com/i.test(location.hostname)){siteKey="sec";publisherId="3000005";setC4Val=true;publisherName="ESPN";cGenre="Sports";if(__dataLayer.page.sport||__dataLayer.page.league)c6Val=__dataLayer.page.sport||__dataLayer.page.league}if(publisherId!==undefined)window.waitForComscore=setInterval(function(){if(!!window.ns_&&!!window.ns_.analytics){clearInterval(waitForComscore);Bootstrapper.comscoreAnalytics=window.ns_.analytics;Bootstrapper.comscoreAnalytics.PlatformApi.setPlatformAPI(Bootstrapper.comscoreAnalytics.PlatformApi.PlatformApis.WebBrowser);
Bootstrapper.comscoreAnalytics.configuration.addClient(new Bootstrapper.comscoreAnalytics.configuration.PublisherConfiguration({"publisherId":publisherId,"persistentLabels":{"cs_ucfr":userConsentValue}}));Bootstrapper.comscoreAnalytics.configuration.setApplicationName("Unified Player");Bootstrapper.comscoreAnalytics.configuration.enableFirstPartyCookie()}},500);Bootstrapper.comscoreHelper.validate=function(val){if(val=="N/A"||val=="none")return"*null";return val};Bootstrapper.comscoreHelper.splitDateParts=
function(dateString){var dateFormat=/(\d{4})-?(\d{2})-?(\d{2})/;if(typeof dateString!=="string"||!dateFormat.test(dateString))return"*null";var matches=dateFormat.exec(dateString);return matches?[matches[1],matches[2],matches[3]].map(function(match){return parseInt(match)}):"*null"};Bootstrapper.comscoreHelper.formatISO=function(dateString){try{return(new Date(dateString)).toISOString()}catch(e){return dateString}};Bootstrapper.comscoreHelper.secondsToMilliseconds=function(seconds){try{return isNaN(parseInt(seconds))?
0:parseInt(seconds)*1E3}catch(e){return 0}};Bootstrapper.comscoreHelper.sessionSetupStart=function(currentPlayer){if(__dataLayer.media&&__dataLayer.media.dcfConfigs&&__dataLayer.media.dcfConfigs.disableDCF&&__dataLayer.media.dcfConfigs.disableDCF.comscore===true)return;if(typeof Bootstrapper.comscoreAnalytics==="undefined"){Bootstrapper.Logging.logMsg("comscoreAnalytics not configured, no publisherId");return}if(!Bootstrapper.comscoreHelper.hasInit){Bootstrapper.comscoreAnalytics.start();Bootstrapper.comscoreAnalytics.players=
[];Bootstrapper.comscoreAnalytics.sa_array=[];Bootstrapper.comscoreAnalytics.cm_array=[];Bootstrapper.comscoreAnalytics.cm_map={};Bootstrapper.comscoreHelper.hasInit=true}Bootstrapper.comscoreAnalytics.lastEvent="";Bootstrapper.comscoreHelper.newSessionFlag=false;Bootstrapper.comscoreAnalytics.players.push(currentPlayer);var curPlayerIndex=Bootstrapper.comscoreAnalytics.players.indexOf(currentPlayer)===-1?Bootstrapper.comscoreAnalytics.sa_array.length-1:Bootstrapper.comscoreAnalytics.players.indexOf(currentPlayer);
Bootstrapper.comscoreAnalytics.sa_array.push(new Bootstrapper.comscoreAnalytics.StreamingAnalytics);Bootstrapper.comscoreAnalytics.sa_array[curPlayerIndex].createPlaybackSession();var cm=new Bootstrapper.comscoreAnalytics.StreamingAnalytics.ContentMetadata,mediaItem=currentPlayer.mediaItem||currentPlayer.bundle_.player_.mediaItem,mediaType=__dataLayer.media.format==="live"||__dataLayer.media.contentType==="live"?Bootstrapper.comscoreAnalytics.StreamingAnalytics.ContentMetadata.ContentType.LIVE:__dataLayer.media.duration<
600?Bootstrapper.comscoreAnalytics.StreamingAnalytics.ContentMetadata.ContentType.SHORT_FORM_ON_DEMAND:Bootstrapper.comscoreAnalytics.StreamingAnalytics.ContentMetadata.ContentType.LONG_FORM_ON_DEMAND,siteKey=Bootstrapper.getC3(__dataLayer.site.site)||__dataLayer.site.site,stationTitle=__dataLayer.media.stationTitle||"",programTitle=Bootstrapper.comscoreHelper.validate(__dataLayer.media.program),seasonNumber=Bootstrapper.comscoreHelper.validate(__dataLayer.media.season),episodeNumber=Bootstrapper.comscoreHelper.validate(__dataLayer.media.episodeNumber),
episodeTitle=Bootstrapper.comscoreHelper.validate(__dataLayer.media.title),networkAffiliate=Bootstrapper.comscoreHelper.validate(__dataLayer.media.network),fDuration=__dataLayer.media.duration||mediaItem.duration||0,isLive=__dataLayer.media.format==="live"||__dataLayer.media.contentType==="live";fDuration=mediaItem&&mediaItem.streamType==="live"?0:fDuration;cm.setMediaType(mediaType);cm.setUniqueId(mediaItem.id);cm.setLength(Bootstrapper.comscoreHelper.secondsToMilliseconds(fDuration));cm.setStationTitle(stationTitle||
__dataLayer.site.site);if(mediaItem.c3||mediaItem.tracking&&mediaItem.tracking.comscore&&mediaItem.tracking.comscore.c3||siteKey)cm.setDictionaryClassificationC3(mediaItem.c3||(mediaItem.tracking&&mediaItem.tracking.comscore&&mediaItem.tracking.comscore.c3?mediaItem.tracking.comscore.c3:null)||siteKey);if(setC4Val)if(mediaItem.c4||mediaItem.tracking&&mediaItem.tracking.comscore&&mediaItem.tracking.comscore.c4)cm.setDictionaryClassificationC4(mediaItem.c4||mediaItem.tracking.comscore.c4);else cm.setDictionaryClassificationC4(Bootstrapper.getC4(__dataLayer.site.site,
isLive?"live":"vod"));if(siteKey==="andscape"||siteKey==="the undefeated")cm.setDictionaryClassificationC6(siteKey);if(currentPlayer.bundle_.player_.mediaItem.show&&currentPlayer.bundle_.player_.mediaItem.show.showPrefix&&currentPlayer.bundle_.player_.mediaItem.show.showPrefix.length>0)cm.setDictionaryClassificationC6(currentPlayer.bundle_.player_.mediaItem.show.showPrefix);if(c6Val||mediaItem.c6||mediaItem.tracking&&mediaItem.tracking.comscore&&mediaItem.tracking.comscore.c6)cm.setDictionaryClassificationC6(c6Val||
mediaItem.c6||mediaItem.tracking.comscore.c6);cm.setPublisherName(publisherName||stationTitle||siteKey);cm.setProgramTitle(programTitle);cm.setEpisodeTitle(episodeTitle);cm.setEpisodeSeasonNumber(seasonNumber);cm.setEpisodeNumber(episodeNumber);if(__dataLayer.media.format.indexOf("live")>-1)if(currentPlayer.bundle_.player_.mediaItem.location&&currentPlayer.bundle_.player_.mediaItem.location.indexOf("WEST")>-1)cm.setFeedType(Bootstrapper.comscoreAnalytics.StreamingAnalytics.ContentMetadata.ContentFeedType.WEST_HD);
else cm.setFeedType(Bootstrapper.comscoreAnalytics.StreamingAnalytics.ContentMetadata.ContentFeedType.EAST_HD);cm.setNetworkAffiliate(networkAffiliate);if(isTVE)cGenre=__dataLayer.media.genre||mediaItem.videoShowGenre||"*null";cm.setGenreName(cGenre);var tvAirDateString=Bootstrapper.comscoreHelper.formatISO(__dataLayer.media.air_date),checkTVAirDate=Bootstrapper.comscoreHelper.validate(tvAirDateString),tvAirDate=checkTVAirDate==="*null"?checkTVAirDate:Bootstrapper.comscoreHelper.splitDateParts(checkTVAirDate);
var digitalDateString=Bootstrapper.comscoreHelper.formatISO(__dataLayer.media.digital_date),checkDigitalDate=Bootstrapper.comscoreHelper.validate(digitalDateString),digitalDate=checkTVAirDate==="*null"?checkDigitalDate:Bootstrapper.comscoreHelper.splitDateParts(checkDigitalDate);if(Array.isArray(tvAirDate))cm.setDateOfTvAiring(tvAirDate[0],tvAirDate[1],tvAirDate[2]);if(Array.isArray(digitalDate))cm.setDateOfTvAiring(digitalDate[0],digitalDate[1],digitalDate[2]);var completeEpisode=__dataLayer.media.full_episode&&
__dataLayer.media.full_episode==="y"?true:false;cm.classifyAsCompleteEpisode(completeEpisode);Bootstrapper.comscoreAnalytics.cm_array.push(cm);Bootstrapper.comscoreAnalytics.sa_array[curPlayerIndex].setMetadata(cm);if(currentPlayer&&currentPlayer.guid){Bootstrapper.comscoreAnalytics.cm_map[currentPlayer.guid]=cm;Bootstrapper.comscoreTrackerMap[currentPlayer.guid]=Bootstrapper.comscoreAnalytics.sa_array[curPlayerIndex]}};Bootstrapper.comscoreHelper.getContentMeta=function(currentPlayer){var currentMetadata;
if(currentPlayer&&currentPlayer.guid){currentMetadata=Bootstrapper.comscoreAnalytics.cm_map[currentPlayer.guid];if(currentMetadata)return currentMetadata}currentMetadata=Bootstrapper.comscoreAnalytics.cm_array[Bootstrapper.comscoreAnalytics.players.indexOf(currentPlayer)];return currentMetadata};Bootstrapper.comscoreHelper.play=function(curTracker,currentPlayer){if(curTracker===null)return;else if(__dataLayer.media&&__dataLayer.media.dcfConfigs&&__dataLayer.media.dcfConfigs.disableDCF&&__dataLayer.media.dcfConfigs.disableDCF.comscore===
true)return;var cm=Bootstrapper.comscoreHelper.getContentMeta(currentPlayer);curTracker.setMetadata(cm);if(Bootstrapper.comscoreHelper.seeked===1){var lpHead=__dataLayer.media.lastPlayhead,lpHeadMillis=Bootstrapper.comscoreHelper.secondsToMilliseconds(lpHead);if(lpHeadMillis){curTracker.startFromPosition(lpHeadMillis);Bootstrapper.comscoreHelper.seeked=0}}curTracker.notifyPlay()};Bootstrapper.comscoreHelper.end=function(curTracker){if(curTracker===null)return;curTracker.notifyEnd();Bootstrapper.comscoreHelper.newSessionFlag=
true};Bootstrapper.comscoreHelper.pause=function(curTracker){if(curTracker===null)return;curTracker.notifyPause()};Bootstrapper.comscoreHelper.seeking=function(curTracker){var ignoreEvents=["dtci.loaded","dtci.contentEnded","dtci.play","dtci.playing"];if(curTracker===null||ignoreEvents.indexOf(Bootstrapper.last_hb_event)>-1)return;curTracker.notifySeekStart();Bootstrapper.comscoreHelper.seeked=1};Bootstrapper.comscoreHelper.adStart=function(curTracker,playerInfo,currentPlayer,eventData){if(curTracker===
null)return;else if(__dataLayer.media&&__dataLayer.media.dcfConfigs&&__dataLayer.media.dcfConfigs.disableDCF&&__dataLayer.media.dcfConfigs.disableDCF.comscore===true)return;var am=new Bootstrapper.comscoreAnalytics.StreamingAnalytics.AdvertisementMetadata;var adType=eventData.type==="preroll"?Bootstrapper.comscoreAnalytics.StreamingAnalytics.AdvertisementMetadata.AdvertisementType.ON_DEMAND_PRE_ROLL:eventData.type==="midroll"?Bootstrapper.comscoreAnalytics.StreamingAnalytics.AdvertisementMetadata.AdvertisementType.ON_DEMAND_MID_ROLL:
eventData.type==="postroll"?Bootstrapper.comscoreAnalytics.StreamingAnalytics.AdvertisementMetadata.AdvertisementType.ON_DEMAND_POST_ROLL:"";am.setMediaType(adType);am.setLength(__dataLayer.media.ad_length?Bootstrapper.comscoreHelper.secondsToMilliseconds(__dataLayer.media.ad_length):0);var cm=Bootstrapper.comscoreHelper.getContentMeta(currentPlayer);am.setRelatedContentMetadata(cm);curTracker.setMetadata(am);curTracker.notifyPlay()};Bootstrapper.comscoreHelper.adPlay=function(curTracker){if(curTracker===
null)return;curTracker.notifyPlay()};Bootstrapper.comscoreHelper.adPause=function(curTracker){if(curTracker===null)return;curTracker.notifyPause()};Bootstrapper.comscoreHelper.adEnd=function(curTracker){if(curTracker===null)return;curTracker.notifyEnd()};Bootstrapper.Conviva=Bootstrapper.Conviva||{};Bootstrapper.Conviva.isLive=function(index,curTrackerBundle){var dlMedia=__dataLayer.media||{},meta=dlMedia.qoe||[],metaBundle=meta[index]||{},qoe=metaBundle.playback||{};var isLive=qoe.isLive&&qoe.isLive===
"live"||dlMedia.format==="live"||dlMedia.contentType==="live"?true:false;if(!curTrackerBundle.curLive||curTrackerBundle.curLive!=isLive)curTrackerBundle.curLive=isLive;return isLive};Bootstrapper.Conviva.getContentAssetName=function(index,curTrackerBundle){var media=__dataLayer.media||{},meta=media.qoe||[],metaBundle=meta[index]||{},qoe=metaBundle.playback||{},name=media.media_name,title=media.title,assetName=media.asset_title;var trackName=qoe.assetName||name||title||assetName;if(!curTrackerBundle.curTitle||
curTrackerBundle!=trackName)curTrackerBundle=trackName;return trackName};Bootstrapper.Conviva.resetDefaultValue=function(str){var check=/N\/A|none|unknown/i;return check.test(str)?str.replace(/N\/A|none|unknown/i,"NA"):str};Bootstrapper.Conviva.setInitialContentInfo=function(curPlayer,index,curTrackerBundle){var dl=__dataLayer,visitor=dl.visitor||{},media=dl.media||{},meta=media.qoe||[],metaBundle=meta[index]||{},qoe=metaBundle.playback||{},bundle=curPlayer.bundle_||{},player=bundle.player_||{},mediaItem=
player.mediaItem||{},playerTech=player.tech_||{},hostname=location.hostname,href=location.href,pathName=location.pathname;var requiredMetadata={};var swid=qoe.viewerId||visitor.swid,playerName=qoe.playerName||media.player_name||"Unified_TMS",platformVersion=qoe.platformVersion||qoe.applicationVersion||media.player_name||curPlayer.platformVersion||"NA",duration=media.duration||mediaItem.duration||0,currentSrc=qoe.streamUrl?qoe.streamUrl:typeof playerTech.currentSrc==="function"?playerTech.currentSrc():
"",utmUrl=qoe["c3.cm.utmTrackingUrl"]||location.search||"NA";requiredMetadata[Conviva.Constants.PLAYER_NAME]=playerName;requiredMetadata[Conviva.Constants.APPLICATION_VERSION]=platformVersion;requiredMetadata[Conviva.Constants.STREAM_URL]=currentSrc;requiredMetadata[Conviva.Constants.VIEWER_ID]=swid;requiredMetadata[Conviva.Constants.ASSET_NAME]=curTrackerBundle.curTitle||Bootstrapper.Conviva.getContentAssetName(index,curTrackerBundle);requiredMetadata[Conviva.Constants.IS_LIVE]=curTrackerBundle.curLive||
Bootstrapper.Conviva.isLive(index,curTrackerBundle)?Conviva.Constants.StreamType.LIVE:Conviva.Constants.StreamType.VOD;requiredMetadata[Conviva.Constants.DURATION]=duration;requiredMetadata["c3.cm.utmTrackingUrl"]=utmUrl;if(qoe.dcType)Conviva.Analytics.reportDeviceMetric(Conviva.Constants.Network.CONNECTION_TYPE,qoe.dcType);var brandMetadata={},videoResolution,startType=qoe.startType||media.start_type,mediaType=qoe.mediaType||media.contentType,site=location.href||qoe.site||hostname,page=qoe.page||
href,path=qoe.path||pathName;if(qoe.videoResolution)videoResolution=qoe.videoResolution;else if(typeof playerTech.currentDimensions==="function")var dimensions=playerTech.currentDimensions(),width=dimensions.width,height=dimensions.height,videoResolution=height&&width?Math.round(width)+"x"+Math.round(height):null;else videoResolution="x";if(Bootstrapper.Conviva.config.metaAccount==="dmed"){brandMetadata.startType=startType;brandMetadata.contentLengthSec=typeof duration=="number"?""+duration:duration;
brandMetadata.site=site;brandMetadata.page=page;brandMetadata.mediaType=mediaType;brandMetadata.videoResolution=videoResolution}else if(Bootstrapper.Conviva.config.metaAccount==="sec"){brandMetadata.page=page;brandMetadata.mediaType=mediaType;brandMetadata.path=path;brandMetadata.startType=startType;brandMetadata.videoResolution=videoResolution}var playerInfo=Object.assign(requiredMetadata,brandMetadata);for(var key in playerInfo)if(Object.hasOwnProperty.call(playerInfo,key))playerInfo[key]=Bootstrapper.Conviva.resetDefaultValue(playerInfo[key]);
return playerInfo};Bootstrapper.Conviva.setContentInfo=function(curPlayer,index,curTrackerBundle){var dl=__dataLayer,visitor=dl.visitor||{},media=dl.media||{},meta=media.qoe||[],metaBundle=meta[index]||{},qoe=metaBundle.playback||{},pzn=dl.pzn||{},bundle=curPlayer.bundle_||{},player=bundle.player_||{},mediaItem=player.mediaItem||{},tracking=mediaItem.tracking||{},heartbeats=tracking.heartbeats||{},playerTech=player.tech_||{},hostname=location.hostname,page=dl.page.page_name||qoe.page||location.href,
pathName=location.pathname;var requiredMetadata={};var affiliate=qoe["c3.cm.affiliate"]||media.affiliate_name||"NA",brand=Bootstrapper.Conviva.appBrand||qoe.appBrand||"NA",assetType=qoe["c3.cm.contentType"]||media.type||media.contentType,audioLanguage=qoe.audioLanguage||"NA",browser=qoe.browser||"NA",browserVersion=qoe.browserVersion||"NA",captionLanguage=qoe.captionLanguage||"NA",categoryType=qoe["contentCategory"]||qoe["c3.cm.categoryType"]||"NA",channel=qoe["c3.cm.channel"]||heartbeats.Channel||
media.network||"NA",cmsName=qoe.name||qoe["c3.cm.name"]||"NA",cmsId=qoe["c3.cm.id"]||heartbeats.CMSID||"NA",cmBrand=qoe["c3.cm.brand"]||qoe.appBrand||"NA",createdDate=qoe.createdDate||"NA",currentSrc=qoe.streamUrl?qoe.streamUrl:typeof playerTech.currentSrc==="function"?playerTech.currentSrc():"",dcType=qoe.dcType!="unknown"?qoe.dcType:"NA",description=qoe.description||"NA",deviceMarketingName=qoe.deviceMarketingName||"NA",deviceName=qoe.deviceName||"NA",deviceOs=qoe.deviceOs||"NA",display=qoe.display||
"NA",duration=qoe.contentLengthSec||media.duration||mediaItem.duration||0,episodeNumber=qoe["episodeNumber"]||qoe["c3.cm.episodeNumber"]||media.episodeNumber||"NA",fps=qoe["fps"]||"NA",frameworkName=qoe.frameworkName||"NA",frameworkVersion=qoe.frameworkVersion||"NA",genre=qoe["genre"]||qoe["c3.cm.genre"]||media.genre||"NA",genreList=qoe["c3.cm.genreList"]||"NA",network=qoe.network||"NA",playerName=qoe.playerName||media.player_name||"Unified_TMS",platformVersion=qoe.appVersion||qoe.platformVersion||
qoe.applicationVersion||media.player_name||curPlayer.platformVersion||"NA",provider=qoe.provider||"NA",resolution=qoe.resolution||"NA",resource=qoe.resource||"NA",Resource=qoe.Resource||"NA",row=qoe.row||"NA",seriesName=qoe["seriesName"]||qoe["c3.cm.seriesName"]||"NA",seasonNumber=qoe["seasonNumber"]||qoe["c3.cm.seasonNumber"]||media.season||"NA",showcode=qoe.showcode||"NA",showTitle=qoe["c3.cm.showTitle"]||media.media_name||"NA",startType=qoe.startType||"NA",streamProtocol=qoe.streamProtocol||"NA",
streamType=media.format,subtitleLanguage=qoe.subtitleLanguage||"NA",swid=qoe.viewerId||visitor.swid,title=qoe.title||"NA",tvRating=qoe.tvRating||"NA",type=qoe.type||"NA",updatedDate=qoe.updatedDate||"NA",url=qoe.url||"NA",utmUrl=qoe["c3.cm.utmTrackingUrl"]||location.search||"NA",vod=qoe.vod||"NA";requiredMetadata[Conviva.Constants.PLAYER_NAME]=playerName;requiredMetadata[Conviva.Constants.APPLICATION_VERSION]=platformVersion;requiredMetadata[Conviva.Constants.STREAM_URL]=currentSrc;requiredMetadata[Conviva.Constants.ASSET_NAME]=
curTrackerBundle.curTitle||Bootstrapper.Conviva.getContentAssetName(index,curTrackerBundle);requiredMetadata[Conviva.Constants.IS_LIVE]=curTrackerBundle.curLive||Bootstrapper.Conviva.isLive(index,curTrackerBundle)?Conviva.Constants.StreamType.LIVE:Conviva.Constants.StreamType.VOD;requiredMetadata[Conviva.Constants.VIEWER_ID]=swid||"NA";requiredMetadata[Conviva.Constants.FRAMEWORK_NAME]=frameworkName;requiredMetadata[Conviva.Constants.FRAMEWORK_VERSION]=frameworkVersion;requiredMetadata[Conviva.Constants.DURATION]=
duration;requiredMetadata.streamProtocol=streamProtocol;requiredMetadata.appBrand=brand;requiredMetadata.resource=resource;requiredMetadata.dcType=dcType;requiredMetadata.contentLengthSec=typeof duration=="number"?""+duration:duration;requiredMetadata["c3.cm.contentType"]=assetType||streamType;requiredMetadata["c3.cm.channel"]=channel;requiredMetadata["Brand"]=cmBrand;requiredMetadata["c3.cm.affiliate"]=affiliate;requiredMetadata["c3.cm.categoryType"]=categoryType;requiredMetadata["c3.cm.name"]=cmsName;
requiredMetadata["c3.cm.id"]=cmsId;requiredMetadata["c3.cm.seriesName"]=seriesName;requiredMetadata["c3.cm.seasonNumber"]=seasonNumber;requiredMetadata["c3.cm.showTitle"]=showTitle;requiredMetadata["c3.cm.episodeNumber"]=episodeNumber;requiredMetadata["c3.cm.genre"]=genre;requiredMetadata["c3.cm.genreList"]=genreList;requiredMetadata["c3.cm.utmTrackingUrl"]=utmUrl;requiredMetadata["Application Name"]=cmBrand+" WEB";if(!!window.__dataLayer&&__dataLayer.site&&__dataLayer.site.site&&__dataLayer.site.site===
"fxnetworks"){requiredMetadata.AdstreamTag=qoe.AdstreamTag;requiredMetadata.playerName=qoe.playerName;requiredMetadata.createdDate=createdDate;requiredMetadata.deviceCategory=qoe.deviceCategory;requiredMetadata.display=display;requiredMetadata[Conviva.Constants.DURATION]=duration;requiredMetadata[Conviva.Constants.ENCODED_FRAMERATE]=Number(fps);requiredMetadata.network=network;requiredMetadata[Conviva.Constants.PLAYER_NAME]=qoe.playerName||"Akamai Media Player";requiredMetadata.Rating=qoe.Rating;
requiredMetadata.resolution=resolution;requiredMetadata[Conviva.Constants.DEFAULT_RESOURCE]=Resource;requiredMetadata.showCode=qoe.showCode;requiredMetadata.startType=startType;requiredMetadata.streamProtocol="";requiredMetadata.videoType=qoe.videoType;requiredMetadata.updatedDate=updatedDate;requiredMetadata.videoPage=qoe.videoPage;requiredMetadata.videoTitle=qoe.videoTitle}var brandMetadata={},type=qoe.mediaType||media.contentType,drmProtectionType=qoe.drmProtectionType||"NA",startType=qoe.startType||
media.start_type,sport=qoe.sport||"NA",league=qoe.league||"NA",accessType=qoe.accessType||"NA",spoId=qoe.spoId||"NA",mvpd=qoe.mvpd||pzn.mvpdName||"NA",network=qoe.network||"NA",audioLanguage=qoe.audioLanguage||"NA",locationName=qoe.locationName||"NA",plt=qoe.plt||"NA",eventName=qoe.eventName||"NA",eventType=qoe.eventType||"NA",partnerSDK=qoe.partnerSDK||"NA",pccId=qoe.pccId||"NA",airingId=qoe.airingId||"NA",cdnName=qoe.cdnName||"NA",prt=qoe.prt||"NA",appVersion=qoe.appVersion||qoe["c3.app.version"]||
"NA",eventId=qoe.eventId||"NA",drmProtocol=qoe.drmProtocol||"NA",disneyPlayerVersion=qoe.disneyPlayerVersion||qoe.frameworkVersion||"NA",bundleVersion=qoe.frameworkVersion||qoe.bundleVersion||"NA",videoResolution;if(qoe.videoResolution)videoResolution=qoe.videoResolution;else if(typeof playerTech.currentDimensions==="function")var dimensions=playerTech.currentDimensions(),width=dimensions.width,height=dimensions.height,videoResolution=height&&width?Math.round(width)+"x"+Math.round(height):null;else videoResolution=
"x";if(Bootstrapper.Conviva.config.metaAccount==="dmed"){brandMetadata.startType=startType;brandMetadata.drmProtectionType=drmProtectionType;brandMetadata.videoResolution=videoResolution;brandMetadata.sport=sport;brandMetadata.league=league;brandMetadata.spoId=spoId;brandMetadata.site=qoe.site||hostname;brandMetadata.page=page;brandMetadata.mediaType=type;brandMetadata.accessType=accessType;brandMetadata.network=network;brandMetadata.audioLanguage=audioLanguage;brandMetadata.locationName=locationName;
brandMetadata.plt=plt;brandMetadata.airingId=airingId;brandMetadata.mvpd=mvpd;brandMetadata.eventName=eventName;brandMetadata.eventType=eventType;brandMetadata.partnerSDK=partnerSDK;brandMetadata.pccId=pccId;brandMetadata.cdnName=cdnName;brandMetadata.prt=prt;brandMetadata["Disney Player Version"]=disneyPlayerVersion}else if(Bootstrapper.Conviva.config.metaAccount==="sec"){brandMetadata.affiliate=affiliate;brandMetadata.airingId=airingId;brandMetadata.assetType=assetType;brandMetadata.eventId=eventId;
brandMetadata.league=league;brandMetadata.mediaType=type;brandMetadata.network=network;brandMetadata.site=qoe.site||hostname;brandMetadata.sport=sport;brandMetadata.userId=swid;brandMetadata.page=page;brandMetadata.path=pathName;brandMetadata.startType=startType;brandMetadata.prt=brand;brandMetadata.videoResolution=videoResolution;brandMetadata.spoId=spoId;brandMetadata.accessType=accessType;brandMetadata.audioLanguage=audioLanguage;brandMetadata.locationName=locationName;brandMetadata.plt=plt;brandMetadata.cdnName=
cdnName;brandMetadata.mvpd=mvpd;brandMetadata.eventName=eventName;brandMetadata.eventType=eventType;brandMetadata.partnerSDK=partnerSDK;brandMetadata.pccId=pccId;brandMetadata.drmProtocol=drmProtocol;brandMetadata["Disney Player Version"]=disneyPlayerVersion;brandMetadata.bundleVersion=bundleVersion}var contentInfo=Object.assign(requiredMetadata,brandMetadata);for(var key in contentInfo)if(Object.hasOwnProperty.call(contentInfo,key))contentInfo[key]=Bootstrapper.Conviva.resetDefaultValue(contentInfo[key]);
return contentInfo};Bootstrapper.Conviva.setAdInfo=function(curPlayer,index,curTrackerBundle){var dl=__dataLayer,visitor=dl.visitor||{},media=dl.media||{},meta=media.qoe||[],metaBundle=meta[index]||{},qoe=metaBundle.ads||{},bundle=curPlayer.bundle_||{},player=bundle.player_||{},playerTech=player.tech_||{},currentSrc;var adTitle=qoe.assetName||media.ad_name||media.ad_id||"NA",swid=visitor.swid||"NA",currentSrc=qoe.streamUrl?qoe.streamUrl:typeof playerTech.currentSrc==="function"?playerTech.currentSrc():
"",duration=qoe.duration||media.ad_length||0,encodedFramerate=qoe.encodedFramerate||0,brand=Bootstrapper.Conviva.appBrand||qoe.appBrand||"NA";var adTechnology=qoe["c3.ad.technology"]==="Client Side"||qoe["c3.ad.technology"]==="Server Side"?qoe["c3.ad.technology"]:"Client Side",adId=qoe["c3.ad.id"]||media.ad_id||"NA",adSystem=qoe["c3.ad.system"]||"NA",adPosition=qoe["c3.ad.position"]||"Pre-roll",adIsSlate=typeof qoe["c3.ad.isSlate"]=="boolean"?""+qoe["c3.ad.isSlate"]:"false",mediaFileApiFramework=
qoe["c3.ad.mediaFileApiFramework"]||"NA",adStitcher=qoe["c3.ad.adStitcher"]||"NA",firstAdSystem=qoe["c3.ad.firstAdSystem"]||"NA",firstAdId=qoe["c3.ad.firstAdId"]||media.ad_id||"NA",firstCreativeId=qoe["c3.ad.firstCreativeId"]||"NA",creativeId=qoe["c3.ad.creativeId"]||"NA",contentAssetName=curTrackerBundle.curTitle||Bootstrapper.Conviva.getContentAssetName(index,curTrackerBundle);var adInfo={"c3.ad.technology":adTechnology,"c3.ad.id":adId,"c3.ad.system":adSystem,"c3.ad.position":adPosition,"c3.ad.isSlate":adIsSlate,
"c3.ad.mediaFileApiFramework":mediaFileApiFramework,"c3.ad.adStitcher":adStitcher,"c3.ad.firstAdSystem":firstAdSystem,"c3.ad.firstAdId":firstAdId,"c3.ad.firstCreativeId":firstCreativeId,"c3.ad.creativeId":creativeId,appBrand:brand,"contentAssetName":contentAssetName};adInfo[Conviva.Constants.VIEWER_ID]=swid;adInfo[Conviva.Constants.ASSET_NAME]=adTitle;adInfo[Conviva.Constants.IS_LIVE]=curTrackerBundle.curLive||Bootstrapper.Conviva.isLive(index,curTrackerBundle)?Conviva.Constants.StreamType.LIVE:Conviva.Constants.StreamType.VOD;
adInfo[Conviva.Constants.STREAM_URL]=currentSrc;adInfo[Conviva.Constants.DURATION]=duration;adInfo[Conviva.Constants.ENCODED_FRAMERATE]=encodedFramerate;for(var key in adInfo)if(Object.hasOwnProperty.call(adInfo,key))adInfo[key]=Bootstrapper.Conviva.resetDefaultValue(adInfo[key]);return adInfo};Bootstrapper.Conviva.setPlayerInfo=function(index){var playerInfo={},dl=__dataLayer,media=dl.media||{},meta=media.qoe||[],metaBundle=meta[index]||{},qoe=metaBundle.playback||{};playerInfo[Conviva.Constants.FRAMEWORK_NAME]=
qoe.frameworkName||"";playerInfo[Conviva.Constants.FRAMEWORK_VERSION]=qoe.frameworkVersion||"";return playerInfo};Bootstrapper.Conviva.setAdPlayerInfo=function(index){var adPlayerInfo={},dl=__dataLayer,media=dl.media||{},meta=media.qoe||[],metaBundle=meta[index]||{},qoe=metaBundle.ads||{};adPlayerInfo[Conviva.Constants.FRAMEWORK_NAME]=qoe.frameworkName||"";adPlayerInfo[Conviva.Constants.FRAMEWORK_VERSION]=qoe.frameworkVersion||"";return adPlayerInfo};Bootstrapper.Conviva.sessionStartUp=function(index){if(!Bootstrapper.Conviva.ready)Bootstrapper.Conviva.configureConviva(Bootstrapper.Conviva.initOptions);
var trackerBundle={videoPlaying:true,error:false,tracker:Conviva.Analytics.buildVideoAnalytics()};Bootstrapper.Conviva.analyticsTrackers[index]=trackerBundle;if(!Bootstrapper.Conviva.setULEvent){window.addEventListener("beforeunload",Bootstrapper.Conviva.cleanSessionsUnload,{capture:true});Bootstrapper.Conviva.setULEvent=true}};Bootstrapper.Conviva.adsStartUp=function(curTracker,index){var adsTrackerBundle={tracker:Conviva.Analytics.buildAdAnalytics(curTracker),adsPlaying:true,startedSession:false};
Bootstrapper.Conviva.adsTrackers[index]=adsTrackerBundle;if(!Bootstrapper.Conviva.setULEvent){window.addEventListener("beforeunload",Bootstrapper.Conviva.cleanSessionsUnload,{capture:true});Bootstrapper.Conviva.setULEvent=true}}},4044768,[4010591,4044017,4053064,4011933],686725,[645040,671423,683385,763742],-1);
Bootstrapper.bindDependencyImmediate(function(){var Bootstrapper=window["Bootstrapper"];var ensightenOptions=Bootstrapper.ensightenOptions;Bootstrapper.ensEvent.trigger("adobeConfigSet NatGeo")},3597314,[4010591,4044765,4044017,4053064,4011933],694918,[645040,666974,671423,683385,763742],-1);